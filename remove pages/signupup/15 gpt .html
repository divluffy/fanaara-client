<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Swipe Stories Signup</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ====== Safe area ====== */
    :root{
      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    .safe-pad{
      padding-top: calc(12px + var(--sat));
      padding-bottom: calc(12px + var(--sab));
      padding-left: calc(12px + var(--sal));
      padding-right: calc(12px + var(--sar));
    }

    /* ====== Story motion / transitions ====== */
    .stories-track{
      will-change: transform;
      transition: transform 420ms cubic-bezier(.2,.9,.2,1);

      /* âœ… FIX: Ø§Ø¬Ø¹Ù„ ØªØ±ØªÙŠØ¨ flex Ø«Ø§Ø¨Øª LTR Ø­ØªÙ‰ Ù…Ø¹ dir="rtl" */
      direction: ltr;
    }

    .story{
      /* âœ… FIX: Ø±Ø¬Ù‘Ø¹ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù†ÙØ³Ù‡ RTL */
      direction: rtl;

      /* âœ… FIX: Ø«Ø¨Ù‘Øª Ø§Ù„Ø¹Ø±Ø¶ Ù„ÙƒÙ„ Ø³ØªÙˆØ±ÙŠ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ */
      flex: 0 0 100%;

      will-change: transform, filter, opacity;
      transition: transform 420ms cubic-bezier(.2,.9,.2,1), filter 420ms cubic-bezier(.2,.9,.2,1), opacity 420ms cubic-bezier(.2,.9,.2,1);
      filter: blur(0px);
      opacity: 1;
    }
    .is-transitioning .story.is-active{
      filter: blur(6px);
      opacity: .86;
      transform: scale(.985);
    }
    .story:not(.is-active){
      opacity: 0;
      pointer-events: none;
      transform: scale(.995);
      filter: blur(10px);
    }
    .story.is-active{
      opacity: 1;
      pointer-events: auto;
      transform: scale(1);
      filter: blur(0);
      animation: cameraIn 520ms cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes cameraIn{
      0%{ transform: translateY(10px) scale(.985); filter: blur(10px); opacity: .0; }
      100%{ transform: translateY(0) scale(1); filter: blur(0); opacity: 1; }
    }
    .shake{
      animation: shake 420ms cubic-bezier(.36,.07,.19,.97) both;
    }
    @keyframes shake{
      10%, 90%{ transform: translateX(-1px); }
      20%, 80%{ transform: translateX(2px); }
      30%, 50%, 70%{ transform: translateX(-4px); }
      40%, 60%{ transform: translateX(4px); }
    }

    /* ====== Progress segments ====== */
    .seg{
      height: 3px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
      overflow: hidden;
      position: relative;
    }
    .seg > i{
      display:block;
      height: 100%;
      width: 0%;
      background: rgba(255,255,255,.92);
      border-radius: 999px;
      transform-origin: right center;
      will-change: width;
    }

    /* ====== Background layers ====== */
    .bg-layer{
      position:absolute; inset:0;
      opacity: 0;
      transition: opacity 520ms cubic-bezier(.2,.9,.2,1), filter 520ms cubic-bezier(.2,.9,.2,1), transform 520ms cubic-bezier(.2,.9,.2,1);
      filter: blur(10px);
      transform: scale(1.06);
    }
    .bg-layer.is-on{
      opacity: 1;
      filter: blur(0px);
      transform: scale(1.02);
      animation: bgZoom 6.5s ease-in-out infinite;
    }
    @keyframes bgZoom{
      0%,100%{ transform: scale(1.02) translateY(0); }
      50%{ transform: scale(1.06) translateY(4px); }
    }

    /* ====== Sakura (Story 1) ====== */
    .sakura{
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,182,193,.20), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(900px 900px at 50% 110%, rgba(255,105,180,.12), transparent 60%),
        linear-gradient(180deg, rgba(10,10,18,.9), rgba(6,6,10,.92));
      overflow:hidden;
    }
    .petal{
      position:absolute;
      top:-12vh;
      width: 14px; height: 10px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,140,190,.85) 60%, rgba(255,105,180,.35));
      border-radius: 10px 10px 10px 2px;
      transform: rotate(20deg);
      filter: drop-shadow(0 4px 8px rgba(0,0,0,.25));
      opacity: .8;
      animation: fall linear infinite;
    }
    .petal::after{
      content:"";
      position:absolute; inset:0;
      border-radius: 10px 10px 10px 2px;
      background: radial-gradient(circle at 70% 30%, rgba(255,255,255,.85), transparent 45%);
      opacity:.8;
      mix-blend-mode: screen;
    }
    @keyframes fall{
      0%{ transform: translate3d(0, -12vh, 0) rotate(0deg); }
      100%{ transform: translate3d(0, 120vh, 0) rotate(540deg); }
    }

    /* ====== Speedlines (Story 2) ====== */
    .speedlines{
      background:
        radial-gradient(900px 700px at 30% 20%, rgba(99,102,241,.20), transparent 55%),
        radial-gradient(900px 700px at 70% 30%, rgba(236,72,153,.14), transparent 55%),
        linear-gradient(180deg, rgba(7,7,14,.92), rgba(2,2,6,.96));
    }
    .speedlines::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        repeating-linear-gradient(115deg,
          rgba(255,255,255,.0) 0px,
          rgba(255,255,255,.0) 8px,
          rgba(255,255,255,.10) 9px,
          rgba(255,255,255,.0) 16px);
      transform: rotate(0deg);
      animation: lines 900ms linear infinite;
      opacity: .65;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }
    @keyframes lines{
      0%{ transform: translateX(0) translateY(0) rotate(0deg); }
      100%{ transform: translateX(120px) translateY(-140px) rotate(0deg); }
    }

    /* ====== City Night (Story 3) ====== */
    .city{
      background:
        radial-gradient(900px 700px at 60% 20%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(900px 700px at 30% 30%, rgba(14,165,233,.12), transparent 60%),
        linear-gradient(180deg, rgba(4,6,18,.95), rgba(2,2,7,.98));
    }
    .twinkle{
      animation: twinkle 2.8s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.28; }
      40%{ opacity:.85; }
      60%{ opacity:.45; }
    }

    /* ====== Galaxy (Story 4) ====== */
    .galaxy{
      background:
        radial-gradient(1000px 700px at 70% 25%, rgba(168,85,247,.18), transparent 55%),
        radial-gradient(800px 650px at 25% 45%, rgba(34,211,238,.12), transparent 60%),
        linear-gradient(180deg, rgba(3,3,10,.98), rgba(2,2,6,.99));
    }

    /* ====== HUD (Story 5) ====== */
    .hud{
      background:
        radial-gradient(1000px 800px at 60% 20%, rgba(16,185,129,.12), transparent 60%),
        linear-gradient(180deg, rgba(2,8,10,.94), rgba(0,0,0,.98));
    }
    .hud::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 28px 28px;
      opacity:.22;
    }
    .scan{
      position:absolute; left:0; right:0; top:-30%;
      height: 32%;
      background: linear-gradient(180deg, transparent, rgba(16,185,129,.18), transparent);
      animation: scan 2.4s linear infinite;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }
    @keyframes scan{
      0%{ transform: translateY(0); }
      100%{ transform: translateY(190%); }
    }

    /* ====== Manga Panels / Halftone (Story 6) ====== */
    .manga{
      background:
        radial-gradient(900px 700px at 30% 20%, rgba(244,63,94,.10), transparent 60%),
        radial-gradient(900px 700px at 70% 35%, rgba(59,130,246,.10), transparent 60%),
        linear-gradient(180deg, rgba(10,10,12,.92), rgba(2,2,4,.98));
      overflow:hidden;
    }
    .manga::before{
      content:"";
      position:absolute; inset:-10%;
      background:
        radial-gradient(circle, rgba(255,255,255,.16) 1px, transparent 2px);
      background-size: 10px 10px;
      opacity:.28;
      transform: rotate(8deg);
      animation: drift 5.5s ease-in-out infinite;
    }
    .manga::after{
      content:"";
      position:absolute; inset:-20%;
      background:
        linear-gradient(135deg, rgba(255,255,255,.06) 20%, transparent 20% 40%, rgba(255,255,255,.05) 40% 60%, transparent 60% 80%, rgba(255,255,255,.04) 80%);
      opacity:.14;
      transform: translateX(-6%) rotate(-10deg);
      animation: drift2 6.5s ease-in-out infinite;
    }
    @keyframes drift{
      0%,100%{ transform: translateY(0) rotate(8deg); }
      50%{ transform: translateY(12px) rotate(8deg); }
    }
    @keyframes drift2{
      0%,100%{ transform: translateX(-6%) translateY(0) rotate(-10deg); }
      50%{ transform: translateX(-2%) translateY(10px) rotate(-10deg); }
    }

    /* ====== Celebration (Story 7) ====== */
    .celebrate{
      background:
        radial-gradient(900px 700px at 30% 30%, rgba(250,204,21,.18), transparent 60%),
        radial-gradient(900px 700px at 70% 35%, rgba(236,72,153,.16), transparent 60%),
        radial-gradient(1000px 800px at 50% 10%, rgba(59,130,246,.18), transparent 60%),
        linear-gradient(180deg, rgba(6,6,10,.92), rgba(0,0,0,.98));
    }

    /* ====== Visual SFX ====== */
    .sparkle{
      position:absolute;
      width: 10px; height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(255,255,255,.95), rgba(255,255,255,0));
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
      opacity:0;
      animation: sparkle 900ms ease-out forwards;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    @keyframes sparkle{
      0%{ transform: translateY(0) scale(.6); opacity: 0; }
      20%{ opacity: .9; }
      100%{ transform: translateY(-22px) scale(1.35); opacity: 0; }
    }
    .stamp{
      position:absolute;
      top: 18px;
      left: 18px;
      transform: rotate(-14deg);
      background: rgba(16,185,129,.16);
      border: 1px solid rgba(16,185,129,.35);
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .hud-ping{
      position:absolute;
      width: 10px; height: 10px;
      border-radius: 999px;
      border: 2px solid rgba(16,185,129,.9);
      animation: ping 900ms ease-out forwards;
      pointer-events:none;
      opacity:.9;
      mix-blend-mode: screen;
    }
    @keyframes ping{
      0%{ transform: scale(.3); opacity:.0; }
      25%{ opacity:.9; }
      100%{ transform: scale(7); opacity:0; }
    }

    /* Inputs: slightly more "anime UI" */
    .glass{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 24px 60px rgba(0,0,0,.38);
      backdrop-filter: blur(14px);
    }
    .btn-glow{
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    .chip{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .chip[aria-pressed="true"]{
      background: rgba(255,255,255,.16);
      border-color: rgba(255,255,255,.30);
      box-shadow: 0 18px 36px rgba(0,0,0,.25);
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .stories-track, .story, .bg-layer, .petal, .speedlines::before, .scan, .manga::before, .manga::after { transition:none !important; animation:none !important; }
    }
  </style>
</head>

<body class="bg-black text-white">
  <div id="app" class="min-h-[100svh] w-screen flex items-center justify-center">
    <div id="phone" class="relative w-full max-w-md h-[100svh] overflow-hidden sm:rounded-3xl sm:border sm:border-white/10">
      <!-- Backgrounds -->
      <div class="absolute inset-0">
        <div id="bg1" class="bg-layer sakura">
          <div class="absolute inset-0" aria-hidden="true" id="petals"></div>
        </div>

        <div id="bg2" class="bg-layer speedlines"></div>

        <div id="bg3" class="bg-layer city">
          <svg class="absolute inset-x-0 bottom-0 w-full h-[62%] opacity-90" viewBox="0 0 360 300" preserveAspectRatio="none" aria-hidden="true">
            <defs>
              <linearGradient id="bld" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="rgba(255,255,255,0.10)"/>
                <stop offset="1" stop-color="rgba(255,255,255,0.02)"/>
              </linearGradient>
            </defs>
            <g fill="rgba(255,255,255,0.06)">
              <rect x="0" y="110" width="72" height="190" rx="6"/>
              <rect x="62" y="80" width="64" height="220" rx="6"/>
              <rect x="120" y="130" width="84" height="170" rx="6"/>
              <rect x="200" y="70" width="70" height="230" rx="6"/>
              <rect x="262" y="120" width="98" height="180" rx="6"/>
            </g>
            <g>
              <g fill="rgba(255,255,255,0.22)">
                <rect class="twinkle" style="animation-delay:.2s" x="14" y="130" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:1.1s" x="36" y="150" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:.6s" x="80" y="110" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:1.6s" x="98" y="140" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:.8s" x="144" y="160" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:1.8s" x="164" y="190" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:.3s" x="222" y="100" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:1.3s" x="242" y="130" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:.9s" x="286" y="150" width="10" height="12" rx="2"/>
                <rect class="twinkle" style="animation-delay:1.9s" x="314" y="180" width="10" height="12" rx="2"/>
              </g>
            </g>
            <rect x="0" y="0" width="360" height="300" fill="url(#bld)" opacity="0.25"/>
          </svg>

          <div class="absolute inset-0 opacity-80" aria-hidden="true">
            <div class="twinkle absolute top-[12%] right-[18%] w-1 h-1 rounded-full bg-white/70" style="animation-delay:.2s"></div>
            <div class="twinkle absolute top-[22%] right-[42%] w-1.5 h-1.5 rounded-full bg-white/60" style="animation-delay:1.1s"></div>
            <div class="twinkle absolute top-[18%] right-[70%] w-1 h-1 rounded-full bg-white/60" style="animation-delay:.7s"></div>
            <div class="twinkle absolute top-[30%] right-[25%] w-1 h-1 rounded-full bg-white/50" style="animation-delay:1.7s"></div>
          </div>
        </div>

        <div id="bg4" class="bg-layer galaxy">
          <canvas id="galaxyCanvas" class="absolute inset-0 w-full h-full"></canvas>
        </div>

        <div id="bg5" class="bg-layer hud">
          <div class="scan"></div>
          <div class="absolute inset-0 opacity-70" aria-hidden="true">
            <div class="absolute top-6 right-6 text-[10px] tracking-widest text-emerald-200/70">FOLLOW / SYNC</div>
            <div class="absolute top-10 right-6 w-32 h-[1px] bg-emerald-200/20"></div>
            <div class="absolute bottom-24 left-6 text-[10px] tracking-widest text-emerald-200/60">NODES: 02-03</div>
            <div class="absolute bottom-20 left-6 w-28 h-[1px] bg-emerald-200/20"></div>
          </div>
        </div>

        <div id="bg6" class="bg-layer manga"></div>

        <div id="bg7" class="bg-layer celebrate">
          <canvas id="confettiCanvas" class="absolute inset-0 w-full h-full"></canvas>
        </div>

        <div class="absolute inset-0 bg-gradient-to-b from-black/45 via-black/10 to-black/65"></div>
      </div>

      <!-- UI -->
      <div class="relative z-10 h-full safe-pad flex flex-col gap-3">
        <!-- Top bar -->
        <div class="flex items-center gap-3">
          <div class="flex-1 grid grid-cols-7 gap-1.5">
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
            <div class="seg"><i></i></div>
          </div>

          <button id="autoBtn" class="shrink-0 glass rounded-full px-3 py-2 text-xs text-white/90 hover:text-white active:scale-[.98] transition" type="button" aria-pressed="false" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ">
            <span class="inline-flex items-center gap-2">
              <span class="inline-block w-2.5 h-2.5 rounded-full bg-white/30" id="autoDot"></span>
              ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </span>
          </button>
        </div>

        <!-- Toast -->
        <div id="toast" class="pointer-events-none opacity-0 translate-y-[-6px] transition-all duration-200 glass rounded-2xl px-4 py-3 text-sm text-white/90">
          <div class="flex items-start gap-3">
            <div class="mt-0.5">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 9v4" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 17h.01" stroke="rgba(255,255,255,.9)" stroke-width="3" stroke-linecap="round"/>
                <path d="M10.3 3.8 2.1 18.1A2 2 0 0 0 3.9 21h16.2a2 2 0 0 0 1.8-2.9L13.7 3.8a2 2 0 0 0-3.4 0Z" stroke="rgba(255,255,255,.6)" stroke-width="1.4"/>
              </svg>
            </div>
            <div class="flex-1">
              <div class="font-semibold" id="toastTitle">ØªÙ†Ø¨ÙŠÙ‡</div>
              <div class="text-white/80 mt-0.5" id="toastMsg">...</div>
            </div>
          </div>
        </div>

        <!-- Stories viewport -->
        <div id="viewport" class="relative flex-1 overflow-hidden">
          <div id="track" class="stories-track h-full w-full flex">
            <!-- Story 1 -->
            <section class="story h-full shrink-0 is-active" data-story="0">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">STORY</div>
                      <h1 class="text-2xl font-bold mt-1">Ù‡Ù„Ø§! Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ âœ¨</h1>
                      <p class="text-sm text-white/75 mt-1">Ø§Ø³Ù… + Ø¨Ø±ÙŠØ¯â€¦ ÙˆØ®Ù„Ø§Øµ.</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/8 border border-white/10 flex items-center justify-center">
                      <span class="text-xl">ğŸª„</span>
                    </div>
                  </div>

                  <div class="mt-4 grid gap-3">
                    <label class="block">
                      <span class="text-xs text-white/70">Ø§Ø³Ù…Ùƒ</span>
                      <input id="name" autocomplete="name" class="mt-1 w-full rounded-2xl bg-black/25 border border-white/12 px-4 py-3 outline-none focus:border-white/30 focus:ring-2 focus:ring-white/10" placeholder="Ù…Ø«Ø§Ù„: Ù„ÙˆÙÙŠ" />
                      <div class="text-[11px] text-white/55 mt-1">Ø®Ù„ÙŠÙ‡ Ù‚ØµÙŠØ±â€¦ Ø²ÙŠ Ø§Ø³Ù… Ø¨Ø·Ù„ ğŸ”¥</div>
                    </label>

                    <label class="block">
                      <span class="text-xs text-white/70">Ø§Ù„Ø¨Ø±ÙŠØ¯</span>
                      <input id="email" autocomplete="email" inputmode="email" class="mt-1 w-full rounded-2xl bg-black/25 border border-white/12 px-4 py-3 outline-none focus:border-white/30 focus:ring-2 focus:ring-white/10" placeholder="you@domain.com" />
                      <div class="text-[11px] text-white/55 mt-1">Ø±Ø­ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨Ùƒ ÙÙ‚Ø·.</div>
                    </label>
                  </div>

                  <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-white/60">Ø§Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ø£Ùˆ Ø§Ø¶ØºØ· Ø§Ù„Ø£Ø·Ø±Ø§Ù</div>
                    <div class="inline-flex items-center gap-2 text-xs text-white/75">
                      <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                      <span>Ù‡ÙˆÙŠÙ‘Ø©</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 2 -->
            <section class="story h-full shrink-0" data-story="1">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5 relative overflow-hidden">
                  <div class="absolute -top-10 -left-10 w-48 h-48 rounded-full bg-indigo-500/10 blur-2xl"></div>
                  <div class="absolute -bottom-12 -right-12 w-56 h-56 rounded-full bg-pink-500/10 blur-2xl"></div>

                  <div class="flex items-center justify-between gap-3 relative">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">SECURE MODE</div>
                      <h2 class="text-2xl font-bold mt-1">ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±â€¦ Ø³Ø±ÙŠØ¹Ø© ÙˆÙ‚ÙˆÙŠØ© âš¡</h2>
                      <p class="text-sm text-white/75 mt-1">Ø±Ø­ Ù†Ù‚ÙŠØ³ Ø§Ù„Ù‚ÙˆØ© Ù„Ø­Ø¸ÙŠØ§Ù‹.</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/8 border border-white/10 flex items-center justify-center">
                      <span class="text-xl">ğŸ—ï¸</span>
                    </div>
                  </div>

                  <div class="mt-4 relative">
                    <label class="block">
                      <span class="text-xs text-white/70">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
                      <div class="mt-1 flex items-center gap-2">
                        <input id="password" autocomplete="new-password" type="password"
                               class="flex-1 rounded-2xl bg-black/25 border border-white/12 px-4 py-3 outline-none focus:border-white/30 focus:ring-2 focus:ring-white/10"
                               placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                        <button id="togglePw" type="button" class="rounded-2xl px-3 py-3 bg-white/8 border border-white/12 hover:bg-white/10 active:scale-[.98] transition" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="rgba(255,255,255,.85)" stroke-width="1.6"/>
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="rgba(255,255,255,.85)" stroke-width="1.6"/>
                          </svg>
                        </button>
                      </div>
                    </label>

                    <div class="mt-3">
                      <div class="flex items-center justify-between text-xs text-white/70">
                        <span>Ø§Ù„Ù‚ÙˆØ©</span>
                        <span id="pwLabel" class="text-white/80">â€”</span>
                      </div>
                      <div class="mt-2 h-2 rounded-full bg-white/10 overflow-hidden">
                        <div id="pwBar" class="h-full w-0 rounded-full bg-white/80 transition-all duration-200"></div>
                      </div>
                    </div>

                    <div id="pwHint" class="mt-3 opacity-0 translate-y-[-6px] transition-all duration-200">
                      <div class="glass rounded-2xl px-4 py-3 text-sm text-white/85 border border-white/12">
                        <div class="font-semibold">ØªÙ„Ù…ÙŠØ­ Ù†ÙŠÙ†Ø¬Ø§ ğŸ¥·</div>
                        <div class="text-white/75 mt-0.5">Ø¬Ø±Ù‘Ø¨ 8+ Ø£Ø­Ø±ÙØŒ Ø±Ù‚Ù…ØŒ ÙˆØ±Ù…Ø² Ù…Ø«Ù„ <span class="font-mono">!</span> Ø£Ùˆ <span class="font-mono">@</span>.</div>
                      </div>
                    </div>

                    <div class="mt-4 flex items-center justify-between">
                      <div class="text-xs text-white/60">Ø¨Ø¯ÙˆÙ† ØµÙˆØªâ€¦ Ø¨Ø³ Ø§Ù„ÙØ§ÙŠØ¨ ğŸ”¥</div>
                      <div class="inline-flex items-center gap-2 text-xs text-white/75">
                        <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                        <span>Ø£Ù…Ø§Ù†</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 3 -->
            <section class="story h-full shrink-0" data-story="2">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">PFP</div>
                      <h2 class="text-2xl font-bold mt-1">Ø§Ø®ØªÙØ± Avatar ğŸ­</h2>
                      <p class="text-sm text-white/75 mt-1">Ø´Ø¨ÙƒØ© Ø¨Ø³ÙŠØ·Ø©â€¦ Ø£Ùˆ Ø²Ø± Ø±Ø§Ù†Ø¯ÙˆÙ….</p>
                    </div>
                    <button id="randomAvatar" type="button"
                            class="btn-glow rounded-2xl px-4 py-3 bg-white/12 border border-white/14 hover:bg-white/16 active:scale-[.98] transition text-sm">
                      ğŸ² Ø±Ø§Ù†Ø¯ÙˆÙ…
                    </button>
                  </div>

                  <div id="avatarGrid" class="mt-4 grid grid-cols-3 gap-3"></div>

                  <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-white/60">Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·</div>
                    <div class="inline-flex items-center gap-2 text-xs text-white/75">
                      <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                      <span>Ù‡ÙˆÙŠØ©</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 4 -->
            <section class="story h-full shrink-0" data-story="3">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">TASTE</div>
                      <h2 class="text-2xl font-bold mt-1">Ø§Ø®ØªØ± 3 Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª âš™ï¸</h2>
                      <p class="text-sm text-white/75 mt-1">Ø«Ù„Ø§Ø«Ø©â€¦ Ù„Ø§ Ø£ÙƒØ«Ø± ğŸ˜„</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/8 border border-white/10 flex items-center justify-center">
                      <span class="text-xl">ğŸŒŒ</span>
                    </div>
                  </div>

                  <div class="mt-4">
                    <div class="flex items-center justify-between text-xs text-white/70">
                      <span>Ø§Ù„Ù…Ø­Ø¯Ø¯</span>
                      <span id="interestCount" class="text-white/85">0 / 3</span>
                    </div>
                    <div id="interestChips" class="mt-3 flex flex-wrap gap-2"></div>
                    <div class="text-[11px] text-white/55 mt-3">Ø±Ø­ Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„ØªÙØµÙŠÙ„ Ø§Ù„Ù€ feed.</div>
                  </div>

                  <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-white/60">ØªÙ„Ù…ÙŠØ­: Ø§Ø³Ø­Ø¨â€¦ Ø²ÙŠ Ø³ØªÙˆØ±ÙŠ</div>
                    <div class="inline-flex items-center gap-2 text-xs text-white/75">
                      <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                      <span>Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 5 -->
            <section class="story h-full shrink-0" data-story="4">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">FOLLOW</div>
                      <h2 class="text-2xl font-bold mt-1">ØªØ§Ø¨Ø¹ 2â€“3 Ù…Ø´Ø§Ù‡ÙŠØ± â­</h2>
                      <p class="text-sm text-white/75 mt-1">Ø¹Ø´Ø§Ù† Ù†Ø­Ù…Ù‘ÙŠÙƒ Ù…Ù† Ø§Ù„ÙØ±Ø§Øº Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/8 border border-white/10 flex items-center justify-center">
                      <span class="text-xl">ğŸ“¡</span>
                    </div>
                  </div>

                  <div class="mt-4">
                    <div class="flex items-center justify-between text-xs text-white/70">
                      <span>Ø§Ù„Ù…Ø­Ø¯Ø¯</span>
                      <span id="followCount" class="text-white/85">0 / 3 (Ù„Ø§Ø²Ù… 2)</span>
                    </div>

                    <div id="celebs" class="mt-3 grid grid-cols-1 gap-2"></div>

                    <div class="text-[11px] text-white/55 mt-3">Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…Ø¤Ù‚ØªØ©â€¦ ØªÙ‚Ø¯Ø± ØªØºÙŠÙ‘Ø±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>
                  </div>

                  <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-white/60">HUD pingâ€¦ Ø´ÙˆÙ Ø§Ù„Ù„Ù…Ø¹Ø© ğŸ˜‰</div>
                    <div class="inline-flex items-center gap-2 text-xs text-white/75">
                      <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                      <span>Ù…ØªØ§Ø¨Ø¹Ø©</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 6 -->
            <section class="story h-full shrink-0" data-story="5">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">CONTENT</div>
                      <h2 class="text-2xl font-bold mt-1">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ + Genres ğŸ¬</h2>
                      <p class="text-sm text-white/75 mt-1">Ø§Ø®ØªÙØ± ÙˆØ§Ø­Ø¯ + Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø¬Ù†Ø±ÙŠÙ†.</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/8 border border-white/10 flex items-center justify-center">
                      <span class="text-xl">ğŸ§©</span>
                    </div>
                  </div>

                  <div class="mt-4">
                    <div class="text-xs text-white/70">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
                    <div id="contentTypes" class="mt-2 grid grid-cols-2 gap-2"></div>

                    <div class="mt-4 flex items-center justify-between text-xs text-white/70">
                      <span>Genres</span>
                      <span id="genreCount" class="text-white/85">0 / 5 (Ù„Ø§Ø²Ù… 2)</span>
                    </div>
                    <div id="genres" class="mt-3 flex flex-wrap gap-2"></div>
                  </div>

                  <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-white/60">Ø³ØªØ§ÙŠÙ„ Ù…Ø§Ù†ØºØ§â€¦ Ù†Ù‚Ø§Ø· ÙˆØ­Ø±ÙƒØ§Øª</div>
                    <div class="inline-flex items-center gap-2 text-xs text-white/75">
                      <span class="inline-block w-1.5 h-1.5 rounded-full bg-white/60"></span>
                      <span>ØªØ®ØµÙŠØµ</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Story 7 -->
            <section class="story h-full shrink-0" data-story="6">
              <div class="h-full flex flex-col justify-end pb-2">
                <div class="glass rounded-3xl p-5 relative overflow-hidden">
                  <div class="absolute -top-10 -right-10 w-64 h-64 rounded-full bg-yellow-400/10 blur-3xl"></div>
                  <div class="absolute -bottom-10 -left-10 w-72 h-72 rounded-full bg-pink-400/10 blur-3xl"></div>

                  <div class="flex items-start justify-between gap-3 relative">
                    <div>
                      <div class="text-xs text-white/70 tracking-wide">SUCCESS</div>
                      <h2 class="text-2xl font-bold mt-1">ØªÙ…! ğŸ‰</h2>
                      <p class="text-sm text-white/75 mt-1" id="welcomeLine">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒâ€¦</p>
                    </div>
                    <div class="w-12 h-12 rounded-2xl bg-white/10 border border-white/12 flex items-center justify-center">
                      <span class="text-xl">âœ…</span>
                    </div>
                  </div>

                  <div class="mt-4 grid gap-2">
                    <div class="rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm">
                      <div class="text-white/70 text-xs">Ù…Ù„Ø®Ù‘Øµ Ø³Ø±ÙŠØ¹</div>
                      <div class="mt-1 text-white/90" id="summary"></div>
                    </div>

                    <button id="startBtn" type="button"
                            class="btn-glow rounded-2xl px-4 py-3 bg-white text-black font-semibold hover:opacity-95 active:scale-[.98] transition">
                      Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† ğŸš€
                    </button>

                    <button id="restartBtn" type="button"
                            class="rounded-2xl px-4 py-3 bg-white/10 border border-white/12 hover:bg-white/12 active:scale-[.98] transition text-sm">
                      Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    </button>
                  </div>

                  <div class="stamp rounded-2xl px-4 py-2 text-xs text-emerald-100/90">
                    WELCOME âœ”
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- Bottom controls -->
        <div class="flex items-center justify-between gap-3 pb-1">
          <button id="prevBtn" type="button" class="glass rounded-2xl px-4 py-3 text-sm hover:bg-white/10 active:scale-[.98] transition">
            â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚
          </button>

          <div class="text-xs text-white/60">
            <span id="miniHint">Ø§Ø³Ø­Ø¨ Ù„Ù„ØªÙ†Ù‚Ù‘Ù„</span>
          </div>

          <button id="nextBtn" type="button" class="btn-glow rounded-2xl px-4 py-3 text-sm bg-white/12 border border-white/14 hover:bg-white/16 active:scale-[.98] transition">
            Ø§Ù„ØªØ§Ù„ÙŠ â–¶
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== State ======
    const state = {
      name: "",
      email: "",
      password: "",
      avatarId: null,
      interests: [],
      follows: [],
      contentType: null,
      genres: []
    };

    const TOTAL = 7;
    let idx = 5
    let isTransitioning = false;

    // Timing (optional)
    let autoPlay = false;
    const STORY_MS = 7000;
    let tStart = 0;
    let raf = null;
    let paused = false;

    // ====== Elements ======
    const phone = document.getElementById("phone");
    const viewport = document.getElementById("viewport");
    const track = document.getElementById("track");
    const stories = Array.from(document.querySelectorAll(".story"));
    const segs = Array.from(document.querySelectorAll(".seg > i"));

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const autoBtn = document.getElementById("autoBtn");
    const autoDot = document.getElementById("autoDot");

    const toast = document.getElementById("toast");
    const toastTitle = document.getElementById("toastTitle");
    const toastMsg = document.getElementById("toastMsg");
    let toastTimer = null;

    const bgLayers = [
      document.getElementById("bg1"),
      document.getElementById("bg2"),
      document.getElementById("bg3"),
      document.getElementById("bg4"),
      document.getElementById("bg5"),
      document.getElementById("bg6"),
      document.getElementById("bg7"),
    ];

    // Story 1
    const nameEl = document.getElementById("name");
    const emailEl = document.getElementById("email");

    // Story 2
    const pwEl = document.getElementById("password");
    const togglePw = document.getElementById("togglePw");
    const pwBar = document.getElementById("pwBar");
    const pwLabel = document.getElementById("pwLabel");
    const pwHint = document.getElementById("pwHint");

    // Story 3
    const avatarGrid = document.getElementById("avatarGrid");
    const randomAvatar = document.getElementById("randomAvatar");

    // Story 4
    const interestChips = document.getElementById("interestChips");
    const interestCount = document.getElementById("interestCount");

    // Story 5
    const celebsEl = document.getElementById("celebs");
    const followCount = document.getElementById("followCount");

    // Story 6
    const contentTypesEl = document.getElementById("contentTypes");
    const genresEl = document.getElementById("genres");
    const genreCount = document.getElementById("genreCount");

    // Story 7
    const welcomeLine = document.getElementById("welcomeLine");
    const summaryEl = document.getElementById("summary");
    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    // ====== Data ======
    const avatars = [
      { id: 1, label: "Shonen", vibe: "âš¡", a: "#60A5FA", b: "#A78BFA" },
      { id: 2, label: "Kawaii", vibe: "ğŸ¬", a: "#FB7185", b: "#FBBF24" },
      { id: 3, label: "Ninja", vibe: "ğŸ¥·", a: "#34D399", b: "#60A5FA" },
      { id: 4, label: "Mage", vibe: "ğŸ”®", a: "#A78BFA", b: "#22D3EE" },
      { id: 5, label: "Mecha", vibe: "ğŸ¤–", a: "#94A3B8", b: "#60A5FA" },
      { id: 6, label: "Samurai", vibe: "ğŸ—¡ï¸", a: "#F97316", b: "#FB7185" },
      { id: 7, label: "Vamp", vibe: "ğŸ¦‡", a: "#0EA5E9", b: "#111827" },
      { id: 8, label: "Hero", vibe: "ğŸ¦¸", a: "#FBBF24", b: "#60A5FA" },
      { id: 9, label: "Cat", vibe: "ğŸ¾", a: "#FB7185", b: "#A78BFA" },
    ];

    const interests = [
      "Ø´ÙˆÙ†Ù†", "Ø´ÙˆØ¬Ùˆ", "Ø³ÙŠÙ†ÙŠÙ†", "Ø¥ÙŠØ³ÙŠÙƒØ§ÙŠ", "Ù…ÙƒØ§", "Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ",
      "ØºÙ…ÙˆØ¶", "Ø±Ø¹Ø¨", "ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§", "Ù‚ØªØ§Ù„Ø§Øª", "ÙˆÙŠØ¨ ØªÙˆÙ†", "ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ"
    ];

    const celebs = [
      { id: "gojo", name: "Gojo Satoru", tag: "@six_eyes", badge: "SORCERER" },
      { id: "luffy", name: "Monkey D. Luffy", tag: "@straw_hat", badge: "CAPTAIN" },
      { id: "mikasa", name: "Mikasa Ackerman", tag: "@scarf", badge: "ELITE" },
      { id: "goku", name: "Son Goku", tag: "@saiyan", badge: "ULTRA" },
      { id: "nezuko", name: "Nezuko", tag: "@box_mode", badge: "DEMON?" }
    ];

    const contentTypes = ["Anime", "Manga", "Manhwa", "Comics"];
    const genres = [
      "Ø£ÙƒØ´Ù†", "Ù…ØºØ§Ù…Ø±Ø©", "Ø®ÙŠØ§Ù„", "Ø®ÙŠØ§Ù„ Ø¹Ù„Ù…ÙŠ", "Ù…Ø¯Ø±Ø³ÙŠ",
      "Ø±ÙŠØ§Ø¶Ø©", "Ø¯Ø±Ø§Ù…Ø§", "Ø³Ø§ÙŠØ¨Ø±Ø¨Ù†Ùƒ", "ØªØ§Ø±ÙŠØ®ÙŠ", "ÙØ§Ù†ØªØ§Ø²ÙŠØ§ Ù…Ø¸Ù„Ù…Ø©"
    ];

    // ====== Helpers ======
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const isEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(String(v).trim());

    function toastify(title, msg){
      clearTimeout(toastTimer);
      toastTitle.textContent = title;
      toastMsg.textContent = msg;
      toast.classList.remove("opacity-0","translate-y-[-6px]");
      toast.classList.add("opacity-100","translate-y-0");
      toastTimer = setTimeout(() => {
        toast.classList.add("opacity-0","translate-y-[-6px]");
        toast.classList.remove("opacity-100","translate-y-0");
      }, 1700);
    }

    function sparkle(x, y){
      const s = document.createElement("div");
      s.className = "sparkle";
      s.style.left = (x - 5) + "px";
      s.style.top  = (y - 5) + "px";
      phone.appendChild(s);
      s.addEventListener("animationend", () => s.remove());
    }

    function hudPing(x, y){
      const p = document.createElement("div");
      p.className = "hud-ping";
      p.style.left = (x - 5) + "px";
      p.style.top  = (y - 5) + "px";
      phone.appendChild(p);
      p.addEventListener("animationend", () => p.remove());
    }

    function setTransitioning(on){
      isTransitioning = on;
      phone.classList.toggle("is-transitioning", on);
    }

    function setBg(i){
      bgLayers.forEach((l, k) => l.classList.toggle("is-on", k === i));
    }

    function setBtnLooks(btn, looksDisabled){
      btn.setAttribute("aria-disabled", looksDisabled ? "true" : "false");
      btn.classList.toggle("opacity-50", looksDisabled);
      btn.classList.toggle("cursor-not-allowed", looksDisabled);
    }

    function updateTrack(){
      const w = viewport.clientWidth || 0;

      // âœ… translate3d + Ø­Ø³Ø§Ø¨ Ø«Ø§Ø¨Øª Ù„Ø£Ù† track ØµØ§Ø± LTR
      track.style.transform = `translate3d(${-idx * w}px, 0, 0)`;

      stories.forEach((s, k) => s.classList.toggle("is-active", k === idx));

      const atStart = idx === 0;
      const atEnd = idx === TOTAL - 1;

      setBtnLooks(prevBtn, atStart);
      setBtnLooks(nextBtn, atEnd);

      document.getElementById("miniHint").textContent = atEnd ? "Ø¬Ø§Ù‡Ø²!" : (autoPlay ? "ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø´ØºØ§Ù„" : "Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ·");

      segs.forEach((fill, k) => {
        if (k < idx) fill.style.width = "100%";
        if (k > idx) fill.style.width = "0%";
        if (k === idx && !autoPlay) fill.style.width = "22%";
      });

      setBg(idx);

      if (idx === 6){
        buildSummary();
        startConfetti();
      } else {
        stopConfetti();
      }

      restartTimer();
      updateNextEnabled();
    }

    function nudgeInvalid(){
      const active = stories[idx];
      active.classList.remove("shake");
      void active.offsetWidth;
      active.classList.add("shake");
    }

    // ====== Validation per story ======
    function pwScore(pw){
      const s = String(pw || "");
      let score = 0;
      if (s.length >= 8) score += 1;
      if (/[A-Z]/.test(s)) score += 1;
      if (/[a-z]/.test(s)) score += 1;
      if (/[0-9]/.test(s)) score += 1;
      if (/[^A-Za-z0-9]/.test(s)) score += 1;
      return clamp(score, 0, 5);
    }

    function storyValid(i){
      if (i === 0) return state.name.trim().length >= 2 && isEmail(state.email);
      if (i === 1) return pwScore(state.password) >= 3;
      if (i === 2) return !!state.avatarId;
      if (i === 3) return state.interests.length === 3;
      if (i === 4) return state.follows.length >= 2 && state.follows.length <= 3;
      if (i === 5) return !!state.contentType && state.genres.length >= 2 && state.genres.length <= 5;
      return true;
    }

    function updateNextEnabled(){
      const ok = storyValid(idx);
      const atEnd = idx === TOTAL - 1;

      // âœ… Ù…Ø§ Ù†Ø¹Ø·Ù‘Ù„ Ø§Ù„Ø²Ø± disabled (Ø­ØªÙ‰ ÙŠÙ‚Ø¯Ø± ÙŠØ¶ØºØ· ÙˆÙŠØ´ÙˆÙ toast)
      // ÙÙ‚Ø· Ø´ÙƒÙ„ â€œÙƒØ£Ù†Ù‡ Ù…Ù‚ÙÙˆÙ„â€
      if (atEnd){
        setBtnLooks(nextBtn, true);
        return;
      }
      setBtnLooks(nextBtn, !ok);
    }

    // ====== Navigation ======
    function go(to){
      if (isTransitioning) return;
      to = clamp(to, 0, TOTAL - 1);

      if (to > idx){
        if (!storyValid(idx)){
          toastify("Ù†Ø§Ù‚Øµ Ø´ÙŠØ¡ ğŸ‘€", "ÙƒÙ…Ù‘Ù„ Ø§Ø®ØªÙŠØ§Ø±Ùƒ/Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø³Ø±Ø¹Ø©.");
          nudgeInvalid();
          return;
        }
      }

      setTransitioning(true);
      idx = to;
      updateTrack();
      setTimeout(() => setTransitioning(false), 420);
    }
    function next(){ go(idx + 1); }
    function prev(){ go(idx - 1); }

    prevBtn.addEventListener("click", () => {
      const r = phone.getBoundingClientRect();
      sparkle(r.left + 40, r.top + 80);
      prev();
    });

    nextBtn.addEventListener("click", () => {
      const r = phone.getBoundingClientRect();
      sparkle(r.left + phone.clientWidth - 40, r.top + 80);
      next();
    });

    // Tap left/right to navigate (ignore if tapping interactive elements)
    viewport.addEventListener("click", (e) => {
      const t = e.target;
      if (t.closest("button, a, input, textarea, select, [role='button']")) return;

      const r = viewport.getBoundingClientRect();
      const x = e.clientX - r.left;
      const leftZone = r.width * 0.30;
      const rightZone = r.width * 0.70;

      // âœ… RTL UX: Ø§Ù„ÙŠØ³Ø§Ø± = Ø§Ù„ØªØ§Ù„ÙŠ ØŒ Ø§Ù„ÙŠÙ…ÙŠÙ† = Ø§Ù„Ø³Ø§Ø¨Ù‚
      if (x <= leftZone){
        sparkle(e.clientX, e.clientY);
        next();
      } else if (x >= rightZone){
        sparkle(e.clientX, e.clientY);
        prev();
      }
    });

    // Swipe gesture
    let sx = 0, sy = 0, st = 0;
    viewport.addEventListener("touchstart", (e) => {
      if (e.target.closest("input, textarea, select")) return;
      const t = e.touches[0];
      sx = t.clientX; sy = t.clientY; st = Date.now();
    }, { passive: true });

    viewport.addEventListener("touchend", (e) => {
      if (!sx) return;
      const dt = Date.now() - st;
      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if (!t) return;

      const dx = t.clientX - sx;
      const dy = t.clientY - sy;
      sx = sy = 0;

      if (Math.abs(dx) < 50) return;
      if (Math.abs(dx) < Math.abs(dy)) return;
      if (dt > 650) return;

      sparkle(t.clientX, t.clientY);

      // ÙÙŠ RTL: Ø³Ø­Ø¨ Ù„Ù„ÙŠØ³Ø§Ø± = Ø§Ù„ØªØ§Ù„ÙŠ (Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ)
      if (dx < 0) next(); else prev();
    }, { passive: true });

    // ====== Autoplay timer ======
    function restartTimer(){
      cancelAnimationFrame(raf);
      if (!autoPlay) return;
      tStart = performance.now();
      raf = requestAnimationFrame(tick);
    }

    function tick(t){
      if (!autoPlay) return;
      if (paused){ raf = requestAnimationFrame(tick); return; }

      const elapsed = t - tStart;
      const p = clamp(elapsed / STORY_MS, 0, 1);

      segs[idx].style.width = (p * 100).toFixed(1) + "%";

      if (p >= 1){
        if (idx < TOTAL - 1 && storyValid(idx)){
          next();
          return;
        } else {
          tStart = performance.now();
          segs[idx].style.width = "100%";
          toastify("ØªÙˆÙ‚Ù‘Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ ğŸ›‘", "ÙƒÙ…Ù‘Ù„ Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø¹Ø´Ø§Ù† Ù†ÙƒÙ…Ù„.");
          nudgeInvalid();
        }
      }
      raf = requestAnimationFrame(tick);
    }

    function setAuto(on){
      autoPlay = !!on;
      autoBtn.setAttribute("aria-pressed", autoPlay ? "true" : "false");
      autoDot.className = "inline-block w-2.5 h-2.5 rounded-full " + (autoPlay ? "bg-white/90" : "bg-white/30");
      toastify(autoPlay ? "ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø´ØºÙ‘Ø§Ù„ â±ï¸" : "ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ØªÙˆÙ‚Ù", autoPlay ? "Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ø¹Ù„Ù‰ 7 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ø³ØªÙˆØ±ÙŠ." : "Ø£Ù†Øª Ø§Ù„Ù…ØªØ­ÙƒÙ‘Ù… Ø§Ù„Ø¢Ù†.");
      updateTrack();
    }
    autoBtn.addEventListener("click", () => setAuto(!autoPlay));

    // Pause autoplay while typing
    ["focusin","pointerdown","touchstart"].forEach(ev => {
      phone.addEventListener(ev, (e) => {
        if (e.target.closest("input, textarea, select")) paused = true;
      }, { passive: true });
    });
    ["focusout","change","keyup"].forEach(ev => {
      phone.addEventListener(ev, () => { paused = false; }, { passive: true });
    });

    // ====== Build UI lists ======
    function makeAvatarSVG(a, b, vibe){
      return `
        <svg viewBox="0 0 120 120" class="w-full h-full" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="${a}" stop-opacity="0.95"/>
              <stop offset="1" stop-color="${b}" stop-opacity="0.95"/>
            </linearGradient>
            <radialGradient id="shine" cx="30%" cy="25%" r="60%">
              <stop offset="0" stop-color="white" stop-opacity="0.85"/>
              <stop offset="1" stop-color="white" stop-opacity="0"/>
            </radialGradient>
          </defs>
          <circle cx="60" cy="60" r="52" fill="url(#g)" opacity="0.92"/>
          <circle cx="60" cy="60" r="52" fill="rgba(0,0,0,0.10)"/>
          <circle cx="45" cy="42" r="32" fill="url(#shine)" opacity="0.35"/>
          <path d="M30 68c8 14 52 14 60 0" stroke="rgba(0,0,0,0.35)" stroke-width="6" stroke-linecap="round" fill="none"/>
          <circle cx="43" cy="56" r="7" fill="rgba(0,0,0,0.40)"/>
          <circle cx="77" cy="56" r="7" fill="rgba(0,0,0,0.40)"/>
          <text x="60" y="98" text-anchor="middle" font-size="20" fill="rgba(255,255,255,0.9)">${vibe}</text>
        </svg>
      `;
    }

    function renderAvatars(){
      avatarGrid.innerHTML = avatars.map(av => {
        const selected = state.avatarId === av.id;
        return `
          <button type="button" data-avid="${av.id}" class="group relative aspect-square rounded-3xl overflow-hidden border ${selected ? "border-white/45 bg-white/12" : "border-white/12 bg-white/6"} hover:bg-white/10 active:scale-[.98] transition">
            <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition bg-white/5"></div>
            <div class="absolute inset-0 p-3">
              <div class="w-full h-full rounded-2xl overflow-hidden bg-black/20 border border-white/10">
                ${makeAvatarSVG(av.a, av.b, av.vibe)}
              </div>
            </div>
            <div class="absolute bottom-2 right-2 left-2 flex items-center justify-between text-[11px] text-white/80">
              <span class="truncate">${av.label}</span>
              <span class="${selected ? "opacity-100" : "opacity-40"}">âœ¦</span>
            </div>
          </button>
        `;
      }).join("");

      avatarGrid.querySelectorAll("button[data-avid]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = Number(btn.getAttribute("data-avid"));
          state.avatarId = id;
          const r = btn.getBoundingClientRect();
          sparkle(r.left + r.width/2, r.top + r.height/2);
          renderAvatars();
          updateNextEnabled();
        });
      });
    }

    function renderInterests(){
      interestChips.innerHTML = interests.map(x => {
        const on = state.interests.includes(x);
        return `
          <button type="button" class="chip chipBtn rounded-full px-4 py-2 text-sm hover:bg-white/10 active:scale-[.98] transition"
                  aria-pressed="${on ? "true" : "false"}" data-interest="${x}">
            ${x}
          </button>
        `;
      }).join("");

      interestChips.querySelectorAll(".chipBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          const val = btn.getAttribute("data-interest");
          const on = state.interests.includes(val);

          if (on){
            state.interests = state.interests.filter(i => i !== val);
          } else {
            if (state.interests.length >= 3){
              toastify("Ø­Ø¯Ù‘ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª", "Ø§Ø®ØªØ± 3 ÙÙ‚Ø·. Ø´ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ø£ÙˆÙ„Ø§Ù‹.");
              nudgeInvalid();
              return;
            }
            state.interests = [...state.interests, val];
          }

          const r = btn.getBoundingClientRect();
          sparkle(r.left + r.width/2, r.top + 6);
          interestCount.textContent = `${state.interests.length} / 3`;
          renderInterests();
          updateNextEnabled();
        });
      });

      interestCount.textContent = `${state.interests.length} / 3`;
    }

    function renderCelebs(){
      celebsEl.innerHTML = celebs.map(c => {
        const on = state.follows.includes(c.id);
        return `
          <button type="button" data-celeb="${c.id}"
                  class="celebCard text-right rounded-2xl px-4 py-3 border ${on ? "border-emerald-200/35 bg-emerald-200/10" : "border-white/12 bg-white/6"} hover:bg-white/10 active:scale-[.99] transition relative overflow-hidden">
            <div class="absolute inset-0 opacity-40 pointer-events-none"
                 style="background: radial-gradient(600px 200px at 20% 30%, rgba(16,185,129,.16), transparent 60%),
                                radial-gradient(600px 200px at 80% 70%, rgba(59,130,246,.12), transparent 60%);"></div>

            <div class="relative flex items-center justify-between gap-3">
              <div>
                <div class="text-xs text-white/60">${c.badge}</div>
                <div class="font-semibold">${c.name}</div>
                <div class="text-xs text-white/65 mt-0.5">${c.tag}</div>
              </div>
              <div class="shrink-0">
                <span class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs border ${on ? "border-emerald-200/35 bg-emerald-200/10 text-emerald-100" : "border-white/14 bg-white/8 text-white/80"}">
                  ${on ? "âœ“ Ù…ØªØ§Ø¨Ø¹" : "+ Ù…ØªØ§Ø¨Ø¹Ø©"}
                </span>
              </div>
            </div>
          </button>
        `;
      }).join("");

      celebsEl.querySelectorAll(".celebCard").forEach(card => {
        card.addEventListener("click", () => {
          const id = card.getAttribute("data-celeb");
          const on = state.follows.includes(id);

          if (on){
            state.follows = state.follows.filter(x => x !== id);
          } else {
            if (state.follows.length >= 3){
              toastify("ÙƒÙØ§ÙŠØ© ğŸ‘€", "Ø­Ø¯Ù‘ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© 3 Ù‡Ù†Ø§.");
              nudgeInvalid();
              return;
            }
            state.follows = [...state.follows, id];
          }

          const r = card.getBoundingClientRect();
          hudPing(r.left + r.width*0.85, r.top + r.height*0.35);
          sparkle(r.left + r.width*0.15, r.top + r.height*0.35);

          followCount.textContent = `${state.follows.length} / 3 (Ù„Ø§Ø²Ù… 2)`;
          renderCelebs();
          updateNextEnabled();
        });
      });

      followCount.textContent = `${state.follows.length} / 3 (Ù„Ø§Ø²Ù… 2)`;
    }

    function renderContentTypes(){
      contentTypesEl.innerHTML = contentTypes.map(t => {
        const on = state.contentType === t;
        return `
          <button type="button" data-ctype="${t}"
            class="rounded-2xl px-4 py-3 text-sm border ${on ? "border-white/35 bg-white/16" : "border-white/12 bg-white/6"} hover:bg-white/10 active:scale-[.98] transition">
            <div class="flex items-center justify-between">
              <span class="font-semibold">${t}</span>
              <span class="${on ? "opacity-100" : "opacity-40"}">âœ¦</span>
            </div>
          </button>
        `;
      }).join("");

      contentTypesEl.querySelectorAll("button[data-ctype]").forEach(btn => {
        btn.addEventListener("click", () => {
          state.contentType = btn.getAttribute("data-ctype");
          const r = btn.getBoundingClientRect();
          sparkle(r.left + r.width/2, r.top + 8);
          renderContentTypes();
          updateNextEnabled();
        });
      });
    }

    function renderGenres(){
      genresEl.innerHTML = genres.map(g => {
        const on = state.genres.includes(g);
        return `
          <button type="button" class="chip genreBtn rounded-full px-4 py-2 text-sm hover:bg-white/10 active:scale-[.98] transition"
                  aria-pressed="${on ? "true" : "false"}" data-genre="${g}">
            ${g}
          </button>
        `;
      }).join("");

      genresEl.querySelectorAll(".genreBtn").forEach(btn => {
        btn.addEventListener("click", () => {
          const g = btn.getAttribute("data-genre");
          const on = state.genres.includes(g);

          if (on){
            state.genres = state.genres.filter(x => x !== g);
          } else {
            if (state.genres.length >= 5){
              toastify("ÙƒÙØ§ÙŠØ© Genres", "Ø§Ù„Ø­Ø¯ 5 Ù‡Ù†Ø§.");
              nudgeInvalid();
              return;
            }
            state.genres = [...state.genres, g];
          }

          const r = btn.getBoundingClientRect();
          sparkle(r.left + r.width/2, r.top + 6);

          genreCount.textContent = `${state.genres.length} / 5 (Ù„Ø§Ø²Ù… 2)`;
          renderGenres();
          updateNextEnabled();
        });
      });

      genreCount.textContent = `${state.genres.length} / 5 (Ù„Ø§Ø²Ù… 2)`;
    }

    // ====== Story 1 handlers ======
    nameEl.addEventListener("input", () => { state.name = nameEl.value; updateNextEnabled(); });
    emailEl.addEventListener("input", () => { state.email = emailEl.value; updateNextEnabled(); });

    // ====== Story 2 handlers ======
    togglePw.addEventListener("click", () => {
      pwEl.type = (pwEl.type === "password") ? "text" : "password";
      const r = togglePw.getBoundingClientRect();
      sparkle(r.left + 8, r.top + 8);
    });

    pwEl.addEventListener("input", () => {
      state.password = pwEl.value;
      const s = pwScore(state.password);
      const pct = (s / 5) * 100;
      pwBar.style.width = pct.toFixed(0) + "%";

      let label = "Ø¶Ø¹ÙŠÙ";
      if (s >= 4) label = "Ù‚ÙˆÙŠ";
      else if (s >= 3) label = "Ù…ØªÙˆØ³Ø·";
      pwLabel.textContent = label;

      const show = s < 3 && state.password.length > 0;
      pwHint.classList.toggle("opacity-0", !show);
      pwHint.classList.toggle("translate-y-[-6px]", !show);
      pwHint.classList.toggle("opacity-100", show);
      pwHint.classList.toggle("translate-y-0", show);

      updateNextEnabled();
    });

    // ====== Story 3 random ======
    randomAvatar.addEventListener("click", () => {
      const pick = avatars[Math.floor(Math.random() * avatars.length)];
      state.avatarId = pick.id;
      toastify("Ø±Ø§Ù†Ø¯ÙˆÙ…!", `Ø§Ø®ØªÙŠØ§Ø±: ${pick.label} ${pick.vibe}`);
      renderAvatars();
      updateNextEnabled();
      const r = randomAvatar.getBoundingClientRect();
      sparkle(r.left + r.width/2, r.top + 8);
    });

    // ====== Success actions ======
    function buildSummary(){
      const avatar = avatars.find(a => a.id === state.avatarId);
      const followsNames = state.follows.map(id => (celebs.find(c => c.id === id) || {}).name).filter(Boolean);

      welcomeLine.textContent = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${state.name ? state.name.trim() : "Ø¨Ø·Ù„"} âœ¨`;

      const parts = [
        `Avatar: <span class="font-semibold text-white">${avatar ? (avatar.label + " " + avatar.vibe) : "â€”"}</span>`,
        `Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª: <span class="font-semibold text-white">${state.interests.join(" Â· ") || "â€”"}</span>`,
        `Ù…ØªØ§Ø¨Ø¹Ø©: <span class="font-semibold text-white">${followsNames.join(" Â· ") || "â€”"}</span>`,
        `Ù†ÙˆØ¹: <span class="font-semibold text-white">${state.contentType || "â€”"}</span>`,
        `Genres: <span class="font-semibold text-white">${state.genres.join(" Â· ") || "â€”"}</span>`
      ];
      summaryEl.innerHTML = parts.join("<br/>");
    }

    startBtn.addEventListener("click", () => {
      toastify("ØªÙ… Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ ğŸš€", "Ø´ÙˆÙ Ø§Ù„Ù€ console Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
      console.log("Signup state:", JSON.parse(JSON.stringify(state)));
      const r = startBtn.getBoundingClientRect();
      sparkle(r.left + r.width/2, r.top + 10);
    });

    restartBtn.addEventListener("click", () => {
      Object.assign(state, { name:"", email:"", password:"", avatarId:null, interests:[], follows:[], contentType:null, genres:[] });

      nameEl.value = "";
      emailEl.value = "";
      pwEl.value = "";
      pwBar.style.width = "0%";
      pwLabel.textContent = "â€”";
      pwHint.classList.add("opacity-0","translate-y-[-6px]");
      pwHint.classList.remove("opacity-100","translate-y-0");

      renderAvatars();
      renderInterests();
      renderCelebs();
      renderContentTypes();
      renderGenres();

      toastify("Ø±Ø¬Ø¹Ù†Ø§!", "Ù†ÙØ³ Ø§Ù„Ø³ØªÙˆØ±ÙŠâ€¦ Ø¨Ø³ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.");
      go(0);
    });

    // ====== Petals for sakura bg ======
    function buildPetals(){
      const wrap = document.getElementById("petals");
      wrap.innerHTML = "";
      const count = 18;
      for (let i=0;i<count;i++){
        const p = document.createElement("div");
        p.className = "petal";
        const left = Math.random() * 100;
        const dur = 7 + Math.random() * 7;
        const delay = -Math.random() * dur;
        const size = 10 + Math.random() * 10;
        p.style.left = left + "vw";
        p.style.width = size + "px";
        p.style.height = (size * 0.72) + "px";
        p.style.animationDuration = dur + "s";
        p.style.animationDelay = delay + "s";
        p.style.opacity = (0.55 + Math.random() * 0.35).toFixed(2);
        p.style.filter = `drop-shadow(0 ${4+Math.random()*8}px ${10+Math.random()*18}px rgba(0,0,0,.28))`;
        wrap.appendChild(p);
      }
    }

    // ====== Galaxy bg (canvas) ======
    const gCanvas = document.getElementById("galaxyCanvas");
    const gCtx = gCanvas.getContext("2d");
    let stars = [];

    function resizeCanvas(c){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const rect = c.getBoundingClientRect();
      c.width = Math.floor(rect.width * dpr);
      c.height = Math.floor(rect.height * dpr);
      return { w: c.width, h: c.height, dpr };
    }

    function initStars(){
      const { w, h } = resizeCanvas(gCanvas);
      const n = 120;
      stars = Array.from({length:n}, () => ({
        x: Math.random()*w,
        y: Math.random()*h,
        z: 0.4 + Math.random()*0.9,
        r: 0.6 + Math.random()*1.6,
        tw: Math.random()*Math.PI*2
      }));
    }

    function drawGalaxy(){
      const w = gCanvas.width, h = gCanvas.height;
      gCtx.clearRect(0,0,w,h);

      const grad = gCtx.createRadialGradient(w*0.65, h*0.25, 10, w*0.65, h*0.25, Math.max(w,h)*0.65);
      grad.addColorStop(0, "rgba(168,85,247,0.14)");
      grad.addColorStop(0.5, "rgba(34,211,238,0.08)");
      grad.addColorStop(1, "rgba(0,0,0,0)");
      gCtx.fillStyle = grad;
      gCtx.fillRect(0,0,w,h);

      for (const s of stars){
        s.tw += 0.02 * s.z;
        s.y += 0.12 * s.z;
        s.x += 0.03 * s.z;

        if (s.y > h + 10) s.y = -10;
        if (s.x > w + 10) s.x = -10;

        const a = 0.35 + 0.45 * (0.5 + 0.5*Math.sin(s.tw));
        gCtx.beginPath();
        gCtx.fillStyle = `rgba(255,255,255,${a})`;
        gCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        gCtx.fill();
      }

      requestAnimationFrame(drawGalaxy);
    }

    // ====== Confetti (canvas) ======
    const cCanvas = document.getElementById("confettiCanvas");
    const cCtx = cCanvas.getContext("2d");
    let confetti = [];
    let confettiOn = false;
    let confettiRaf = null;

    function initConfetti(){
      const { w, h } = resizeCanvas(cCanvas);
      const n = 130;
      confetti = Array.from({length:n}, () => ({
        x: Math.random()*w,
        y: -Math.random()*h,
        vx: (-0.5 + Math.random()) * 1.2,
        vy: 1.3 + Math.random()*2.7,
        s: 5 + Math.random()*8,
        r: Math.random()*Math.PI,
        vr: (-0.5 + Math.random())*0.2,
        a: 0.6 + Math.random()*0.4
      }));
    }

    function drawConfetti(){
      if (!confettiOn) return;
      const w = cCanvas.width, h = cCanvas.height;
      cCtx.clearRect(0,0,w,h);

      for (const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.r += p.vr;

        if (p.y > h + 20){
          p.y = -20;
          p.x = Math.random()*w;
          p.vy = 1.3 + Math.random()*2.7;
        }
        if (p.x < -20) p.x = w + 20;
        if (p.x > w + 20) p.x = -20;

        cCtx.save();
        cCtx.translate(p.x, p.y);
        cCtx.rotate(p.r);

        const hue = (((p.x / w) * 360) + ((p.y / h) * 120)) % 360;
        cCtx.fillStyle = `hsla(${hue}, 90%, 70%, ${p.a})`;
        cCtx.fillRect(-p.s/2, -p.s/2, p.s, p.s*0.6);

        cCtx.restore();
      }

      confettiRaf = requestAnimationFrame(drawConfetti);
    }

    function startConfetti(){
      if (confettiOn) return;
      confettiOn = true;
      initConfetti();
      drawConfetti();
    }
    function stopConfetti(){
      confettiOn = false;
      if (confettiRaf) cancelAnimationFrame(confettiRaf);
      confettiRaf = null;
      if (cCtx) cCtx.clearRect(0,0,cCanvas.width,cCanvas.height);
    }

    // ====== Resize handling ======
    function onResize(){
      updateTrack();
      initStars();
      if (!confettiOn) resizeCanvas(cCanvas);
      else initConfetti();
    }
    window.addEventListener("resize", onResize);

    // ====== Init ======
    function init(){
      // âœ… ØªØ£ÙƒÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ†Ù‡ ÙŠØ³Ø§Ø¹Ø¯ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
      track.style.width = (TOTAL * 100) + "%";

      buildPetals();

      renderAvatars();
      renderInterests();
      renderCelebs();
      renderContentTypes();
      renderGenres();

      interestCount.textContent = `${state.interests.length} / 3`;
      followCount.textContent = `${state.follows.length} / 3 (Ù„Ø§Ø²Ù… 2)`;
      genreCount.textContent = `${state.genres.length} / 5 (Ù„Ø§Ø²Ù… 2)`;

      initStars();
      requestAnimationFrame(drawGalaxy);

      setBg(0);

      // âœ… Ù†ÙÙ‘Ø° Ø¨Ø¹Ø¯ Ø±Ù†Ø¯Ø± ÙˆØ§Ø­Ø¯ Ù„Ø¶Ù…Ø§Ù† Ù‚ÙŠØ§Ø³ viewport.clientWidth ØµØ­ÙŠØ­
      requestAnimationFrame(updateTrack);

      setTimeout(() => {
        const r = phone.getBoundingClientRect();
        sparkle(r.left + r.width*0.55, r.top + 120);
      }, 450);
    }

    setAuto(false);
    init();
  </script>
</body>
</html>
