<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Magical Girl Pastel â€” Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ø®Ø·ÙˆØ§Øª)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Smooth UI + cute micro-interactions */
    :root{
      --bg1:#fff1fb;
      --bg2:#eef7ff;
      --bg3:#f4fff4;
      --ink:#2b2250;
      --muted:#6b5a8f;
      --ring:#ff78c7;
      --glow:#ffd6f0;
      --card: rgba(255,255,255,.72);
    }
    html,body{height:100%}
    body{
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Arabic", "Noto Kufi Arabic", Arial, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(255,120,199,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(131,210,255,.22), transparent 55%),
        radial-gradient(900px 700px at 40% 95%, rgba(170,255,195,.18), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      overflow-x:hidden;
    }
    /* Floating sparkles background (SVG shapes) */
    .floating{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.9;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.06));
    }
    .float{
      position:absolute;
      animation: drift 12s linear infinite;
      opacity:.45;
    }
    @keyframes drift{
      0%{ transform: translate3d(0,0,0) rotate(0deg) scale(1); }
      50%{ transform: translate3d(20px, -40px, 0) rotate(10deg) scale(1.03); }
      100%{ transform: translate3d(0,-120px,0) rotate(0deg) scale(1); }
    }

    /* Card look */
    .glass{
      background: var(--card);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow:
        0 12px 30px rgba(35,24,69,.08),
        0 2px 0 rgba(255,255,255,.5) inset;
    }

    /* Inputs */
    .input{
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(140, 109, 190, .22);
      outline: none;
      transition: box-shadow .2s ease, transform .15s ease, border-color .2s ease;
    }
    .input:focus{
      border-color: rgba(255,120,199,.65);
      box-shadow: 0 0 0 5px rgba(255,120,199,.18);
      transform: translateY(-1px);
    }

    /* Chips */
    .chip{
      border: 1px solid rgba(140,109,190,.22);
      background: rgba(255,255,255,.7);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .chip:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(35,24,69,.08);
    }
    .chip[data-selected="true"]{
      border-color: rgba(255,120,199,.7);
      background:
        linear-gradient(135deg, rgba(255,120,199,.24), rgba(131,210,255,.18), rgba(170,255,195,.18));
      box-shadow: 0 0 0 5px rgba(255,120,199,.12);
    }

    /* Cute error bubble */
    .error-bubble{
      background: rgba(255, 77, 124, .10);
      border: 1px solid rgba(255, 77, 124, .28);
      color: #7a1533;
    }
    .hint-bubble{
      background: rgba(131,210,255,.12);
      border: 1px solid rgba(131,210,255,.26);
      color: #234063;
    }

    /* Step transitions + sparkle */
    .step{
      display:none;
      animation: popIn .35s ease both;
    }
    .step.active{display:block}
    @keyframes popIn{
      from{ opacity:0; transform: translateY(10px) scale(.99); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .sparkle-layer{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
      border-radius: 1.5rem;
    }
    .sparkle{
      position:absolute;
      width:12px; height:12px;
      opacity:0;
      animation: sparkle .65s ease forwards;
      filter: drop-shadow(0 10px 18px rgba(255,120,199,.18));
    }
    @keyframes sparkle{
      0%{ transform: translate3d(var(--x), var(--y), 0) scale(.6) rotate(0deg); opacity:0; }
      20%{ opacity:.9; }
      100%{ transform: translate3d(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy)), 0) scale(1.25) rotate(35deg); opacity:0; }
    }

    /* Magic wand progress bar */
    .wand{
      position:relative;
      height: 18px;
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(140,109,190,.22);
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(35,24,69,.08);
    }
    .wand::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(circle at 20% 50%, rgba(255,120,199,.22), transparent 35%),
                  radial-gradient(circle at 70% 50%, rgba(131,210,255,.18), transparent 40%);
      opacity:.9;
    }
    .wandFill{
      position:absolute; top:0; bottom:0;
      left:0;
      width:0%;
      background: linear-gradient(90deg,
        rgba(255,120,199,.85),
        rgba(131,210,255,.85),
        rgba(170,255,195,.85)
      );
      border-radius: 999px;
      box-shadow: 0 0 0 5px rgba(255,120,199,.10);
      transition: width .35s ease;
    }
    .wandTip{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width: 42px; height: 42px;
      border-radius: 999px;
      background: rgba(255,255,255,.80);
      border: 1px solid rgba(255,120,199,.35);
      box-shadow: 0 14px 28px rgba(35,24,69,.10);
      display:grid; place-items:center;
      transition: right .35s ease;
    }
    .wandTip .inner{
      width: 30px; height: 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,120,199,.25), rgba(131,210,255,.20), rgba(170,255,195,.18));
      border: 1px solid rgba(140,109,190,.18);
      display:grid; place-items:center;
    }

    .toggle{
      width: 46px; height: 26px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(140,109,190,.22);
      border-radius: 999px;
      position:relative;
      transition: background .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .toggle::after{
      content:"";
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      right: 3px;
      width: 20px; height: 20px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(140,109,190,.22);
      box-shadow: 0 10px 16px rgba(35,24,69,.10);
      transition: right .2s ease, background .2s ease;
    }
    .toggle[data-on="true"]{
      background: rgba(255,120,199,.18);
      border-color: rgba(255,120,199,.35);
      box-shadow: 0 0 0 5px rgba(255,120,199,.12);
    }
    .toggle[data-on="true"]::after{ right: 23px; }

    /* Dark mode (cute night) */
    body[data-theme="night"]{
      --ink:#f7f2ff;
      --muted:#d6c9ff;
      --card: rgba(24, 18, 45, .62);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(255,120,199,.20), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(131,210,255,.18), transparent 55%),
        radial-gradient(900px 700px at 40% 95%, rgba(170,255,195,.14), transparent 55%),
        linear-gradient(135deg, #0f0b1f, #151132, #0e1a2a);
    }
    body[data-theme="night"] .input{ background: rgba(255,255,255,.10); color: var(--ink); }
    body[data-theme="night"] .glass{ border-color: rgba(255,255,255,.14); }
    body[data-theme="night"] .chip{ background: rgba(255,255,255,.10); }
    body[data-theme="night"] .wand{ background: rgba(255,255,255,.10); }
    body[data-theme="night"] .wandTip{ background: rgba(255,255,255,.12); }
    body[data-theme="night"] .toggle{ background: rgba(255,255,255,.10); }
    body[data-theme="night"] .hint-bubble{ background: rgba(131,210,255,.10); border-color: rgba(131,210,255,.22); color: #cfe9ff; }
    body[data-theme="night"] .error-bubble{ background: rgba(255, 77, 124, .12); border-color: rgba(255, 77, 124, .28); color: #ffd2df; }

    /* Avatar preview frame */
    .frame{
      position:relative;
      border-radius: 999px;
      width: 140px; height: 140px;
      display:grid; place-items:center;
      box-shadow: 0 18px 40px rgba(35,24,69,.12);
      border: 2px solid rgba(255,255,255,.65);
      overflow:hidden;
      background: rgba(255,255,255,.35);
    }
    .frameInner{
      width: 110px; height: 110px;
      border-radius: 999px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(140,109,190,.20);
      overflow:hidden;
    }
    .softShadow{ box-shadow: 0 12px 30px rgba(35,24,69,.10); }
  </style>
</head>

<body class="min-h-screen">
  <!-- floating background -->
  <div class="floating" aria-hidden="true">
    <!-- stars + hearts -->
    <svg class="float" style="right:6%; top:14%; width:90px; height:90px; animation-duration: 14s;" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#ff78c7" stop-opacity=".85"/>
          <stop offset="1" stop-color="#83d2ff" stop-opacity=".75"/>
        </linearGradient>
      </defs>
      <path fill="url(#g1)" d="M50 6 L61 35 L92 38 L67 57 L75 88 L50 71 L25 88 L33 57 L8 38 L39 35 Z"/>
    </svg>

    <svg class="float" style="left:8%; top:30%; width:74px; height:74px; animation-duration: 16s;" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#aaffc3" stop-opacity=".85"/>
          <stop offset="1" stop-color="#ff78c7" stop-opacity=".70"/>
        </linearGradient>
      </defs>
      <path fill="url(#g2)" d="M50 86 C25 70 10 55 10 38 C10 26 19 18 31 18 C39 18 46 22 50 28 C54 22 61 18 69 18 C81 18 90 26 90 38 C90 55 75 70 50 86 Z"/>
    </svg>

    <svg class="float" style="right:18%; bottom:16%; width:110px; height:110px; animation-duration: 18s;" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="g3" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#83d2ff" stop-opacity=".85"/>
          <stop offset="1" stop-color="#ffd6f0" stop-opacity=".80"/>
        </linearGradient>
      </defs>
      <path fill="url(#g3)" d="M50 8 L58 34 L85 35 L63 52 L70 80 L50 64 L30 80 L37 52 L15 35 L42 34 Z"/>
    </svg>

    <svg class="float" style="left:16%; bottom:10%; width:86px; height:86px; animation-duration: 15s;" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="g4" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#ffd6f0" stop-opacity=".90"/>
          <stop offset="1" stop-color="#83d2ff" stop-opacity=".70"/>
        </linearGradient>
      </defs>
      <path fill="url(#g4)" d="M50 12 L57 38 L84 39 L62 55 L69 82 L50 66 L31 82 L38 55 L16 39 L43 38 Z"/>
    </svg>
  </div>

  <main class="relative z-10">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10">
      <!-- Header -->
      <header class="flex flex-col gap-4 sm:gap-5">
        <div class="flex items-start justify-between gap-4">
          <div class="space-y-1">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full glass">
              <span class="text-sm font-semibold">âœ¨ Magical Girl Pastel</span>
              <span class="text-xs opacity-80">ØªØ³Ø¬ÙŠÙ„ Ù„Ø·ÙŠÙ Ø¬Ø¯Ù‹Ø§ â€¢ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</span>
            </div>
            <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
              Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„Ø© Ø§Ù„Ø³Ø­Ø±! ğŸŒ™ğŸ’–
            </h1>
            <p class="text-sm sm:text-base opacity-80 max-w-2xl">
              Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†ØµÙ†Ø¹ Ù‡ÙˆÙŠØªÙƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹: Ø§Ø³Ù… + Ù„Ù‚Ø¨ Ø³Ø­Ø±ÙŠ + Ø£ÙØ§ØªØ§Ø± + Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øªâ€¦ ÙˆØ¨Ø§Ù„Ø£Ø®ÙŠØ± ØªØ¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©!
            </p>
          </div>

          <!-- Theme toggle -->
          <div class="glass rounded-2xl p-3 sm:p-4 flex items-center gap-3 softShadow">
            <div class="text-right">
              <div class="text-sm font-bold">ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</div>
              <div class="text-xs opacity-75">Moonlight Mode</div>
            </div>
            <button id="nightToggle" type="button" class="toggle" data-on="false" aria-label="Toggle night mode"></button>
          </div>
        </div>

        <!-- Magic wand progress -->
        <section class="glass rounded-3xl p-4 sm:p-5 relative overflow-hidden">
          <div class="flex items-center justify-between gap-3">
            <div class="flex items-center gap-2">
              <span class="text-sm font-bold">Ø¹ØµØ§ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø³Ø­Ø±ÙŠØ©</span>
              <span id="stepLabel" class="text-xs opacity-75">Ø§Ù„Ø®Ø·ÙˆØ© 1 Ù…Ù† 8</span>
            </div>
            <div class="text-xs opacity-75" id="progressHint">âœ¨ Ù„Ù…Ø¹Ø© ØµØºÙŠØ±Ø© Ø¹Ù†Ø¯ ÙƒÙ„ Ø§Ù†ØªÙ‚Ø§Ù„</div>
          </div>

          <div class="mt-3 relative">
            <div class="wand" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div id="wandFill" class="wandFill"></div>
              <div id="wandTip" class="wandTip" style="right: calc(100% - 21px);" aria-hidden="true">
                <div class="inner">
                  <svg width="18" height="18" viewBox="0 0 100 100" aria-hidden="true">
                    <path fill="rgba(255,120,199,.9)" d="M50 8 L58 34 L85 35 L63 52 L70 80 L50 64 L30 80 L37 52 L15 35 L42 34 Z"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="mt-3 flex flex-wrap gap-2 text-xs opacity-80">
              <span class="px-2 py-1 rounded-full glass">ğŸŒŸ Ø³Ø±ÙŠØ¹</span>
              <span class="px-2 py-1 rounded-full glass">ğŸ’— Ù„Ø·ÙŠÙ</span>
              <span class="px-2 py-1 rounded-full glass">ğŸª„ ØªÙØ§Ø¹Ù„Ø§Øª ØµØºÙŠØ±Ø©</span>
              <span class="px-2 py-1 rounded-full glass">ğŸ“± Responsive</span>
            </div>
          </div>
        </section>
      </header>

      <!-- Layout: left form + right summary preview -->
      <div class="mt-6 sm:mt-8 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Form panel -->
        <section class="lg:col-span-8">
          <div id="card" class="glass rounded-[2rem] p-4 sm:p-6 relative">
            <div id="sparkleLayer" class="sparkle-layer" aria-hidden="true"></div>

            <!-- top actions -->
            <div class="flex items-center justify-between gap-3">
              <div class="text-sm font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ âœ¨</div>
              <div class="flex items-center gap-2">
                <button id="btnBackTop" type="button" class="px-3 py-2 rounded-2xl glass text-sm font-semibold hover:translate-y-[-1px] transition disabled:opacity-50 disabled:cursor-not-allowed">
                  Ø±Ø¬ÙˆØ¹
                </button>
                <button id="btnNextTop" type="button" class="px-3 py-2 rounded-2xl bg-white/70 border border-white/60 text-sm font-extrabold shadow-sm hover:translate-y-[-1px] transition">
                  Ø§Ù„ØªØ§Ù„ÙŠ âœ¨
                </button>
              </div>
            </div>

            <div id="globalError" class="mt-4 hidden error-bubble rounded-2xl px-4 py-3 text-sm"></div>

            <!-- Steps -->
            <form id="form" class="mt-4 sm:mt-5 space-y-6" autocomplete="on">
              <!-- STEP 1 -->
              <div class="step active" data-step="1">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <h2 class="text-lg sm:text-xl font-extrabold">1) Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ + Ù„Ù‚Ø¨ Ø³Ø­Ø±ÙŠ</h2>
                    <p class="text-sm opacity-80 mt-1">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ø³Ù…Ù‹Ø§ Ù„Ø·ÙŠÙÙ‹Ø§ØŒ Ø«Ù… Ù„Ù‚Ø¨ÙŠ Ù†ÙØ³Ùƒ Ø¨Ù„Ù‚Ø¨ Ø³Ø­Ø±ÙŠ Ù…Ù† Ø§Ù„Ù€chips ğŸŒ¸</p>
                  </div>
                  <div class="hidden sm:block glass rounded-2xl px-3 py-2 text-xs">
                    ğŸ’¡ Ù…Ø«Ø§Ù„: <span class="font-bold">LunaSora</span> + <span class="font-bold">Star Guardian</span>
                  </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                  <label class="block">
                    <span class="text-sm font-semibold">Ø§Ø³Ù…Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</span>
                    <input id="communityName" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ù…Ø«Ø§Ù„: pastelLuffy" />
                    <div id="errCommunityName" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </label>

                  <label class="block">
                    <span class="text-sm font-semibold">Ø§Ù„Ù„Ù‚Ø¨ Ø§Ù„Ø³Ø­Ø±ÙŠ (Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯)</span>
                    <input id="magicalTitle" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ø³ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±" readonly />
                    <div id="errMagicalTitle" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </label>
                </div>

                <div class="mt-3 glass rounded-3xl p-4">
                  <div class="text-sm font-bold">Chips Ø§Ù„Ø£Ù„Ù‚Ø§Ø¨ Ø§Ù„Ø³Ø­Ø±ÙŠØ©</div>
                  <div id="titleChips" class="mt-3 flex flex-wrap gap-2">
                    <!-- injected -->
                  </div>
                  <div class="mt-3 text-xs opacity-80">
                    âœ¨ ØªÙ„Ù…ÙŠØ­: Ø§Ø®ØªØ§Ø±ÙŠ Ù„Ù‚Ø¨Ù‹Ø§ ÙŠØ¹ÙƒØ³ Ø·Ø§Ù‚ØªÙƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ (Ù…Ø±Ø§Ø¬Ø¹Ø§Øª / Ø±Ø³Ù… / ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ / Ù†Ù‚Ø§Ø´Ø§Øªâ€¦)
                  </div>
                </div>
              </div>

              <!-- STEP 2 -->
              <div class="step" data-step="2">
                <h2 class="text-lg sm:text-xl font-extrabold">2) Email + Password</h2>
                <p class="text-sm opacity-80 mt-1">Ø¨Ù†ØµØ§Ø¦Ø­ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¢Ù…Ù†Ø© + Ø²Ø± Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ğŸ—ï¸</p>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                  <label class="block">
                    <span class="text-sm font-semibold">Email</span>
                    <input id="email" type="email" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="you@magic.world" autocomplete="email" />
                    <div id="errEmail" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </label>

                  <div class="block">
                    <div class="flex items-center justify-between">
                      <span class="text-sm font-semibold">Password</span>
                      <button id="togglePass" type="button" class="text-xs font-bold px-3 py-1 rounded-full glass hover:translate-y-[-1px] transition">
                        Ø¥Ø¸Ù‡Ø§Ø± ğŸ‘€
                      </button>
                    </div>
                    <input id="password" type="password" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" />
                    <div id="errPassword" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </div>
                </div>

                <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="hint-bubble rounded-3xl p-4">
                    <div class="text-sm font-bold">ØªÙ„Ù…ÙŠØ­Ø§Øª ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¢Ù…Ù†Ø© âœ¨</div>
                    <ul class="mt-2 text-sm leading-7">
                      <li id="pwLen">â€¢ 8 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±</li>
                      <li id="pwMix">â€¢ Ø­Ø±ÙˆÙ + Ø£Ø±Ù‚Ø§Ù…</li>
                      <li id="pwSym">â€¢ Ø±Ù…Ø² ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ù…Ø«Ù„ ! @ #)</li>
                    </ul>
                  </div>
                  <div class="glass rounded-3xl p-4">
                    <div class="text-sm font-bold">Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ’ª</div>
                    <div class="mt-3 wand h-4" aria-hidden="true">
                      <div id="pwBar" class="wandFill" style="width:0%"></div>
                    </div>
                    <div id="pwStrengthText" class="mt-2 text-xs opacity-80">Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø©â€¦</div>
                    <div class="mt-3 text-xs opacity-75">ğŸ’– Ù„Ø§ ØªÙ‚Ù„Ù‚ÙŠ â€” Ø³Ù†Ø°ÙƒÙ‘Ø±Ùƒ Ø¨Ù„Ø·Ù Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¶Ø¹ÙŠÙØ©.</div>
                  </div>
                </div>
              </div>

              <!-- STEP 3 -->
              <div class="step" data-step="3">
                <h2 class="text-lg sm:text-xl font-extrabold">3) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©</h2>
                <p class="text-sm opacity-80 mt-1">Pronouns Ø§Ø®ØªÙŠØ§Ø±ÙŠ + Ø¨Ù„Ø¯/Ù…Ø¯ÙŠÙ†Ø© + Ù†Ø¨Ø°Ø© â€œÙÙ‚Ø§Ø¹Ø© ÙŠÙˆÙ…ÙŠØ§Øªâ€ ğŸ«§</p>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                  <label class="block">
                    <span class="text-sm font-semibold">Pronouns (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                    <input id="pronouns" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ù…Ø«Ø§Ù„: she/her Ø£Ùˆ he/him Ø£Ùˆ they/them" />
                  </label>

                  <div class="grid grid-cols-2 gap-3">
                    <label class="block">
                      <span class="text-sm font-semibold">Ø§Ù„Ø¨Ù„Ø¯</span>
                      <input id="country" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ù…Ø«Ø§Ù„: ÙÙ„Ø³Ø·ÙŠÙ†" />
                      <div id="errCountry" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                    </label>
                    <label class="block">
                      <span class="text-sm font-semibold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span>
                      <input id="city" class="input mt-2 w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ø¯Ø³" />
                      <div id="errCity" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                    </label>
                  </div>
                </div>

                <label class="block mt-4">
                  <span class="text-sm font-semibold">Ù†Ø¨Ø°Ø© â€œÙÙ‚Ø§Ø¹Ø© ÙŠÙˆÙ…ÙŠØ§Øªâ€</span>
                  <textarea id="diaryBubble" class="input mt-2 w-full rounded-3xl px-4 py-3 text-sm min-h-[120px]" placeholder="Ø§ÙƒØªØ¨ÙŠ 1-2 Ø³Ø·Ø± Ø¹Ù† Ù…Ø²Ø§Ø¬Ùƒ/Ø°ÙˆÙ‚Ùƒ/Ù‡Ø¯ÙÙƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹â€¦"></textarea>
                  <div class="mt-2 flex items-center justify-between text-xs opacity-75">
                    <span id="diaryCount">0 / 160</span>
                    <span>ğŸ«§ Ø®Ù„ÙŠÙ‡Ø§ Ù„Ø·ÙŠÙØ© ÙˆØ®ÙÙŠÙØ©!</span>
                  </div>
                  <div id="errDiary" class="mt-2 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                </label>
              </div>

              <!-- STEP 4 -->
              <div class="step" data-step="4">
                <h2 class="text-lg sm:text-xl font-extrabold">4) Ø§Ø®ØªÙŠØ§Ø± Ø£ÙØ§ØªØ§Ø± â€” Magic Wardrobe</h2>
                <p class="text-sm opacity-80 mt-1">Ø§Ø®ØªØ§Ø±ÙŠ Ø¥Ø·Ø§Ø± + Ù„ÙˆÙ† + Ø´ÙƒÙ„â€¦ ÙˆØ§Ù„Ù€preview ÙŠØªØºÙŠØ± ÙÙˆØ±Ù‹Ø§ ğŸ€</p>

                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-5">
                  <div class="glass rounded-3xl p-4">
                    <div class="text-sm font-bold">Preview</div>
                    <div class="mt-4 flex items-center justify-center">
                      <div id="avatarFrame" class="frame">
                        <div id="avatarFrameDeco" class="absolute inset-0 opacity-90"></div>
                        <div id="avatarInner" class="frameInner">
                          <!-- avatar svg -->
                          <svg id="avatarSvg" width="84" height="84" viewBox="0 0 100 100" aria-hidden="true">
                            <defs>
                              <linearGradient id="faceGrad" x1="0" y1="0" x2="1" y2="1">
                                <stop offset="0" stop-color="rgba(255,255,255,.95)"/>
                                <stop offset="1" stop-color="rgba(255,255,255,.75)"/>
                              </linearGradient>
                            </defs>
                            <circle cx="50" cy="50" r="44" fill="url(#faceGrad)" stroke="rgba(140,109,190,.18)" stroke-width="2"/>
                            <circle cx="36" cy="46" r="5" fill="rgba(35,24,69,.65)"/>
                            <circle cx="64" cy="46" r="5" fill="rgba(35,24,69,.65)"/>
                            <path d="M36 67 C44 74 56 74 64 67" fill="none" stroke="rgba(255,120,199,.75)" stroke-width="4" stroke-linecap="round"/>
                            <path id="avatarShape" d="" fill="none"/>
                          </svg>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4 text-xs opacity-80 text-center">
                      âœ¨ Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ â€œØ³Ø­Ø± Ø¨Ø³ÙŠØ·â€ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </div>
                  </div>

                  <div class="space-y-4">
                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ø§Ù„Ø¥Ø·Ø§Ø± (Frame)</div>
                      <div id="frameChips" class="mt-3 flex flex-wrap gap-2"></div>
                      <div id="errFrame" class="mt-3 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                    </div>

                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ù„ÙˆÙ† Ø§Ù„Ø³Ø­Ø±</div>
                      <div class="mt-3 flex flex-wrap gap-2" id="colorChips"></div>
                    </div>

                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ø´ÙƒÙ„ Ø¥Ø¶Ø§ÙÙŠ (Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ¬Ù‡)</div>
                      <div id="shapeChips" class="mt-3 flex flex-wrap gap-2"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- STEP 5 -->
              <div class="step" data-step="5">
                <h2 class="text-lg sm:text-xl font-extrabold">5) Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø£Ù†Ù…ÙŠ/Ù…Ø§Ù†Ø¬Ø§/ÙƒÙˆÙ…ÙŠÙƒØ³</h2>
                <p class="text-sm opacity-80 mt-1">Checklist Ù…Ø¹ Ø¨Ø­Ø« + Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ¹ â€œTop picksâ€ ğŸ“šâœ¨</p>

                <div class="mt-4 glass rounded-3xl p-4">
                  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                    <div class="text-sm font-bold">Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ</div>
                    <div class="w-full sm:w-[320px]">
                      <input id="interestSearch" class="input w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ø§Ø¨Ø­Ø«: Ø´ÙˆÙ†ÙŠÙ†ØŒ Ø±ÙˆÙ…Ø§Ù†Ø³ØŒ Webtoon..." />
                    </div>
                  </div>

                  <div class="mt-3 flex flex-wrap gap-2">
                    <button id="topPicksBtn" type="button" class="px-3 py-2 rounded-2xl glass text-sm font-bold hover:translate-y-[-1px] transition">
                      Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ¹: Top picks â­
                    </button>
                    <button id="clearInterestsBtn" type="button" class="px-3 py-2 rounded-2xl glass text-sm font-bold hover:translate-y-[-1px] transition">
                      Ù…Ø³Ø­ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ğŸ«§
                    </button>
                    <div class="text-xs opacity-75 self-center">Ø§Ø®ØªØ§Ø±ÙŠ 3 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</div>
                  </div>

                  <div id="interestsList" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2">
                    <!-- injected -->
                  </div>

                  <div id="errInterests" class="mt-4 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                </div>
              </div>

              <!-- STEP 6 -->
              <div class="step" data-step="6">
                <h2 class="text-lg sm:text-xl font-extrabold">6) Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† â€” Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ø³Ø­Ø±</h2>
                <p class="text-sm opacity-80 mt-1">Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹ ÙÙ„Ø§ØªØ± (Ø±Ø³Ø§Ù…ÙŠÙ†/Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†/ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ) ğŸ¤âœ¨</p>

                <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
                  <div class="glass rounded-3xl p-4 lg:col-span-1">
                    <div class="text-sm font-bold">ÙÙ„Ø§ØªØ±</div>
                    <div class="mt-3 space-y-2">
                      <button class="filterBtn chip px-3 py-2 rounded-2xl text-sm font-bold w-full text-right" type="button" data-filter="all" data-selected="true">ğŸŒˆ Ø§Ù„ÙƒÙ„</button>
                      <button class="filterBtn chip px-3 py-2 rounded-2xl text-sm font-bold w-full text-right" type="button" data-filter="artist">ğŸ¨ Ø±Ø³Ø§Ù…ÙŠÙ†</button>
                      <button class="filterBtn chip px-3 py-2 rounded-2xl text-sm font-bold w-full text-right" type="button" data-filter="reviewer">ğŸ“ Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†</button>
                      <button class="filterBtn chip px-3 py-2 rounded-2xl text-sm font-bold w-full text-right" type="button" data-filter="cosplay">ğŸ§µ ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ</button>
                    </div>

                    <div class="mt-4 hint-bubble rounded-3xl p-4 text-sm">
                      ğŸ’– ØªÙ„Ù…ÙŠØ­: ØªØ§Ø¨Ø¹ÙŠ 2 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ â€” Ø­ØªÙ‰ ÙŠØ·Ù„Ø¹ Ù„Ùƒ â€œFeedâ€ Ø¯Ø§ÙØ¦ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©!
                    </div>

                    <div id="errFollows" class="mt-4 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </div>

                  <div class="glass rounded-3xl p-4 lg:col-span-2">
                    <div class="flex items-center justify-between gap-3">
                      <div class="text-sm font-bold">Ù‚Ø§Ø¦Ù…Ø© Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ø³Ø­Ø±</div>
                      <div class="text-xs opacity-75"><span id="followCount">0</span> Ù…ØªØ§Ø¨ÙØ¹ÙŠÙ†</div>
                    </div>
                    <div class="mt-3">
                      <input id="followSearch" class="input w-full rounded-2xl px-4 py-3 text-sm" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ø³Ù…â€¦ (Ù…Ø«Ø§Ù„: Momo, Rina)" />
                    </div>

                    <div id="friendsList" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                      <!-- injected -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- STEP 7 -->
              <div class="step" data-step="7">
                <h2 class="text-lg sm:text-xl font-extrabold">7) ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„ØªØ¬Ø±Ø¨Ø©</h2>
                <p class="text-sm opacity-80 mt-1">Feed Ø­Ø³Ø¨ (Ø£Ù†Ù…ÙŠ/Ù…Ø§Ù†Ø¬Ø§/ÙƒÙˆÙ…ÙŠÙƒØ³) + ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™</p>

                <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
                  <div class="glass rounded-3xl p-4">
                    <div class="text-sm font-bold">ÙÙ„ØªØ±Ø© Ø§Ù„Ù€Feed Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</div>
                    <p class="text-xs opacity-75 mt-1">Ø§Ø®ØªØ§Ø±ÙŠ 1-3ØŒ ÙˆØ§Ù„Ù€Feed ÙŠØ¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§Ùƒ.</p>

                    <div class="mt-3 space-y-2">
                      <label class="flex items-center justify-between gap-3 px-3 py-3 rounded-2xl border border-white/50 bg-white/40">
                        <div class="flex items-center gap-2">
                          <span>ğŸ¬</span><span class="text-sm font-semibold">Ø£Ù†Ù…ÙŠ</span>
                        </div>
                        <input id="feedAnime" type="checkbox" class="h-4 w-4 accent-pink-400" />
                      </label>
                      <label class="flex items-center justify-between gap-3 px-3 py-3 rounded-2xl border border-white/50 bg-white/40">
                        <div class="flex items-center gap-2">
                          <span>ğŸ“–</span><span class="text-sm font-semibold">Ù…Ø§Ù†Ø¬Ø§</span>
                        </div>
                        <input id="feedManga" type="checkbox" class="h-4 w-4 accent-pink-400" />
                      </label>
                      <label class="flex items-center justify-between gap-3 px-3 py-3 rounded-2xl border border-white/50 bg-white/40">
                        <div class="flex items-center gap-2">
                          <span>ğŸ—¯ï¸</span><span class="text-sm font-semibold">ÙƒÙˆÙ…ÙŠÙƒØ³</span>
                        </div>
                        <input id="feedComics" type="checkbox" class="h-4 w-4 accent-pink-400" />
                      </label>
                    </div>

                    <div id="errFeed" class="mt-3 hidden error-bubble rounded-2xl px-3 py-2 text-xs"></div>
                  </div>

                  <div class="glass rounded-3xl p-4">
                    <div class="flex items-center justify-between gap-3">
                      <div>
                        <div class="text-sm font-bold">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</div>
                        <div class="text-xs opacity-75">ØªÙ‚Ø¯Ø±ÙŠ ØªÙØ¹Ù„ÙŠÙ‡ Ù‡Ù†Ø§ Ø£Ùˆ Ù…Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©</div>
                      </div>
                      <button id="nightToggle2" type="button" class="toggle" data-on="false" aria-label="Toggle night mode (secondary)"></button>
                    </div>

                    <div class="mt-4 hint-bubble rounded-3xl p-4 text-sm">
                      ğŸŒ™ Ø¥Ø°Ø§ ØªØ­Ø¨ÙŠ Ø£Ù„ÙˆØ§Ù† Ù‡Ø§Ø¯Ø¦Ø© Ø¨Ø§Ù„Ù„ÙŠÙ„ØŒ ÙØ¹Ù‘Ù„ÙŠÙ‡ â€” ÙˆØ³ÙŠØªÙ… Ø­ÙØ¸Ù‡ ÙƒØªÙØ¶ÙŠÙ„.
                    </div>

                    <div class="mt-4 glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ù„Ù…Ø³Ø© Ù„Ø·ÙŠÙØ©</div>
                      <p class="text-xs opacity-75 mt-1">Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŒ Ø³ØªØ¸Ù‡Ø± â€œsparkle burstâ€ Ø£ÙƒØ¨Ø± âœ¨</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- STEP 8 -->
              <div class="step" data-step="8">
                <h2 class="text-lg sm:text-xl font-extrabold">8) Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
                <p class="text-sm opacity-80 mt-1">Ø¨Ø·Ø§Ù‚Ø© Ø¬Ù…ÙŠÙ„Ø© ØªØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ + Ø²Ø± â€œØ§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©â€ ğŸš€ğŸ’–</p>

                <div class="mt-4 glass rounded-[2rem] p-5 sm:p-6 relative overflow-hidden">
                  <div class="absolute -top-12 -left-12 w-48 h-48 rounded-full bg-pink-200/25 blur-2xl"></div>
                  <div class="absolute -bottom-16 -right-16 w-56 h-56 rounded-full bg-sky-200/25 blur-2xl"></div>

                  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                      <div class="w-12 h-12 rounded-2xl glass grid place-items-center">
                        <svg width="28" height="28" viewBox="0 0 100 100" aria-hidden="true">
                          <path fill="rgba(255,120,199,.9)" d="M50 8 L58 34 L85 35 L63 52 L70 80 L50 64 L30 80 L37 52 L15 35 L42 34 Z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="text-sm font-extrabold">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø­Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</div>
                        <div class="text-xs opacity-75">Ø±Ø§Ø¬Ø¹ÙŠ ÙƒÙ„ Ø´ÙŠØ¡ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                      </div>
                    </div>

                    <div class="flex items-center gap-2">
                      <button id="btnBackFinal" type="button" class="px-3 py-2 rounded-2xl glass text-sm font-semibold hover:translate-y-[-1px] transition">
                        Ø±Ø¬ÙˆØ¹
                      </button>
                      <button id="btnStart" type="button" class="px-4 py-2 rounded-2xl bg-white/75 border border-white/60 text-sm font-extrabold shadow-sm hover:translate-y-[-1px] transition">
                        Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© âœ¨ğŸª„
                      </button>
                    </div>
                  </div>

                  <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ø§Ù„Ù‡ÙˆÙŠØ©</div>
                      <div class="mt-2 text-sm leading-7">
                        <div>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: <span id="sumName" class="font-extrabold"></span></div>
                        <div>ğŸ€ Ø§Ù„Ù„Ù‚Ø¨: <span id="sumTitle" class="font-extrabold"></span></div>
                        <div>ğŸ·ï¸ Pronouns: <span id="sumPronouns" class="font-semibold opacity-90"></span></div>
                      </div>
                    </div>

                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ø§Ù„Ù…ÙˆÙ‚Ø¹ + ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ§Øª</div>
                      <div class="mt-2 text-sm leading-7">
                        <div>ğŸ“ <span id="sumPlace" class="font-extrabold"></span></div>
                        <div class="mt-2 p-3 rounded-2xl bg-white/40 border border-white/50">
                          ğŸ«§ <span id="sumDiary" class="opacity-90"></span>
                        </div>
                      </div>
                    </div>

                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Magic Wardrobe</div>
                      <div class="mt-3 flex items-center gap-4">
                        <div class="scale-[.9] origin-right">
                          <div id="sumAvatarFrame" class="frame" style="width:110px;height:110px;">
                            <div id="sumAvatarFrameDeco" class="absolute inset-0 opacity-90"></div>
                            <div class="frameInner" style="width:86px;height:86px;">
                              <svg id="sumAvatarSvg" width="68" height="68" viewBox="0 0 100 100" aria-hidden="true">
                                <defs>
                                  <linearGradient id="faceGrad2" x1="0" y1="0" x2="1" y2="1">
                                    <stop offset="0" stop-color="rgba(255,255,255,.95)"/>
                                    <stop offset="1" stop-color="rgba(255,255,255,.75)"/>
                                  </linearGradient>
                                </defs>
                                <circle cx="50" cy="50" r="44" fill="url(#faceGrad2)" stroke="rgba(140,109,190,.18)" stroke-width="2"/>
                                <circle cx="36" cy="46" r="5" fill="rgba(35,24,69,.65)"/>
                                <circle cx="64" cy="46" r="5" fill="rgba(35,24,69,.65)"/>
                                <path d="M36 67 C44 74 56 74 64 67" fill="none" stroke="rgba(255,120,199,.75)" stroke-width="4" stroke-linecap="round"/>
                                <path id="sumAvatarShape" d="" fill="none"/>
                              </svg>
                            </div>
                          </div>
                        </div>
                        <div class="text-sm leading-7">
                          <div>ğŸ–¼ï¸ Ø§Ù„Ø¥Ø·Ø§Ø±: <span id="sumFrame" class="font-extrabold"></span></div>
                          <div>ğŸ¨ Ø§Ù„Ù„ÙˆÙ†: <span id="sumColor" class="font-extrabold"></span></div>
                          <div>ğŸ”® Ø§Ù„Ø´ÙƒÙ„: <span id="sumShape" class="font-extrabold"></span></div>
                        </div>
                      </div>
                    </div>

                    <div class="glass rounded-3xl p-4">
                      <div class="text-sm font-bold">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª + Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ + Ø§Ù„Ù€Feed</div>
                      <div class="mt-2 text-sm leading-7">
                        <div>ğŸ“š Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª: <span id="sumInterests" class="font-semibold"></span></div>
                        <div class="mt-2">ğŸ¤ Ù…ØªØ§Ø¨ÙØ¹ÙŠÙ†: <span id="sumFollows" class="font-semibold"></span></div>
                        <div class="mt-2">ğŸ§­ Feed: <span id="sumFeed" class="font-semibold"></span></div>
                        <div class="mt-2">ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ: <span id="sumNight" class="font-semibold"></span></div>
                      </div>
                    </div>
                  </div>

                  <div id="finalError" class="mt-4 hidden error-bubble rounded-2xl px-4 py-3 text-sm"></div>
                </div>
              </div>

              <!-- Bottom nav -->
              <div class="pt-2 flex items-center justify-between gap-3">
                <button id="btnBack" type="button" class="px-4 py-3 rounded-2xl glass text-sm font-semibold hover:translate-y-[-1px] transition disabled:opacity-50 disabled:cursor-not-allowed">
                  Ø±Ø¬ÙˆØ¹
                </button>

                <div class="flex items-center gap-2">
                  <button id="btnSaveDraft" type="button" class="px-4 py-3 rounded-2xl glass text-sm font-bold hover:translate-y-[-1px] transition">
                    Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© ğŸ«§
                  </button>
                  <button id="btnNext" type="button" class="px-4 py-3 rounded-2xl bg-white/75 border border-white/60 text-sm font-extrabold shadow-sm hover:translate-y-[-1px] transition">
                    Ø§Ù„ØªØ§Ù„ÙŠ âœ¨
                  </button>
                </div>
              </div>

              <div class="text-xs opacity-70 text-center">
                Ø¨Ø¯ÙˆÙ† ØµÙˆØ± Ø®Ø§Ø±Ø¬ÙŠØ© âœ… â€” ÙÙ‚Ø· SVG ÙˆØªØ¯Ø±Ø¬Ø§Øª. ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©.
              </div>
            </form>
          </div>
        </section>

        <!-- Side summary -->
        <aside class="lg:col-span-4">
          <div class="glass rounded-[2rem] p-4 sm:p-5 sticky top-6">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-sm font-extrabold">Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</div>
                <div class="text-xs opacity-75">ÙŠØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ ÙƒÙ„ ØªØºÙŠÙŠØ±</div>
              </div>
              <div class="px-3 py-1 rounded-full glass text-xs" id="miniStep">1/8</div>
            </div>

            <div class="mt-4 space-y-3 text-sm">
              <div class="glass rounded-2xl p-3">
                <div class="text-xs opacity-75">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</div>
                <div id="miniName" class="font-extrabold">â€”</div>
              </div>
              <div class="glass rounded-2xl p-3">
                <div class="text-xs opacity-75">ğŸ€ Ø§Ù„Ù„Ù‚Ø¨</div>
                <div id="miniTitle" class="font-extrabold">â€”</div>
              </div>
              <div class="glass rounded-2xl p-3">
                <div class="text-xs opacity-75">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
                <div id="miniPlace" class="font-semibold">â€”</div>
              </div>
              <div class="glass rounded-2xl p-3">
                <div class="text-xs opacity-75">ğŸ“š Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</div>
                <div id="miniInterests" class="font-semibold">â€”</div>
              </div>
              <div class="glass rounded-2xl p-3">
                <div class="text-xs opacity-75">ğŸ¤ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
                <div id="miniFollows" class="font-semibold">â€”</div>
              </div>
            </div>

            <div class="mt-4 hint-bubble rounded-3xl p-4 text-sm">
              ğŸ’– â€œØ±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡â€ Ù‡Ù†Ø§ Ù„Ø·ÙŠÙØ©â€¦ Ø¨Ø³ Ø±Ø§Ø­ ØªÙƒÙˆÙ† ØµØ§Ø±Ù…Ø© Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ø¹Ø´Ø§Ù† ØªØ­Ù…ÙŠ Ø­Ø³Ø§Ø¨Ùƒ!
            </div>

            <div class="mt-4 glass rounded-3xl p-4">
              <div class="text-sm font-extrabold">Ø²Ø± Ø³Ø­Ø±ÙŠ ØµØºÙŠØ±</div>
              <button id="btnSparkleDemo" type="button" class="mt-3 w-full px-4 py-3 rounded-2xl bg-white/75 border border-white/60 text-sm font-extrabold hover:translate-y-[-1px] transition">
                Ø¬Ø±Ù‘Ø¨ Sparkle âœ¨
              </button>
            </div>
          </div>
        </aside>
      </div>

      <footer class="mt-8 pb-8 text-center text-xs opacity-70">
        âœ¨ Magical Girl Pastel UI â€” Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¯Ù…Ø¬ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ø¹ Next.js / Nest.js (API).
      </footer>
    </div>
  </main>

  <script>
    // -----------------------------
    // State
    // -----------------------------
    const state = {
      step: 1,
      total: 8,

      // step 1
      communityName: "",
      magicalTitle: "",

      // step 2
      email: "",
      password: "",
      showPassword: false,

      // step 3
      pronouns: "",
      country: "",
      city: "",
      diaryBubble: "",

      // step 4
      avatar: {
        frame: "Starlight Halo",
        color: "Pink Aurora",
        shape: "Star Cheek"
      },

      // step 5
      interests: new Set(),

      // step 6
      follows: new Set(),
      followFilter: "all",
      followSearch: "",

      // step 7
      feed: { anime:false, manga:false, comics:false },
      nightMode: false
    };

    // -----------------------------
    // Data
    // -----------------------------
    const magicalTitles = [
      "Star Guardian", "Moonlight Whisper", "Pastel Paladin", "Heart Alchemist",
      "Sparkle Archivist", "Cosmic Reviewer", "Ribbon Ranger", "Dream Illustrator",
      "Cherry Blossom Knight", "Celestial Cosplayer", "Gentle Storm", "Aurora Keeper"
    ];

    const frames = [
      { key:"Starlight Halo", icon:"â­" },
      { key:"Heart Crown", icon:"ğŸ’—" },
      { key:"Crystal Ring", icon:"ğŸ’" },
      { key:"Ribbon Orbit", icon:"ğŸ€" }
    ];

    const colors = [
      { key:"Pink Aurora", a:"#ff78c7", b:"#ffd6f0" },
      { key:"Sky Sorbet", a:"#83d2ff", b:"#eef7ff" },
      { key:"Mint Spell", a:"#aaffc3", b:"#f4fff4" },
      { key:"Lavender Mist", a:"#c9b5ff", b:"#fff1fb" }
    ];

    const shapes = [
      { key:"Star Cheek", d:"M50 20 L54 30 L65 31 L56 38 L59 49 L50 43 L41 49 L44 38 L35 31 L46 30 Z" },
      { key:"Heart Cheek", d:"M50 58 C41 54 36 49 36 44 C36 40 39 37 43 37 C46 37 49 39 50 41 C51 39 54 37 57 37 C61 37 64 40 64 44 C64 49 59 54 50 58 Z" },
      { key:"Moon Wink", d:"M61 30 C55 30 50 35 50 41 C50 49 56 55 64 55 C67 55 70 54 72 52 C69 58 63 62 56 62 C46 62 38 54 38 44 C38 35 44 28 52 27 C55 26 58 27 61 30 Z" },
      { key:"Spark Dot", d:"M50 50 m-6 0 a6 6 0 1 0 12 0 a6 6 0 1 0 -12 0" }
    ];

    const interestsCatalog = [
      // Anime
      { id:"shonen", label:"Ø£Ù†Ù…ÙŠ Ø´ÙˆÙ†ÙŠÙ†", tags:["anime"] },
      { id:"slice", label:"Slice of Life", tags:["anime"] },
      { id:"fantasy", label:"ÙØ§Ù†ØªØ§Ø²ÙŠØ§", tags:["anime","manga"] },
      { id:"isekai", label:"Isekai", tags:["anime","manga"] },
      { id:"mecha", label:"Mecha", tags:["anime"] },
      { id:"sports", label:"Sports Anime", tags:["anime"] },
      // Manga
      { id:"seinen", label:"Ù…Ø§Ù†Ø¬Ø§ Ø³ÙŠÙ†ÙŠÙ†", tags:["manga"] },
      { id:"shoujo", label:"Ø´ÙˆØ¬Ùˆ Ø±ÙˆÙ…Ø§Ù†Ø³", tags:["manga","anime"] },
      { id:"webtoon", label:"Webtoon", tags:["manga","comics"] },
      { id:"manhwa", label:"Manhwa", tags:["manga"] },
      { id:"oneshot", label:"One-shot", tags:["manga"] },
      // Comics
      { id:"superhero", label:"Superhero Comics", tags:["comics"] },
      { id:"indie", label:"Indie Comics", tags:["comics"] },
      { id:"graphic", label:"Graphic Novels", tags:["comics"] },
      { id:"mystery", label:"Mystery", tags:["comics","manga"] },
      // Cross
      { id:"romance", label:"Ø±ÙˆÙ…Ø§Ù†Ø³", tags:["anime","manga","comics"] },
      { id:"horror", label:"Ø±Ø¹Ø¨ Ù„Ø·ÙŠÙØŸ (Spooky)", tags:["anime","manga","comics"] },
      { id:"comedy", label:"ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§", tags:["anime","manga","comics"] },
      { id:"worldbuilding", label:"Worldbuilding", tags:["anime","manga","comics"] },
      { id:"art", label:"ÙÙ† ÙˆØ±Ø³Ù…", tags:["anime","manga","comics"] },
      { id:"reviews", label:"Ù…Ø±Ø§Ø¬Ø¹Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„", tags:["anime","manga","comics"] },
      { id:"cosplay", label:"ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ", tags:["anime","manga","comics"] }
    ];

    const topPicks = ["romance","comedy","worldbuilding","art","reviews"];

    const friendsCatalog = [
      { id:"momo", name:"MomoSketch", role:"artist", blurb:"Ø±Ø³Ù… Ø´Ø®ØµÙŠØ§Øª + Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ Ù„Ø·ÙŠÙ", badge:"ğŸ¨" },
      { id:"rina", name:"RinaReviews", role:"reviewer", blurb:"ØªØ­Ù„ÙŠÙ„ Ø­Ù„Ù‚Ø§Øª Ø¨Ø¯ÙˆÙ† Ø­Ø±Ù‚", badge:"ğŸ“" },
      { id:"kira", name:"KiraCos", role:"cosplay", blurb:"ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ + Ø®ÙŠØ§Ø·Ø© + Ø­ÙŠÙ„ ØªØµÙˆÙŠØ±", badge:"ğŸ§µ" },
      { id:"hana", name:"HanaInk", role:"artist", blurb:"Ù…Ø§Ù†Ø¬Ø§-Ø³ØªØ§ÙŠÙ„ ÙˆØªÙ„ÙˆÙŠÙ† Ø¨Ø§Ø³ØªÙŠÙ„", badge:"ğŸ¨" },
      { id:"sora", name:"SoraSpoilerFree", role:"reviewer", blurb:"Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù†Ø¸ÙŠÙØ© ÙˆÙ„Ø·ÙŠÙØ©", badge:"ğŸ“" },
      { id:"yuki", name:"YukiWardrobe", role:"cosplay", blurb:"Ø£ÙÙƒØ§Ø± Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø³Ø­Ø±ÙŠØ©", badge:"ğŸ§µ" },
      { id:"rei", name:"ReiPanel", role:"reviewer", blurb:"ØªØ­Ù„ÙŠÙ„ ÙƒÙˆÙ…ÙŠÙƒØ³ + ØªÙˆØµÙŠØ§Øª", badge:"ğŸ“" },
      { id:"lili", name:"LiliLines", role:"artist", blurb:"Ø®Ø·ÙˆØ· Ù†Ø¸ÙŠÙØ© + Ù†Ø¬ÙˆÙ… ØµØºÙŠØ±Ø©", badge:"ğŸ¨" }
    ];

    // -----------------------------
    // Helpers
    // -----------------------------
    const $ = (id) => document.getElementById(id);

    function setText(id, text){ $(id).textContent = text; }
    function show(id){ $(id).classList.remove("hidden"); }
    function hide(id){ $(id).classList.add("hidden"); }

    function cuteError(msg){
      // gentle phrasing
      return "ğŸ’” Ù‡Ù…Ù…Ù…... " + msg + " âœ¨";
    }
    function cuteOk(msg){
      return "ğŸ’– " + msg + " âœ¨";
    }

    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    function progressPercent(){
      return Math.round(((state.step - 1) / (state.total - 1)) * 100);
    }

    function sparkleBurst(intensity = 14){
      const layer = $("sparkleLayer");
      const rect = layer.getBoundingClientRect();

      const shapes = [
        // star
        `<svg viewBox="0 0 100 100" width="12" height="12" aria-hidden="true">
          <path fill="rgba(255,120,199,.85)" d="M50 8 L58 34 L85 35 L63 52 L70 80 L50 64 L30 80 L37 52 L15 35 L42 34 Z"/>
        </svg>`,
        // heart
        `<svg viewBox="0 0 100 100" width="12" height="12" aria-hidden="true">
          <path fill="rgba(131,210,255,.85)" d="M50 86 C25 70 10 55 10 38 C10 26 19 18 31 18 C39 18 46 22 50 28 C54 22 61 18 69 18 C81 18 90 26 90 38 C90 55 75 70 50 86 Z"/>
        </svg>`
      ];

      for(let i=0;i<intensity;i++){
        const el = document.createElement("div");
        el.className = "sparkle";
        el.innerHTML = shapes[i % shapes.length];

        const x = Math.random() * rect.width;
        const y = Math.random() * rect.height;

        const dx = (Math.random() * 120 - 60) + "px";
        const dy = (Math.random() * -140 - 30) + "px";

        el.style.setProperty("--x", x + "px");
        el.style.setProperty("--y", y + "px");
        el.style.setProperty("--dx", dx);
        el.style.setProperty("--dy", dy);
        el.style.left = "0px";
        el.style.top = "0px";

        layer.appendChild(el);
        setTimeout(()=> el.remove(), 800);
      }
    }

    // -----------------------------
    // Render chips / lists
    // -----------------------------
    function renderTitleChips(){
      const wrap = $("titleChips");
      wrap.innerHTML = "";
      magicalTitles.forEach(t => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip px-3 py-2 rounded-2xl text-sm font-bold";
        btn.textContent = "âœ¨ " + t;
        btn.dataset.selected = (state.magicalTitle === t) ? "true":"false";
        btn.addEventListener("click", () => {
          state.magicalTitle = t;
          $("magicalTitle").value = t;
          renderTitleChips();
          updateMini();
          sparkleBurst(10);
        });
        wrap.appendChild(btn);
      });
    }

    function renderFrameChips(){
      const wrap = $("frameChips");
      wrap.innerHTML = "";
      frames.forEach(f => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip px-3 py-2 rounded-2xl text-sm font-bold";
        btn.textContent = `${f.icon} ${f.key}`;
        btn.dataset.selected = (state.avatar.frame === f.key) ? "true":"false";
        btn.addEventListener("click", () => {
          state.avatar.frame = f.key;
          renderFrameChips();
          renderAvatar();
          updateMini();
          sparkleBurst(10);
        });
        wrap.appendChild(btn);
      });
    }

    function renderColorChips(){
      const wrap = $("colorChips");
      wrap.innerHTML = "";
      colors.forEach(c => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip px-3 py-2 rounded-2xl text-sm font-bold flex items-center gap-2";
        btn.dataset.selected = (state.avatar.color === c.key) ? "true":"false";
        btn.innerHTML = `
          <span class="inline-block w-4 h-4 rounded-full" style="background: linear-gradient(135deg, ${c.a}, ${c.b}); border:1px solid rgba(140,109,190,.18)"></span>
          <span>${c.key}</span>
        `;
        btn.addEventListener("click", () => {
          state.avatar.color = c.key;
          renderColorChips();
          renderAvatar();
          updateMini();
          sparkleBurst(10);
        });
        wrap.appendChild(btn);
      });
    }

    function renderShapeChips(){
      const wrap = $("shapeChips");
      wrap.innerHTML = "";
      shapes.forEach(s => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip px-3 py-2 rounded-2xl text-sm font-bold";
        btn.textContent = "ğŸ”® " + s.key;
        btn.dataset.selected = (state.avatar.shape === s.key) ? "true":"false";
        btn.addEventListener("click", () => {
          state.avatar.shape = s.key;
          renderShapeChips();
          renderAvatar();
          updateMini();
          sparkleBurst(10);
        });
        wrap.appendChild(btn);
      });
    }

    function renderInterests(){
      const q = $("interestSearch").value.trim().toLowerCase();
      const wrap = $("interestsList");
      wrap.innerHTML = "";

      const filtered = interestsCatalog.filter(x => {
        if(!q) return true;
        return x.label.toLowerCase().includes(q) || x.id.toLowerCase().includes(q) || x.tags.join(" ").includes(q);
      });

      filtered.forEach(item => {
        const id = "int_" + item.id;
        const checked = state.interests.has(item.id);

        const row = document.createElement("label");
        row.className = "flex items-center justify-between gap-3 px-3 py-3 rounded-2xl border border-white/50 bg-white/40 hover:translate-y-[-1px] transition";
        row.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="text-xs px-2 py-1 rounded-full glass">${item.tags[0]}</span>
            <span class="text-sm font-semibold">${item.label}</span>
          </div>
          <input id="${id}" type="checkbox" class="h-4 w-4 accent-pink-400" ${checked ? "checked":""} />
        `;
        row.querySelector("input").addEventListener("change", (e) => {
          if(e.target.checked) state.interests.add(item.id);
          else state.interests.delete(item.id);
          updateMini();
        });
        wrap.appendChild(row);
      });
    }

    function renderFriends(){
      const wrap = $("friendsList");
      wrap.innerHTML = "";

      const q = state.followSearch.trim().toLowerCase();
      const list = friendsCatalog.filter(f => {
        const passFilter = state.followFilter === "all" ? true : f.role === state.followFilter;
        const passSearch = !q ? true : (f.name.toLowerCase().includes(q) || f.blurb.toLowerCase().includes(q));
        return passFilter && passSearch;
      });

      list.forEach(f => {
        const followed = state.follows.has(f.id);

        const card = document.createElement("div");
        card.className = "glass rounded-3xl p-4 flex items-start justify-between gap-3 hover:translate-y-[-1px] transition";
        card.innerHTML = `
          <div class="flex gap-3">
            <div class="w-12 h-12 rounded-2xl bg-white/45 border border-white/50 grid place-items-center">
              <span class="text-xl">${f.badge}</span>
            </div>
            <div>
              <div class="text-sm font-extrabold">${f.name}</div>
              <div class="text-xs opacity-75">${roleLabel(f.role)}</div>
              <div class="text-xs opacity-80 mt-1">${f.blurb}</div>
            </div>
          </div>
          <button type="button" class="chip px-3 py-2 rounded-2xl text-sm font-extrabold" data-selected="${followed ? "true":"false"}">
            ${followed ? "Ù…ØªØ§Ø¨Ø¹Ø© âœ“" : "ØªØ§Ø¨Ø¹ +"}
          </button>
        `;

        card.querySelector("button").addEventListener("click", () => {
          if(state.follows.has(f.id)) state.follows.delete(f.id);
          else state.follows.add(f.id);
          setText("followCount", state.follows.size);
          updateMini();
          renderFriends();
          sparkleBurst(10);
        });

        wrap.appendChild(card);
      });

      setText("followCount", state.follows.size);
    }

    function roleLabel(role){
      if(role === "artist") return "Ø±Ø³Ù‘Ø§Ù…Ø©/Ø±Ø³Ù‘Ø§Ù…";
      if(role === "reviewer") return "Ù…Ø±Ø§Ø¬Ø¹Ø©/ØªØ­Ù„ÙŠÙ„";
      if(role === "cosplay") return "ÙƒÙˆØ³Ø¨Ù„Ø§ÙŠ";
      return "â€”";
    }

    // -----------------------------
    // Avatar rendering
    // -----------------------------
    function renderAvatar(){
      const c = colors.find(x => x.key === state.avatar.color) || colors[0];
      const frame = state.avatar.frame;

      const frameEl = $("avatarFrameDeco");
      const sumFrameEl = $("sumAvatarFrameDeco");

      const frameStyle = (name) => {
        // decorative SVG overlay
        if(name === "Starlight Halo"){
          return `
            <svg viewBox="0 0 100 100" class="w-full h-full">
              <defs>
                <linearGradient id="fr1" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="${c.a}" stop-opacity=".65"/>
                  <stop offset="1" stop-color="${c.b}" stop-opacity=".65"/>
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="48" fill="none" stroke="url(#fr1)" stroke-width="6" stroke-dasharray="6 6" />
              <path d="M50 7 L56 25 L75 26 L60 38 L65 56 L50 45 L35 56 L40 38 L25 26 L44 25 Z" fill="rgba(255,255,255,.35)"/>
            </svg>
          `;
        }
        if(name === "Heart Crown"){
          return `
            <svg viewBox="0 0 100 100" class="w-full h-full">
              <defs>
                <linearGradient id="fr2" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="${c.a}" stop-opacity=".65"/>
                  <stop offset="1" stop-color="${c.b}" stop-opacity=".65"/>
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="48" fill="none" stroke="url(#fr2)" stroke-width="6" />
              <path d="M50 28 C43 24 39 20 39 15 C39 12 41 10 44 10 C46 10 49 12 50 14 C51 12 54 10 56 10 C59 10 61 12 61 15 C61 20 57 24 50 28 Z"
                    fill="rgba(255,255,255,.45)"/>
            </svg>
          `;
        }
        if(name === "Crystal Ring"){
          return `
            <svg viewBox="0 0 100 100" class="w-full h-full">
              <defs>
                <linearGradient id="fr3" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="${c.a}" stop-opacity=".60"/>
                  <stop offset="1" stop-color="${c.b}" stop-opacity=".60"/>
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="48" fill="none" stroke="url(#fr3)" stroke-width="7" stroke-linecap="round"/>
              <path d="M50 10 L58 22 L50 34 L42 22 Z" fill="rgba(255,255,255,.40)"/>
              <path d="M90 50 L78 58 L66 50 L78 42 Z" fill="rgba(255,255,255,.30)"/>
              <path d="M50 90 L42 78 L50 66 L58 78 Z" fill="rgba(255,255,255,.25)"/>
              <path d="M10 50 L22 42 L34 50 L22 58 Z" fill="rgba(255,255,255,.30)"/>
            </svg>
          `;
        }
        // Ribbon Orbit
        return `
          <svg viewBox="0 0 100 100" class="w-full h-full">
            <defs>
              <linearGradient id="fr4" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="${c.a}" stop-opacity=".65"/>
                <stop offset="1" stop-color="${c.b}" stop-opacity=".65"/>
              </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="48" fill="none" stroke="url(#fr4)" stroke-width="6" stroke-dasharray="14 6" />
            <path d="M30 22 C35 16 44 16 50 22 C56 16 65 16 70 22 C66 28 58 30 50 27 C42 30 34 28 30 22 Z"
                  fill="rgba(255,255,255,.40)"/>
          </svg>
        `;
      };

      frameEl.innerHTML = frameStyle(frame);
      sumFrameEl.innerHTML = frameStyle(frame);

      // shape
      const shape = shapes.find(s => s.key === state.avatar.shape) || shapes[0];
      $("avatarShape").setAttribute("d", shape.d);
      $("avatarShape").setAttribute("fill", "rgba(255,120,199,.18)");
      $("avatarShape").setAttribute("stroke", "rgba(255,120,199,.55)");
      $("avatarShape").setAttribute("stroke-width", "2");

      $("sumAvatarShape").setAttribute("d", shape.d);
      $("sumAvatarShape").setAttribute("fill", "rgba(255,120,199,.18)");
      $("sumAvatarShape").setAttribute("stroke", "rgba(255,120,199,.55)");
      $("sumAvatarShape").setAttribute("stroke-width", "2");

      // border tone based on color
      const border = `1px solid rgba(255,255,255,.6)`;
      $("avatarFrame").style.border = border;
      $("sumAvatarFrame").style.border = border;
    }

    // -----------------------------
    // Validation per step
    // -----------------------------
    function clearErrors(){
      hide("globalError");
      ["errCommunityName","errMagicalTitle","errEmail","errPassword","errCountry","errCity","errDiary","errFrame","errInterests","errFollows","errFeed","finalError"]
        .forEach(id => hide(id));
    }

    function setErr(id, msg){
      $(id).textContent = cuteError(msg);
      show(id);
    }

    function validateStep(step){
      clearErrors();

      if(step === 1){
        const name = $("communityName").value.trim();
        const title = $("magicalTitle").value.trim();
        let ok = true;

        if(name.length < 3){
          setErr("errCommunityName", "Ø§Ø³Ù… Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
          ok = false;
        }
        if(!/^[\p{L}\p{N}_\-. ]+$/u.test(name)){
          setErr("errCommunityName", "Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø­Ø±ÙˆÙ/Ø£Ø±Ù‚Ø§Ù…/Ù…Ø³Ø§ÙØ© Ø£Ùˆ (_) Ùˆ(-) Ùˆ(.) ÙÙ‚Ø·.");
          ok = false;
        }
        if(!title){
          setErr("errMagicalTitle", "Ø§Ø®ØªØ§Ø±ÙŠ Ù„Ù‚Ø¨Ù‹Ø§ Ø³Ø­Ø±ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù€chips.");
          ok = false;
        }

        if(ok){
          state.communityName = name;
          state.magicalTitle = title;
        }
        return ok;
      }

      if(step === 2){
        const email = $("email").value.trim();
        const pw = $("password").value;

        let ok = true;
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
          setErr("errEmail", "Ø§ÙƒØªØ¨ÙŠ Email ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: you@magic.world).");
          ok = false;
        }

        const pwScore = passwordScore(pw);
        if(pwScore < 3){
          setErr("errPassword", "Ø®Ù„ÙŠÙ‡Ø§ Ø£Ù‚ÙˆÙ‰ Ø´ÙˆÙŠ: Ø·ÙˆÙ„ + Ø£Ø±Ù‚Ø§Ù… + Ø±Ù…Ø² âœ¨");
          ok = false;
        }

        if(ok){
          state.email = email;
          state.password = pw;
        }
        return ok;
      }

      if(step === 3){
        const country = $("country").value.trim();
        const city = $("city").value.trim();
        const diary = $("diaryBubble").value.trim();

        let ok = true;
        if(country.length < 2){
          setErr("errCountry", "Ø§ÙƒØªØ¨ÙŠ Ø¨Ù„Ø¯Ùƒ (Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).");
          ok = false;
        }
        if(city.length < 2){
          setErr("errCity", "Ø§ÙƒØªØ¨ÙŠ Ù…Ø¯ÙŠÙ†ØªÙƒ (Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).");
          ok = false;
        }
        if(diary.length < 10){
          setErr("errDiary", "ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ§Øª Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ â€” 10 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ğŸ«§");
          ok = false;
        }
        if(diary.length > 160){
          setErr("errDiary", "ÙÙ‚Ø§Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ§Øª Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† 160 Ø­Ø±Ù Ø£Ùˆ Ø£Ù‚Ù„.");
          ok = false;
        }

        if(ok){
          state.pronouns = $("pronouns").value.trim();
          state.country = country;
          state.city = city;
          state.diaryBubble = diary;
        }
        return ok;
      }

      if(step === 4){
        // frame required (always has default), but we'll still validate
        if(!state.avatar.frame){
          setErr("errFrame", "Ø§Ø®ØªØ§Ø±ÙŠ Ø¥Ø·Ø§Ø± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
          return false;
        }
        return true;
      }

      if(step === 5){
        if(state.interests.size < 3){
          setErr("errInterests", "Ø§Ø®ØªØ§Ø±ÙŠ 3 Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø¹Ø´Ø§Ù† Ù†Ø¨Ù†ÙŠ Feed Ù„Ø·ÙŠÙ Ù„Ùƒ ğŸ’–");
          return false;
        }
        return true;
      }

      if(step === 6){
        if(state.follows.size < 2){
          setErr("errFollows", "ØªØ§Ø¨Ø¹ÙŠ 2 Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ â€” Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£Ø­Ù„Ù‰ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¡ âœ¨");
          return false;
        }
        return true;
      }

      if(step === 7){
        const any = state.feed.anime || state.feed.manga || state.feed.comics;
        if(!any){
          setErr("errFeed", "Ø§Ø®ØªØ§Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù†ÙˆØ¹ ÙˆØ§Ø­Ø¯ Ù„Ù„Ù€Feed (Ø£Ù†Ù…ÙŠ/Ù…Ø§Ù†Ø¬Ø§/ÙƒÙˆÙ…ÙŠÙƒØ³).");
          return false;
        }
        return true;
      }

      return true;
    }

    // -----------------------------
    // Password strength
    // -----------------------------
    function passwordScore(pw){
      let score = 0;
      if(pw.length >= 8) score++;
      if(/[A-Za-z\u0600-\u06FF]/.test(pw) && /\d/.test(pw)) score++;
      if(/[!@#$%^&*()_\-+=\[\]{};:'",.<>/?\\|`~]/.test(pw)) score++;
      if(pw.length >= 12) score++;
      return score; // 0..4
    }

    function updatePasswordUI(){
      const pw = $("password").value;

      const lenOk = pw.length >= 8;
      const mixOk = (/[A-Za-z\u0600-\u06FF]/.test(pw) && /\d/.test(pw));
      const symOk = /[!@#$%^&*()_\-+=\[\]{};:'",.<>/?\\|`~]/.test(pw);

      $("pwLen").style.opacity = lenOk ? "1" : ".55";
      $("pwMix").style.opacity = mixOk ? "1" : ".55";
      $("pwSym").style.opacity = symOk ? "1" : ".55";

      const score = passwordScore(pw);
      const pct = [0, 30, 55, 75, 100][score];
      $("pwBar").style.width = pct + "%";

      let text = "Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø©â€¦";
      if(pw.length){
        if(score <= 1) text = "Ù‚ÙˆØ©: Ù„Ø·ÙŠÙØ©â€¦ Ø¨Ø³ Ø¶Ø¹ÙŠÙØ© ğŸ˜…";
        else if(score === 2) text = "Ù‚ÙˆØ©: Ø¬ÙŠØ¯Ø©! ğŸ’–";
        else if(score === 3) text = "Ù‚ÙˆØ©: Ù‚ÙˆÙŠØ© âœ¨";
        else text = "Ù‚ÙˆØ©: Ø£Ø³Ø·ÙˆØ±ÙŠØ©! ğŸŒŸ";
      }
      setText("pwStrengthText", text);
    }

    // -----------------------------
    // Step nav + UI update
    // -----------------------------
    function renderSteps(){
      document.querySelectorAll(".step").forEach(el => {
        el.classList.toggle("active", Number(el.dataset.step) === state.step);
      });

      // Buttons state
      const isFirst = state.step === 1;
      const isLast = state.step === state.total;

      $("btnBack").disabled = isFirst;
      $("btnBackTop").disabled = isFirst;

      $("btnNext").classList.toggle("hidden", isLast);
      $("btnNextTop").classList.toggle("hidden", isLast);
      $("btnBackFinal").classList.toggle("hidden", !isLast);
      $("btnStart").classList.toggle("hidden", !isLast);

      // Progress wand
      const pct = progressPercent();
      $("wandFill").style.width = pct + "%";
      $("wandFill").parentElement.setAttribute("aria-valuenow", String(pct));
      // Tip position: in RTL, we move right based on remaining
      // right = (100% - pct) - tipRadius
      $("wandTip").style.right = `calc(${100 - pct}% - 21px)`;

      setText("stepLabel", `Ø§Ù„Ø®Ø·ÙˆØ© ${state.step} Ù…Ù† ${state.total}`);
      setText("miniStep", `${state.step}/${state.total}`);

      // stronger sparkle on final
      sparkleBurst(state.step === 8 ? 22 : 14);

      if(state.step === 8){
        buildFinalSummary();
      }
    }

    function updateMini(){
      setText("miniName", state.communityName || "â€”");
      setText("miniTitle", state.magicalTitle || "â€”");
      const place = (state.country || state.city) ? `${state.country || "â€”"} â€¢ ${state.city || "â€”"}` : "â€”";
      setText("miniPlace", place);
      setText("miniInterests", state.interests.size ? [...state.interests].slice(0,4).join("ØŒ ") + (state.interests.size>4 ? "â€¦" : "") : "â€”");
      setText("miniFollows", state.follows.size ? `${state.follows.size} ØµØ¯ÙŠÙ‚/Ø©` : "â€”");
    }

    function buildFinalSummary(){
      // identity
      setText("sumName", state.communityName || "â€”");
      setText("sumTitle", state.magicalTitle || "â€”");
      setText("sumPronouns", state.pronouns || "â€”");
      setText("sumPlace", (state.country && state.city) ? `${state.country} â€¢ ${state.city}` : "â€”");
      setText("sumDiary", state.diaryBubble || "â€”");

      // wardrobe
      setText("sumFrame", state.avatar.frame || "â€”");
      setText("sumColor", state.avatar.color || "â€”");
      setText("sumShape", state.avatar.shape || "â€”");

      // interests
      const interestLabels = [...state.interests]
        .map(id => (interestsCatalog.find(x=>x.id===id)?.label || id));
      setText("sumInterests", interestLabels.length ? interestLabels.join("ØŒ ") : "â€”");

      // follows
      const followNames = [...state.follows]
        .map(id => (friendsCatalog.find(x=>x.id===id)?.name || id));
      setText("sumFollows", followNames.length ? followNames.join("ØŒ ") : "â€”");

      // feed
      const feed = [];
      if(state.feed.anime) feed.push("Ø£Ù†Ù…ÙŠ");
      if(state.feed.manga) feed.push("Ù…Ø§Ù†Ø¬Ø§");
      if(state.feed.comics) feed.push("ÙƒÙˆÙ…ÙŠÙƒØ³");
      setText("sumFeed", feed.length ? feed.join(" + ") : "â€”");

      setText("sumNight", state.nightMode ? "Ù…ÙØ¹Ù„ ğŸŒ™" : "ØºÙŠØ± Ù…ÙØ¹Ù„ â˜€ï¸");

      // sync avatar preview in summary
      renderAvatar();
    }

    function goNext(){
      if(!validateStep(state.step)){
        $("globalError").textContent = cuteError("ÙÙŠ ØªÙØ§ØµÙŠÙ„ ØµØºÙŠØ±Ø© ØªØ­ØªØ§Ø¬ Ù„Ù…Ø³Ø© Ø³Ø­Ø± Ù‚Ø¨Ù„ Ù…Ø§ Ù†ÙƒÙ…Ù„.");
        show("globalError");
        sparkleBurst(6);
        return;
      }
      state.step = clamp(state.step + 1, 1, state.total);
      renderSteps();
      updateMini();
    }

    function goBack(){
      state.step = clamp(state.step - 1, 1, state.total);
      renderSteps();
      updateMini();
    }

    // -----------------------------
    // Draft save/load (localStorage)
    // -----------------------------
    const DRAFT_KEY = "mg_pastel_signup_draft_v1";

    function saveDraft(){
      const draft = {
        ...state,
        interests: [...state.interests],
        follows: [...state.follows],
      };
      localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
      $("globalError").textContent = cuteOk("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©! ØªÙ‚Ø¯Ø±ÙŠ ØªØ±Ø¬Ø¹ÙŠ Ù„Ù‡Ø§ Ø¨Ø£ÙŠ ÙˆÙ‚Øª ğŸ«§");
      show("globalError");
      sparkleBurst(12);
      setTimeout(()=> hide("globalError"), 2400);
    }

    function loadDraft(){
      try{
        const raw = localStorage.getItem(DRAFT_KEY);
        if(!raw) return;
        const d = JSON.parse(raw);

        // restore
        state.step = d.step || 1;
        state.total = 8;

        state.communityName = d.communityName || "";
        state.magicalTitle = d.magicalTitle || "";

        state.email = d.email || "";
        state.password = d.password || "";
        state.showPassword = !!d.showPassword;

        state.pronouns = d.pronouns || "";
        state.country = d.country || "";
        state.city = d.city || "";
        state.diaryBubble = d.diaryBubble || "";

        state.avatar = d.avatar || state.avatar;

        state.interests = new Set(d.interests || []);
        state.follows = new Set(d.follows || []);
        state.followFilter = d.followFilter || "all";
        state.followSearch = d.followSearch || "";

        state.feed = d.feed || state.feed;
        state.nightMode = !!d.nightMode;

        // populate inputs
        $("communityName").value = state.communityName;
        $("magicalTitle").value = state.magicalTitle;
        $("email").value = state.email;
        $("password").value = state.password;
        $("pronouns").value = state.pronouns;
        $("country").value = state.country;
        $("city").value = state.city;
        $("diaryBubble").value = state.diaryBubble;

        $("feedAnime").checked = !!state.feed.anime;
        $("feedManga").checked = !!state.feed.manga;
        $("feedComics").checked = !!state.feed.comics;

        setTheme(state.nightMode);

      }catch(e){
        // ignore
      }
    }

    // -----------------------------
    // Theme toggle
    // -----------------------------
    function setTheme(night){
      state.nightMode = !!night;
      document.body.setAttribute("data-theme", night ? "night" : "day");
      $("nightToggle").dataset.on = night ? "true":"false";
      $("nightToggle2").dataset.on = night ? "true":"false";
      updateMini();
    }

    // -----------------------------
    // Wire events
    // -----------------------------
    function wire(){
      // step nav
      ["btnNext","btnNextTop"].forEach(id => $(id).addEventListener("click", goNext));
      ["btnBack","btnBackTop"].forEach(id => $(id).addEventListener("click", goBack));
      $("btnBackFinal").addEventListener("click", goBack);

      // demo sparkle
      $("btnSparkleDemo").addEventListener("click", () => sparkleBurst(18));

      // save draft
      $("btnSaveDraft").addEventListener("click", saveDraft);

      // step1 inputs
      $("communityName").addEventListener("input", (e)=>{ state.communityName = e.target.value; updateMini(); });
      // magicalTitle is readonly; set via chips

      // step2
      $("email").addEventListener("input", (e)=>{ state.email = e.target.value; });
      $("password").addEventListener("input", ()=>{ updatePasswordUI(); });

      $("togglePass").addEventListener("click", () => {
        state.showPassword = !state.showPassword;
        $("password").type = state.showPassword ? "text" : "password";
        $("togglePass").textContent = state.showPassword ? "Ø¥Ø®ÙØ§Ø¡ ğŸ™ˆ" : "Ø¥Ø¸Ù‡Ø§Ø± ğŸ‘€";
        sparkleBurst(10);
      });

      // step3
      $("pronouns").addEventListener("input", (e)=>{ state.pronouns = e.target.value; updateMini(); });
      $("country").addEventListener("input", (e)=>{ state.country = e.target.value; updateMini(); });
      $("city").addEventListener("input", (e)=>{ state.city = e.target.value; updateMini(); });

      $("diaryBubble").addEventListener("input", (e)=>{
        const v = e.target.value;
        if(v.length > 160) e.target.value = v.slice(0,160);
        state.diaryBubble = e.target.value;
        setText("diaryCount", `${state.diaryBubble.length} / 160`);
        updateMini();
      });

      // step5
      $("interestSearch").addEventListener("input", renderInterests);
      $("topPicksBtn").addEventListener("click", ()=>{
        topPicks.forEach(id => state.interests.add(id));
        renderInterests();
        updateMini();
        sparkleBurst(16);
      });
      $("clearInterestsBtn").addEventListener("click", ()=>{
        state.interests.clear();
        renderInterests();
        updateMini();
        sparkleBurst(10);
      });

      // step6 filter buttons
      document.querySelectorAll(".filterBtn").forEach(btn => {
        btn.addEventListener("click", ()=>{
          document.querySelectorAll(".filterBtn").forEach(b=> b.dataset.selected="false");
          btn.dataset.selected = "true";
          state.followFilter = btn.dataset.filter;
          renderFriends();
          sparkleBurst(10);
        });
      });

      $("followSearch").addEventListener("input", (e)=>{
        state.followSearch = e.target.value;
        renderFriends();
      });

      // step7 feed checkboxes
      $("feedAnime").addEventListener("change", (e)=>{ state.feed.anime = e.target.checked; });
      $("feedManga").addEventListener("change", (e)=>{ state.feed.manga = e.target.checked; });
      $("feedComics").addEventListener("change", (e)=>{ state.feed.comics = e.target.checked; });

      // theme toggles
      const toggles = ["nightToggle","nightToggle2"];
      toggles.forEach(id=>{
        $(id).addEventListener("click", ()=>{ setTheme(!state.nightMode); sparkleBurst(12); });
      });

      // final start
      $("btnStart").addEventListener("click", ()=>{
        // validate all quickly
        const allOk =
          validateStep(1) &&
          validateStep(2) &&
          validateStep(3) &&
          validateStep(4) &&
          validateStep(5) &&
          validateStep(6) &&
          validateStep(7);

        if(!allOk){
          $("finalError").textContent = cuteError("ÙÙŠ Ø®Ø·ÙˆØ© Ù†Ø§Ù‚ØµØ© Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ù†Ø§Ù‚Øµ â€” Ø§Ø±Ø¬Ø¹ÙŠ ÙˆØµØ­Ø­ÙŠÙ‡Ø§ ÙˆØ¨ØªØ±Ø¬Ø¹ÙŠ Ø£Ù‚ÙˆÙ‰ ğŸ’–");
          show("finalError");
          sparkleBurst(10);
          return;
        }

        hide("finalError");
        sparkleBurst(28);

        // playful "submit"
        const payload = {
          communityName: state.communityName,
          magicalTitle: state.magicalTitle,
          email: state.email,
          password: "(hidden)", // never log real pw
          pronouns: state.pronouns,
          country: state.country,
          city: state.city,
          diaryBubble: state.diaryBubble,
          avatar: state.avatar,
          interests: [...state.interests],
          follows: [...state.follows],
          feed: state.feed,
          nightMode: state.nightMode
        };

        $("globalError").textContent = cuteOk("ØªÙ…! ğŸ‰ (Ù‡Ù†Ø§ Ø¹Ø§Ø¯Ø©Ù‹ Ù†Ø±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€API). Ø§ÙØªØ­ÙŠ Console Ù„ØªØ±ÙŠÙ† Ø§Ù„Ù€payload.");
        show("globalError");

        console.log("âœ¨ Magical Girl Signup Payload (demo):", payload);

        // optionally clear draft
        localStorage.removeItem(DRAFT_KEY);
      });
    }

    // -----------------------------
    // Init
    // -----------------------------
    function init(){
      renderTitleChips();
      renderFrameChips();
      renderColorChips();
      renderShapeChips();

      loadDraft();

      // apply loaded values to UI components after load
      renderTitleChips();
      renderFrameChips();
      renderColorChips();
      renderShapeChips();
      renderInterests();
      renderFriends();

      // fill magic title input if loaded
      $("magicalTitle").value = state.magicalTitle || "";

      // diary counter
      setText("diaryCount", `${(state.diaryBubble||"").length} / 160`);

      // password ui
      updatePasswordUI();
      $("password").type = state.showPassword ? "text" : "password";
      $("togglePass").textContent = state.showPassword ? "Ø¥Ø®ÙØ§Ø¡ ğŸ™ˆ" : "Ø¥Ø¸Ù‡Ø§Ø± ğŸ‘€";

      // set theme
      setTheme(state.nightMode);

      // render avatar
      renderAvatar();

      // mini summary
      updateMini();

      // go to saved step
      renderSteps();

      // wires
      wire();
    }

    init();
  </script>
</body>
</html>
