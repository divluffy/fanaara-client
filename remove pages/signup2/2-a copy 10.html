<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ â€” Ù…ÙˆØ¯Ø§Ù„ Ø£Ù†Ù…ÙŠ/ÙƒÙˆÙ…ÙŠÙƒØ³</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Ù„Ø·Ø§Ø¨Ø¹ ÙƒÙˆÙ…ÙŠÙƒØ³ Ù„Ø·ÙŠÙ */
    @font-face {
      font-family: "ComicSansFallback";
      src: local("Comic Sans MS");
    }
    .comic-stroke { box-shadow: 0 0 0 3px #111827; }
    .comic-stroke-soft { box-shadow: 0 0 0 2px #111827; }
    .comic-dots {
      background-image:
        radial-gradient(rgba(17,24,39,.12) 1px, transparent 1px);
      background-size: 14px 14px;
    }
    .comic-hatch {
      background-image:
        repeating-linear-gradient(45deg, rgba(17,24,39,.12) 0px, rgba(17,24,39,.12) 2px, transparent 2px, transparent 8px);
    }
    .speech {
      position: relative;
    }
    .speech:after{
      content:"";
      position:absolute;
      bottom:-10px;
      right:24px; /* RTL tail */
      width: 0; height: 0;
      border: 10px solid transparent;
      border-top-color: #fff;
      filter: drop-shadow(0 2px 0 rgba(17,24,39,.5));
    }
    .speech.yellow:after{ border-top-color:#FEF9C3; }
    .speech.blue:after{ border-top-color:#DBEAFE; }
    .speech.coral:after{ border-top-color:#FFE4E6; }
    .slide-in {
      transform: translateX(10px);
      opacity: 0;
    }
    .slide-in.show {
      transform: translateX(0);
      opacity: 1;
      transition: all .35s ease;
    }
    .fade {
      opacity: 0;
      transform: translateY(8px);
    }
    .fade.show {
      opacity: 1;
      transform: translateY(0);
      transition: all .35s ease;
    }
    /* Ø²Ø± Toggle Ø¨Ø³ÙŠØ· */
    .toggle {
      width: 46px; height: 26px;
      border-radius: 999px;
      position: relative;
      transition: background .2s ease;
    }
    .toggle::after {
      content:"";
      position:absolute; top: 3px; right: 3px; /* RTL */
      width: 20px; height: 20px;
      border-radius: 999px;
      background: white;
      box-shadow: 0 2px 0 rgba(17,24,39,.35);
      transition: transform .2s ease;
    }
    .toggle.on::after { transform: translateX(-20px); } /* RTL direction */
    /* Ø´Ø±ÙŠØ· ØªÙ…Ø±ÙŠØ± Ù„Ø·ÙŠÙ */
    .scrollbar::-webkit-scrollbar { width: 10px; }
    .scrollbar::-webkit-scrollbar-thumb { background: rgba(17,24,39,.2); border-radius: 999px; }
    .scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,.6); }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['ui-sans-serif', 'system-ui', 'ComicSansFallback'],
          },
          colors: {
            sunny: { 50:"#FFFBEB", 100:"#FEF3C7", 200:"#FDE68A", 300:"#FCD34D", 400:"#FBBF24" },
            coral: { 50:"#FFF1F2", 100:"#FFE4E6", 200:"#FECDD3", 300:"#FDA4AF", 400:"#FB7185" },
            skyish:{ 50:"#EFF6FF", 100:"#DBEAFE", 200:"#BFDBFE", 300:"#93C5FD", 400:"#60A5FA" },
            ink:   { 900:"#111827" }
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-sunny-50 font-display text-ink-900">
  <!-- Ø®Ù„ÙÙŠØ© Ø£Ù†Ù…ÙŠ/ÙƒÙˆÙ…ÙŠÙƒØ³ -->
  <div class="fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-gradient-to-br from-sunny-100 via-white to-skyish-100"></div>
    <div class="absolute inset-0 comic-dots opacity-60"></div>
    <div class="absolute -top-20 -left-20 w-72 h-72 rounded-full bg-coral-200 blur-2xl opacity-70"></div>
    <div class="absolute -bottom-24 -right-24 w-80 h-80 rounded-full bg-skyish-200 blur-2xl opacity-70"></div>
    <div class="absolute top-16 right-10 rotate-6 bg-white/70 px-4 py-2 rounded-xl comic-stroke-soft">
      <span class="text-sm">âœ¨ Ù…ÙˆØ¯Ø§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø£Ù†Ù…ÙŠ/ÙƒÙˆÙ…ÙŠÙƒØ³</span>
    </div>
  </div>

  <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
  <div class="min-h-screen flex items-center justify-center p-6">
    <button id="openBtn"
      class="px-6 py-3 rounded-2xl bg-ink-900 text-white comic-stroke hover:translate-y-[-1px] transition"
      aria-haspopup="dialog" aria-controls="signupModal">
      Ø§ÙØªØ­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ğŸš€
    </button>
  </div>

  <!-- Overlay + Modal -->
  <div id="overlay" class="fixed inset-0 hidden items-center justify-center p-4 sm:p-8">
    <div class="absolute inset-0 bg-ink-900/40 backdrop-blur-sm"></div>

    <div id="signupModal"
      class="relative w-full max-w-4xl rounded-3xl bg-white comic-stroke overflow-hidden"
      role="dialog" aria-modal="true" aria-label="ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯">

      <!-- Header -->
      <div class="p-4 sm:p-6 bg-gradient-to-l from-sunny-100 via-white to-skyish-100 border-b border-ink-900/10">
        <div class="flex items-start justify-between gap-4">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-2xl bg-white comic-stroke-soft flex items-center justify-center">
              <span class="text-2xl">ğŸª„</span>
            </div>
            <div>
              <h1 class="text-xl sm:text-2xl font-black tracking-tight">Ø§ØµÙ†Ø¹ Ù‡ÙˆÙŠØªÙƒâ€¦ ØµÙØ­Ø© ØµÙØ­Ø©! ğŸ“š</h1>
              <p class="text-sm text-ink-900/70">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ù‚Ù„ â€” Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨Ø±Ø§Ø­ØªÙƒ.</p>
            </div>
          </div>

          <button id="closeBtn"
            class="px-3 py-2 rounded-xl bg-white comic-stroke-soft hover:bg-sunny-50 transition"
            title="Ø¥ØºÙ„Ø§Ù‚">
            âœ–
          </button>
        </div>

        <!-- Progress -->
        <div class="mt-4 flex flex-col gap-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-bold">
              Ø§Ù„ØªÙ‚Ø¯Ù…: <span id="progressLabel">1</span> / <span id="totalLabel">10</span>
            </div>
            <div class="text-sm text-ink-900/70">
              <span id="stepTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨</span>
            </div>
          </div>

          <div class="w-full h-3 rounded-full bg-ink-900/10 overflow-hidden comic-stroke-soft">
            <div id="progressBar" class="h-full w-[10%] bg-gradient-to-l from-coral-300 to-skyish-300"></div>
          </div>

          <!-- Stepper Panels -->
          <div class="grid grid-cols-5 sm:grid-cols-10 gap-2">
            <!-- buttons injected by JS -->
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="p-4 sm:p-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <!-- Left: Character-ish card -->
          <aside class="lg:col-span-1 rounded-3xl bg-sunny-100 comic-stroke-soft p-4 relative overflow-hidden">
            <div class="absolute inset-0 comic-hatch opacity-20"></div>
            <div class="relative">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="text-2xl">ğŸ­</span>
                  <span class="font-black">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø·Ù„</span>
                </div>
                <span id="variantBadge" class="px-2 py-1 rounded-xl bg-white comic-stroke-soft text-xs font-bold">Ù†Ø³Ø®Ø©: Ø£ÙˆÙ„Ø§Ø¯ â™‚</span>
              </div>

              <div class="mt-4 rounded-2xl bg-white comic-stroke-soft p-3">
                <div class="flex items-center gap-3">
                  <div id="previewAvatar"
                    class="w-16 h-16 rounded-2xl bg-skyish-100 comic-stroke-soft flex items-center justify-center text-3xl">
                    ğŸ˜º
                  </div>
                  <div class="min-w-0">
                    <div class="text-sm font-black truncate">
                      <span id="previewName">Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶</span>
                    </div>
                    <div class="text-xs text-ink-900/70">
                      <span id="previewStyle">Ø³ØªØ§ÙŠÙ„: â€”</span> â€¢ <span id="previewLang">Ù„ØºØ©: â€”</span>
                    </div>
                    <div class="text-xs text-ink-900/70 mt-1">
                      ğŸ’Œ <span id="previewEmail">â€”</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-4">
                <div class="speech yellow rounded-2xl bg-sunny-200 comic-stroke-soft p-3">
                  <div class="font-black">Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø±Ø§ÙˆÙŠ ğŸ—¯ï¸</div>
                  <div id="narratorText" class="text-sm mt-1">
                    Ø§Ø®ØªØ± Ø§Ù„Ù„ÙŠ ØªØ­Ø¨Ù‡â€¦ ÙˆØ®Ù„ÙŠ Ø­Ø³Ø§Ø¨Ùƒ â€œØ³ØªØ§ÙŠÙ„Ù‡â€ ÙˆØ§Ø¶Ø­!
                  </div>
                </div>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
                <div class="rounded-2xl bg-white comic-stroke-soft p-2">
                  <div class="font-black">â­ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</div>
                  <div id="previewInterests" class="text-ink-900/70 mt-1">â€”</div>
                </div>
                <div class="rounded-2xl bg-white comic-stroke-soft p-2">
                  <div class="font-black">ğŸ”” ØªÙØ§Ø¹Ù„</div>
                  <div id="previewPrefs" class="text-ink-900/70 mt-1">â€”</div>
                </div>
              </div>
            </div>
          </aside>

          <!-- Right: Step panel -->
          <main class="lg:col-span-2">
            <div id="panel"
              class="rounded-3xl bg-white comic-stroke-soft overflow-hidden">
              <div class="p-4 sm:p-5 bg-gradient-to-l from-white via-sunny-50 to-coral-50 border-b border-ink-900/10">
                <div class="flex items-center justify-between gap-3">
                  <div class="flex items-center gap-2">
                    <span id="panelIcon" class="text-2xl">ğŸ§©</span>
                    <h2 id="panelHeading" class="text-lg sm:text-xl font-black">Ù„ÙˆØ­Ø©</h2>
                  </div>
                  <div class="text-xs sm:text-sm text-ink-900/60 font-bold">
                    Panel <span id="panelNumber">01</span>
                  </div>
                </div>

                <div id="panelBubble"
                  class="speech blue mt-3 rounded-2xl bg-skyish-100 comic-stroke-soft p-3">
                  <div class="text-sm">
                    Ù‡Ù†Ø§ Ø§Ù„Ø´Ø±Ø­ ÙŠØ·Ù„Ø¹ ÙƒÙÙ‚Ø§Ø¹Ø© ÙƒÙ„Ø§Ù… Ø¨Ø¯Ù„ Ø§Ù„Ù†Øµ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ ğŸ’¬
                  </div>
                </div>
              </div>

              <div id="panelBody" class="p-4 sm:p-5 max-h-[55vh] overflow-auto scrollbar">
                <!-- step content injected -->
              </div>

              <!-- Footer buttons -->
              <div class="p-4 sm:p-5 border-t border-ink-900/10 bg-white">
                <div class="flex items-center justify-between gap-3">
                  <button id="prevBtn"
                    class="flex-1 sm:flex-none px-5 py-3 rounded-2xl bg-white comic-stroke-soft hover:bg-sunny-50 transition font-black">
                    â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚
                  </button>

                  <div class="hidden sm:flex items-center gap-2 text-xs text-ink-900/60">
                    <span class="px-2 py-1 rounded-xl bg-sunny-100 comic-stroke-soft">ØªÙ†Ù‚Ù‘Ù„ Ø­Ø±</span>
                    <span class="px-2 py-1 rounded-xl bg-skyish-100 comic-stroke-soft">Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚</span>
                    <span id="variantDeco" class="px-2 py-1 rounded-xl bg-coral-100 comic-stroke-soft">Ø²Ø®Ø±ÙØ© â™‚</span>
                  </div>

                  <button id="nextBtn"
                    class="flex-1 sm:flex-none px-5 py-3 rounded-2xl bg-ink-900 text-white comic-stroke hover:translate-y-[-1px] transition font-black">
                    Ø§Ù„ØªØ§Ù„ÙŠ â¡
                  </button>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>

      <!-- Tiny footer -->
      <div class="px-4 sm:px-6 pb-4 text-xs text-ink-900/60">
        Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG/Emoji ÙÙ‚Ø· â€¢ RTL â€¢ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Fade/Slide â€¢ Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚ Ø¥Ø¯Ø®Ø§Ù„
      </div>
    </div>
  </div>

  <script>
    // ========= State =========
    const state = {
      step: 1,
      total: 10,

      // Step1
      contentPref: [],

      // Step2
      email: "",
      password: "",

      // Step3
      displayName: "",
      age: "",
      language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",

      // Step4
      accountStyle: "",
      variant: "boys", // boys/girls

      // Step5
      avatar: "ğŸ˜º",
      uploadedImageDataUrl: "",

      // Step6
      animeGenres: [],
      animeThemes: [],

      // Step7
      comicInterests: [],
      narrativePref: "",

      // Step8
      follows: {},

      // Step9
      suggestFriends: true,
      newNotifications: true
    };

    const stepsMeta = [
      { title: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨", icon: "ğŸŒŸ", bubble: "Ø£Ù‡Ù„Ø§Ù‹! Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø§Ù„Ù…Ùƒ Ø§Ù„Ù…ÙØ¶Ù„." },
      { title: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„", icon: "ğŸ”", bubble: "Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±â€¦ Ø¨Ø¯ÙˆÙ† ØªØ¯Ù‚ÙŠÙ‚ØŒ Ø¨Ø³ Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©." },
      { title: "Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©", icon: "ğŸªª", bubble: "Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶ + Ø§Ù„Ø¹Ù…Ø± (+16) + Ø§Ù„Ù„ØºØ©â€¦ Ù„Ù‚Ø·Ø© ØªØ¹Ø±ÙŠÙ!" },
      { title: "Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ + Ø§Ù„Ù†Ø³Ø®Ø©", icon: "ğŸ¨", bubble: "Ø§Ø®ØªØ± Ø³ØªØ§ÙŠÙ„Ùƒâ€¦ ÙˆØ¨Ø¯Ù‘Ù„ Ø§Ù„Ù†Ø³Ø®Ø© Ù„ØªØºÙŠÙ‘Ø± Ø²Ø®Ø§Ø±Ù Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª!" },
      { title: "Ø£ÙØ§ØªØ§Ø± ÙˆØµÙˆØ±Ø©", icon: "ğŸ§‘â€ğŸ¤", bubble: "Ø§Ø®ØªÙØ± Ø£ÙØ§ØªØ§Ø± Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø©â€¦ Ù‡Ø°Ø§ ÙˆØ¬Ù‡ Ø§Ù„Ø¨Ø·Ù„!" },
      { title: "Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ", icon: "ğŸ¥", bubble: "Genres + Ø«Ù„Ø§Ø« Ø«ÙŠÙ…Ø§Øª ØªØ­Ø¨Ù‡Ø§â€¦ Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙˆØµÙŠØ§Øª ØªØµÙŠØ± Ù†Ø§Ø±!" },
      { title: "Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…ØµÙˆØ±Ø©", icon: "ğŸ—ï¸", bubble: "Webtoon/Comics/Manhwa + ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¯â€¦ Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†Ø¹Ø±Ù Ø°ÙˆÙ‚Ùƒ." },
      { title: "Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ø±ÙŠØ¹Ø©", icon: "ğŸ‘¥", bubble: "Ø§Ù‚ØªØ±Ø­Ø§Øª Ø­Ø³Ø§Ø¨Ø§Øªâ€¦ Ø¶ØºØ·Ø© Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ®Ù„Ø§Øµ." },
      { title: "ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„", icon: "âš™ï¸", bubble: "ØªØ¨ØºÙ‰ Ø§Ù‚ØªØ±Ø§Ø­ Ø£ØµØ¯Ù‚Ø§Ø¡ØŸ ØªØ¨ØºÙ‰ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŸ Ø¨Ø¯Ù‘Ù„ Ø§Ù„ØªÙˆØ¬Ù„Ø²!" },
      { title: "Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©", icon: "ğŸ", bubble: "ØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©! Ø±Ø§Ø¬Ø¹ Ù…Ù„Ø®ØµÙƒ ÙˆØ§Ø¶ØºØ· Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨." },
    ];

    // ========= DOM =========
    const overlay = document.getElementById("overlay");
    const openBtn = document.getElementById("openBtn");
    const closeBtn = document.getElementById("closeBtn");

    const progressBar = document.getElementById("progressBar");
    const progressLabel = document.getElementById("progressLabel");
    const totalLabel = document.getElementById("totalLabel");
    const stepTitle = document.getElementById("stepTitle");

    const panelIcon = document.getElementById("panelIcon");
    const panelHeading = document.getElementById("panelHeading");
    const panelNumber = document.getElementById("panelNumber");
    const panelBubble = document.getElementById("panelBubble");
    const panelBody = document.getElementById("panelBody");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const narratorText = document.getElementById("narratorText");
    const previewAvatar = document.getElementById("previewAvatar");
    const previewName = document.getElementById("previewName");
    const previewStyle = document.getElementById("previewStyle");
    const previewLang = document.getElementById("previewLang");
    const previewEmail = document.getElementById("previewEmail");
    const previewInterests = document.getElementById("previewInterests");
    const previewPrefs = document.getElementById("previewPrefs");

    const variantBadge = document.getElementById("variantBadge");
    const variantDeco = document.getElementById("variantDeco");

    const stepperGrid = overlay.querySelector(".grid");

    totalLabel.textContent = state.total;

    // ========= Helpers =========
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

    function openModal() {
      overlay.classList.remove("hidden");
      overlay.classList.add("flex");
      renderStepper();
      render();
      // Animation in
      const modal = document.getElementById("signupModal");
      modal.classList.add("fade");
      requestAnimationFrame(() => modal.classList.add("show"));
    }

    function closeModal() {
      const modal = document.getElementById("signupModal");
      modal.classList.remove("show");
      setTimeout(() => {
        overlay.classList.add("hidden");
        overlay.classList.remove("flex");
      }, 180);
    }

    function setStep(n) {
      state.step = clamp(n, 1, state.total);
      render();
    }

    function next() { setStep(state.step + 1); }
    function prev() { setStep(state.step - 1); }

    function decoEmoji() {
      // Ø²Ø®Ø§Ø±Ù ØªØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø®Ø©
      return state.variant === "girls"
        ? { badge: "Ù†Ø³Ø®Ø©: Ø¨Ù†Ø§Øª â™€", deco: "Ø²Ø®Ø±ÙØ© â™€", spark: "ğŸŒ¸", accent: "ğŸ’–" }
        : { badge: "Ù†Ø³Ø®Ø©: Ø£ÙˆÙ„Ø§Ø¯ â™‚", deco: "Ø²Ø®Ø±ÙØ© â™‚", spark: "âš¡", accent: "ğŸ”¥" };
    }

    function chip(label, active, onClick, extra="") {
      return `
        <button class="px-3 py-2 rounded-2xl comic-stroke-soft text-sm font-black transition
          ${active ? "bg-ink-900 text-white" : "bg-white hover:bg-sunny-50"}
          ${extra}"
          type="button" data-chip="${label}">
          ${label}
        </button>
      `;
    }

    function cardOption({id, title, subtitle, emoji, active}) {
      const base = active ? "bg-ink-900 text-white" : "bg-white hover:bg-sunny-50";
      return `
        <button type="button" data-option="${id}"
          class="${base} comic-stroke-soft rounded-3xl p-4 text-right transition hover:translate-y-[-1px]">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-base font-black">${title}</div>
              <div class="text-xs opacity-80 mt-1">${subtitle}</div>
            </div>
            <div class="text-2xl">${emoji}</div>
          </div>
        </button>
      `;
    }

    function renderStepper() {
      stepperGrid.innerHTML = "";
      for (let i = 1; i <= state.total; i++) {
        const isActive = i === state.step;
        const done = i < state.step;
        const meta = stepsMeta[i-1];

        stepperGrid.innerHTML += `
          <button type="button" data-step="${i}"
            class="rounded-2xl comic-stroke-soft p-2 text-center transition
              ${isActive ? "bg-ink-900 text-white" : done ? "bg-sunny-100 hover:bg-sunny-200" : "bg-white hover:bg-sunny-50"}">
            <div class="text-lg">${meta.icon}</div>
            <div class="text-[10px] font-black leading-tight">${String(i).padStart(2,"0")}</div>
          </button>
        `;
      }

      stepperGrid.querySelectorAll("[data-step]").forEach(btn => {
        btn.addEventListener("click", () => setStep(+btn.dataset.step));
      });
    }

    function updatePreview() {
      previewAvatar.textContent = state.avatar;
      previewName.textContent = state.displayName || "Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶";
      previewStyle.textContent = `Ø³ØªØ§ÙŠÙ„: ${state.accountStyle || "â€”"}`;
      previewLang.textContent = `Ù„ØºØ©: ${state.language || "â€”"}`;
      previewEmail.textContent = state.email || "â€”";

      const interestsBits = [];
      if (state.contentPref.length) interestsBits.push(`ğŸ§­ ${state.contentPref.join("ØŒ ")}`);
      if (state.animeGenres.length) interestsBits.push(`ğŸ¥ ${state.animeGenres.slice(0,4).join("ØŒ ")}${state.animeGenres.length>4?"â€¦":""}`);
      if (state.comicInterests.length) interestsBits.push(`ğŸ—ï¸ ${state.comicInterests.join("ØŒ ")}`);
      previewInterests.textContent = interestsBits.length ? interestsBits.join(" â€¢ ") : "â€”";

      const prefsBits = [];
      prefsBits.push(state.suggestFriends ? "ğŸ¤ Ø§Ù‚ØªØ±Ø§Ø­ Ø£ØµØ¯Ù‚Ø§Ø¡: Ù†Ø¹Ù…" : "ğŸ¤ Ø§Ù‚ØªØ±Ø§Ø­ Ø£ØµØ¯Ù‚Ø§Ø¡: Ù„Ø§");
      prefsBits.push(state.newNotifications ? "ğŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: Ù†Ø¹Ù…" : "ğŸ”• Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: Ù„Ø§");
      previewPrefs.textContent = prefsBits.join(" â€¢ ");

      const deco = decoEmoji();
      variantBadge.textContent = deco.badge;
      variantDeco.textContent = deco.deco;
      narratorText.textContent = state.step === 4
        ? `Ø¬Ø±Ù‘Ø¨ ØªØ¨Ø¯Ù‘Ù„ Ø§Ù„Ù†Ø³Ø®Ø© ÙˆØ´ÙˆÙ Ø§Ù„Ø²Ø®Ø§Ø±Ù ØªØªØºÙŠÙ‘Ø± ${deco.spark}`
        : stepsMeta[state.step-1].bubble + " " + deco.accent;
    }

    function setBubbleColor() {
      // Ø¨Ø¯Ù‘Ù„ Ù„ÙˆÙ† Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø±Ø­ Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·ÙˆØ©
      panelBubble.classList.remove("yellow", "blue", "coral", "bg-sunny-200", "bg-skyish-100", "bg-coral-100");
      if ([1,6].includes(state.step)) {
        panelBubble.classList.add("yellow","bg-sunny-200");
      } else if ([4,8].includes(state.step)) {
        panelBubble.classList.add("coral","bg-coral-100");
      } else {
        panelBubble.classList.add("blue","bg-skyish-100");
      }
    }

    function progressPct() {
      return Math.round((state.step / state.total) * 100);
    }

    // ========= Step Renderers =========
    function step1() {
      const items = [
        { id:"Ø£Ù†Ù…ÙŠ", title:"Ø£Ù†Ù…ÙŠ", subtitle:"Ø­Ù„Ù‚Ø§ØªØŒ Ù…ÙˆØ§Ø³Ù…ØŒ ØªÙˆØµÙŠØ§Øª", emoji:"ğŸ¥" },
        { id:"Ù…Ø§Ù†Ø¬Ø§", title:"Ù…Ø§Ù†Ø¬Ø§", subtitle:"ÙØµÙˆÙ„ØŒ Ø³Ù„Ø§Ø³Ù„ØŒ Ù†Ù‚Ø§Ø´Ø§Øª", emoji:"ğŸ“–" },
        { id:"ÙƒÙˆÙ…ÙŠÙƒØ³", title:"ÙƒÙˆÙ…ÙŠÙƒØ³", subtitle:"Ø£Ø¨Ø·Ø§Ù„ØŒ Ø¹ÙˆØ§Ù„Ù…ØŒ Ø£Ø­Ø¯Ø§Ø«", emoji:"ğŸ¦¸" },
        { id:"ÙØ§Ù† Ø¢Ø±Øª", title:"ÙØ§Ù† Ø¢Ø±Øª", subtitle:"Ø±Ø³ÙˆÙ…Ø§ØªØŒ Ø¬Ø§Ù„ÙŠØ±ÙŠØŒ ØªØ­Ø¯ÙŠØ§Øª", emoji:"ğŸ–Œï¸" },
        { id:"Ù…ÙŠÙ…Ø²", title:"Ù…ÙŠÙ…Ø²", subtitle:"Ø¶Ø­ÙƒØŒ ØªØ±Ù†Ø¯Ø§ØªØŒ Ù„Ù‚Ø·Ø§Øª", emoji:"ğŸ˜‚" },
      ];

      return `
        <div class="slide-in show">
          <div class="speech yellow rounded-2xl bg-sunny-200 comic-stroke-soft p-3">
            <div class="font-black">"Ø£ÙˆÙ„ Panel!" ğŸ¬</div>
            <div class="text-sm mt-1">Ø§Ø®ØªÙØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù„ÙŠ ÙŠØ­Ù…Ù‘Ø³Ùƒâ€¦ ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø±.</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            ${items.map(x => cardOption({
              ...x,
              active: state.contentPref.includes(x.id)
            })).join("")}
          </div>

          <div class="mt-4 rounded-2xl bg-skyish-50 comic-stroke-soft p-3 text-sm">
            <span class="font-black">Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø§Ù„Ø¢Ù†:</span>
            <span class="mr-2">${state.contentPref.length ? state.contentPref.join("ØŒ ") : "â€”"}</span>
          </div>
        </div>
      `;
    }

    function step2() {
      return `
        <div class="slide-in show">
          <div class="speech blue rounded-2xl bg-skyish-100 comic-stroke-soft p-3">
            <div class="font-black">"Ø­Ø§Ø±Ø³ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©" ğŸ”</div>
            <div class="text-sm mt-1">Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±â€¦ ÙÙ‚Ø· Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚.</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-3xl bg-white comic-stroke-soft p-4">
              <label class="text-sm font-black">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ğŸ’Œ</label>
              <input id="email" type="email" placeholder="name@example.com"
                class="mt-2 w-full px-4 py-3 rounded-2xl bg-sunny-50 comic-stroke-soft focus:outline-none"
                value="${escapeHtml(state.email)}" />
              <div class="text-xs text-ink-900/60 mt-2">ØªÙ„Ù…ÙŠØ­: Ø£ÙŠ Ø´ÙŠØ¡ ØªÙƒØªØ¨Ù‡ ÙŠØ¸Ù‡Ø± Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø·.</div>
            </div>

            <div class="rounded-3xl bg-white comic-stroke-soft p-4">
              <label class="text-sm font-black">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ—ï¸</label>
              <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                class="mt-2 w-full px-4 py-3 rounded-2xl bg-sunny-50 comic-stroke-soft focus:outline-none"
                value="${escapeHtml(state.password)}" />
              <div class="text-xs text-ink-900/60 mt-2">Ø¨Ø¯ÙˆÙ† Ø´Ø±ÙˆØ·ØŒ Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯.</div>
            </div>
          </div>
        </div>
      `;
    }

    function step3() {
      return `
        <div class="slide-in show">
          <div class="speech yellow rounded-2xl bg-sunny-200 comic-stroke-soft p-3">
            <div class="font-black">"Ø¨Ø·Ø§Ù‚Ø© ØªØ¹Ø±ÙŠÙ" ğŸªª</div>
            <div class="text-sm mt-1">Ø§Ø³Ù… Ø¹Ø±Ø¶ + Ø¹Ù…Ø± (+16) + Ø§Ù„Ù„ØºØ©â€¦ Ø®Ù„ÙŠÙ‡Ø§ Ø¨Ø³ÙŠØ·Ø©!</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-3xl bg-white comic-stroke-soft p-4 sm:col-span-1">
              <label class="text-sm font-black">Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶ âœ¨</label>
              <input id="displayName" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙƒØ§Ø¨ØªÙ†-Ø£ÙˆØªØ§ÙƒÙˆ"
                class="mt-2 w-full px-4 py-3 rounded-2xl bg-skyish-50 comic-stroke-soft focus:outline-none"
                value="${escapeHtml(state.displayName)}" />
            </div>

            <div class="rounded-3xl bg-white comic-stroke-soft p-4 sm:col-span-1">
              <label class="text-sm font-black">Ø§Ù„Ø¹Ù…Ø± (+16) ğŸ‚</label>
              <input id="age" type="number" placeholder="16"
                class="mt-2 w-full px-4 py-3 rounded-2xl bg-skyish-50 comic-stroke-soft focus:outline-none"
                value="${escapeHtml(state.age)}" />
              <div class="text-xs text-ink-900/60 mt-2">Ù…Ø·Ù„ÙˆØ¨ ÙŠÙƒÙˆÙ† ÙÙˆÙ‚ 16 (Ù„ÙƒÙ† Ù…Ø§ ÙÙŠ ØªØ­Ù‚Ù‚).</div>
            </div>

            <div class="rounded-3xl bg-white comic-stroke-soft p-4 sm:col-span-1">
              <label class="text-sm font-black">Ø§Ù„Ù„ØºØ© ğŸŒ</label>
              <select id="language"
                class="mt-2 w-full px-4 py-3 rounded-2xl bg-skyish-50 comic-stroke-soft focus:outline-none">
                ${["Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","English","FranÃ§ais","EspaÃ±ol","æ—¥æœ¬èª","í•œêµ­ì–´"].map(l => `
                  <option ${state.language===l?"selected":""}>${l}</option>
                `).join("")}
              </select>
            </div>
          </div>
        </div>
      `;
    }

    function step4() {
      const styles = [
        { id:"Ù†Ø§Ù‚Ø¯", emoji:"ğŸ§", sub:"ØªØ­Ù„ÙŠÙ„ + ØªÙ‚ÙŠÙŠÙ…Ø§Øª" },
        { id:"Ø±Ø³Ø§Ù…", emoji:"ğŸ¨", sub:"Ø§Ø³ÙƒØªØ´Ø§Øª + ÙÙ†" },
        { id:"Ø¬Ø§Ù…Ø¹", emoji:"ğŸ§©", sub:"Ù…Ù‚ØªÙ†ÙŠØ§Øª + Ù†ÙØ³Ø®" },
        { id:"Ù…Ø´Ø§Ù‡Ø¯", emoji:"ğŸ‘€", sub:"Ù…Ø´Ø§Ù‡Ø¯Ø§Øª + Ù‚ÙˆØ§Ø¦Ù…" },
        { id:"Ù‚Ø§Ø±Ø¦", emoji:"ğŸ“š", sub:"Ù‚Ø±Ø§Ø¡Ø© + ÙØµÙˆÙ„" },
      ];

      const deco = decoEmoji();
      const boysActive = state.variant === "boys";
      const girlsActive = state.variant === "girls";

      return `
        <div class="slide-in show">
          <div class="speech coral rounded-2xl bg-coral-100 comic-stroke-soft p-3">
            <div class="font-black">"Ø§Ø®ØªØ± Ø³ØªØ§ÙŠÙ„Ùƒ" ${deco.spark}</div>
            <div class="text-sm mt-1">Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØ­Ø¯Ø¯ â€œÙƒÙŠÙ ØªØ¸Ù‡Ø±â€â€¦ ÙˆØ§Ù„Ù†Ø³Ø®Ø© ØªØºÙŠÙ‘Ø± Ø²Ø®Ø§Ø±Ù Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª.</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            ${styles.map(s => cardOption({
              id: s.id,
              title: `${s.emoji} ${s.id}`,
              subtitle: s.sub,
              emoji: state.variant === "girls" ? "ğŸŒ¸" : "âš¡",
              active: state.accountStyle === s.id
            })).join("")}
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="flex items-center justify-between gap-3 flex-wrap">
              <div class="font-black">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø³Ø®Ø© (ØªØºÙŠÙ‘Ø± Ø²Ø®Ø±ÙØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª)</div>
              <div class="flex items-center gap-2">
                <button type="button" data-variant="boys"
                  class="px-4 py-2 rounded-2xl comic-stroke-soft font-black transition
                  ${boysActive ? "bg-ink-900 text-white" : "bg-sunny-50 hover:bg-sunny-100"}">
                  â™‚ Ø£ÙˆÙ„Ø§Ø¯
                </button>
                <button type="button" data-variant="girls"
                  class="px-4 py-2 rounded-2xl comic-stroke-soft font-black transition
                  ${girlsActive ? "bg-ink-900 text-white" : "bg-sunny-50 hover:bg-sunny-100"}">
                  â™€ Ø¨Ù†Ø§Øª
                </button>
              </div>
            </div>

            <div class="mt-3 text-sm text-ink-900/70">
              Ø§Ù„Ø²Ø®Ø±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span class="font-black">${deco.deco}</span> â€” Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª: ${deco.spark} ${deco.accent}
            </div>
          </div>
        </div>
      `;
    }

    function step5() {
      const avatars = ["ğŸ˜º","ğŸ¦Š","ğŸ¼","ğŸ¯","ğŸ¦","ğŸ¸","ğŸ‘¾","ğŸ¤–","ğŸ§ ","ğŸ¦„","ğŸ¦‡","ğŸ¦‹","ğŸ‰","ğŸŒ™","â­","ğŸ§¿"];
      return `
        <div class="slide-in show">
          <div class="speech blue rounded-2xl bg-skyish-100 comic-stroke-soft p-3">
            <div class="font-black">"ÙˆØ¬Ù‡ Ø§Ù„Ø¨Ø·Ù„" ğŸ§‘â€ğŸ¤</div>
            <div class="text-sm mt-1">Ø§Ø®ØªÙØ± Ø£ÙØ§ØªØ§Ø± Ø³Ø±ÙŠØ¹â€¦ Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© (ØªØ¸Ù‡Ø± ÙƒØ®Ù„ÙÙŠØ© Ù„Ù„Ø£ÙØ§ØªØ§Ø±).</div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="font-black mb-3">Ø´Ø¨ÙƒØ© Ø§Ù„Ø£ÙØ§ØªØ§Ø±Ø§Øª</div>
            <div class="grid grid-cols-4 sm:grid-cols-8 gap-2">
              ${avatars.map(a => `
                <button type="button" data-avatar="${a}"
                  class="aspect-square rounded-2xl comic-stroke-soft text-2xl bg-sunny-50 hover:bg-sunny-100 transition
                  ${state.avatar===a ? "bg-ink-900 text-white" : ""}">
                  ${a}
                </button>
              `).join("")}
            </div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="flex items-center justify-between gap-3 flex-wrap">
              <div>
                <div class="font-black">Ø±ÙØ¹ ØµÙˆØ±Ø©</div>
                <div class="text-sm text-ink-900/70">PNG/JPGâ€¦ Ø¨Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚.</div>
              </div>
              <label class="px-4 py-2 rounded-2xl bg-ink-900 text-white comic-stroke cursor-pointer font-black">
                Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ğŸ“·
                <input id="upload" type="file" accept="image/*" class="hidden" />
              </label>
            </div>

            <div class="mt-3 rounded-2xl bg-skyish-50 comic-stroke-soft p-3 text-sm">
              <span class="font-black">Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹:</span>
              <span class="mr-2">${state.uploadedImageDataUrl ? "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© âœ…" : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ â€”"}</span>
            </div>
          </div>
        </div>
      `;
    }

    function step6() {
      const genres = ["Ø´ÙˆÙ†ÙŠÙ†","Ø³ÙŠÙ†ÙŠÙ†","Ø´ÙˆØ¬Ùˆ","Ø¥ÙŠØ³ÙŠÙƒØ§ÙŠ","Ù…ÙŠÙƒØ§","Ø±ÙŠØ§Ø¶Ø©","Ø±Ø¹Ø¨","ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§","Ø¯Ø±Ø§Ù…Ø§","ØºÙ…ÙˆØ¶","Ø®ÙŠØ§Ù„","Ø³Ù„Ø§ÙŠØ³ Ø£ÙˆÙ Ù„Ø§ÙŠÙ"];
      const themes = ["ØµØ¯Ø§Ù‚Ø©","Ø§Ù†ØªÙ‚Ø§Ù…","Ù…ØºØ§Ù…Ø±Ø©","Ù…Ø¯Ø±Ø³Ø©","Ø³ÙØ± Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†","Ø¨Ø·ÙˆÙ„Ø©","Ø£Ø³Ø±Ø§Ø±","ØªØ¶Ø­ÙŠØ©","Ù†Ù‡Ø¶Ø©","Ø¹Ø§Ø¦Ù„Ø©","ØªØ­Ø¯Ù‘ÙŠ","Ø³Ø­Ø±"];

      return `
        <div class="slide-in show">
          <div class="speech yellow rounded-2xl bg-sunny-200 comic-stroke-soft p-3">
            <div class="font-black">"Ù…Ø®Ø¨Ø² Ø§Ù„ØªÙˆØµÙŠØ§Øª" ğŸ¥</div>
            <div class="text-sm mt-1">Ø§Ø®ØªØ± Genresâ€¦ ÙˆØ§Ø®ØªØ± 3 Ø«ÙŠÙ…Ø§Øª ØªØ­Ø¨Ù‡Ø§ (ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± Ø£ÙƒØ«Ø±ØŒ Ù…Ø§ ÙÙŠ Ù…Ù†Ø¹).</div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="font-black mb-2">Genres</div>
            <div class="flex flex-wrap gap-2">
              ${genres.map(g => chip(g, state.animeGenres.includes(g), null)).join("")}
            </div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="flex items-center justify-between gap-3 flex-wrap">
              <div class="font-black">Ø«ÙŠÙ…Ø§Øª ØªØ­Ø¨Ù‡Ø§ (Ù…Ù‚ØªØ±Ø­ 3) ğŸ­</div>
              <div class="text-xs text-ink-900/60">Ù…Ø®ØªØ§Ø±: <span class="font-black">${state.animeThemes.length}</span></div>
            </div>
            <div class="mt-2 flex flex-wrap gap-2">
              ${themes.map(t => chip(t, state.animeThemes.includes(t), null)).join("")}
            </div>
          </div>
        </div>
      `;
    }

    function step7() {
      const types = ["Webtoon","Comics","Manhwa"];
      const narrs = [
        { id:"Ø³Ø±ÙŠØ¹ ÙˆÙ…Ø´Ø§Ù‡Ø¯ Ù‚ØµÙŠØ±Ø©", emoji:"âš¡", sub:"Ù„Ù‚Ø·Ø§Øª ÙƒØ«ÙŠØ±Ø©" },
        { id:"Ø¨Ø·ÙŠØ¡ ÙˆØ¹Ù…ÙŠÙ‚", emoji:"ğŸ§ ", sub:"ØªØ£Ù…Ù„ ÙˆØ¨Ù†Ø§Ø¡" },
        { id:"Ù…Ø²ÙŠØ¬ Ù…ØªÙˆØ§Ø²Ù†", emoji:"âš–ï¸", sub:"Ø£ÙØ¶Ù„ Ø§Ù„Ø§Ø«Ù†ÙŠÙ†" },
        { id:"Ù…ÙØ§Ø¬Ø¢Øª ÙˆØªÙˆÙŠØ³Øª", emoji:"ğŸ²", sub:"ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹" },
      ];
      return `
        <div class="slide-in show">
          <div class="speech blue rounded-2xl bg-skyish-100 comic-stroke-soft p-3">
            <div class="font-black">"ØµÙØ­Ø§Øª ØªØªÙ‚Ù„Ø¨" ğŸ—ï¸</div>
            <div class="text-sm mt-1">Ø§Ø®ØªÙØ± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…ØµÙˆØ±Ø©â€¦ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ø­Ø¯Ù‘Ø¯ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¯.</div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="font-black mb-2">ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù†ÙˆØ¹</div>
            <div class="flex flex-wrap gap-2">
              ${types.map(t => chip(t, state.comicInterests.includes(t), null)).join("")}
            </div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            ${narrs.map(n => cardOption({
              id: n.id,
              title: `${n.emoji} ${n.id}`,
              subtitle: n.sub,
              emoji: "ğŸ“Œ",
              active: state.narrativePref === n.id
            })).join("")}
          </div>
        </div>
      `;
    }

    function step8() {
      const accounts = [
        { id:"Ø³ÙÙ†Ø³ÙŠ-Ø±ÙŠÙƒÙˆÙ…Ù†Ø¯", tag:"ØªÙˆØµÙŠØ§Øª ÙŠÙˆÙ…ÙŠØ©", emoji:"ğŸ§ " },
        { id:"Ù…Ø±Ø³Ù…-ÙØ§Ù†_Ø¢Ø±Øª", tag:"ÙÙ† + ØªØ­Ø¯ÙŠØ§Øª", emoji:"ğŸ–Œï¸" },
        { id:"Ù†Ø§Ù‚Ø¯-Ø§Ù„Ø­Ù„Ù‚Ø§Øª", tag:"ØªØ­Ù„ÙŠÙ„ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§Øª", emoji:"ğŸ§" },
        { id:"Ø¬Ø§Ù…Ø¹-Ø§Ù„Ù…Ø§Ù†Ø¬Ø§", tag:"Ù…Ù‚ØªÙ†ÙŠØ§Øª ÙˆÙ†Ø³Ø®", emoji:"ğŸ§©" },
        { id:"Ù…ÙŠÙ…Ø²-ÙÙ„Ø§Ø´", tag:"Ø¶Ø­Ùƒ ÙˆØªØ±Ù†Ø¯", emoji:"ğŸ˜‚" },
        { id:"ÙˆÙŠØ¨Ù€ØªÙˆÙ†-Ø¹Ø§Ø´Ù‚", tag:"Ø³Ù„Ø§Ø³Ù„ Webtoon", emoji:"ğŸ“±" },
      ];

      return `
        <div class="slide-in show">
          <div class="speech coral rounded-2xl bg-coral-100 comic-stroke-soft p-3">
            <div class="font-black">"ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" ğŸ‘¥</div>
            <div class="text-sm mt-1">Ø§Ø¶ØºØ· Ù…ØªØ§Ø¨Ø¹Ø©/Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© ÙƒÙ…Ø§ ØªØ­Ø¨â€¦ Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯.</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            ${accounts.map(a => {
              const followed = !!state.follows[a.id];
              return `
                <div class="rounded-3xl bg-white comic-stroke-soft p-4">
                  <div class="flex items-start justify-between gap-3">
                    <div class="flex items-center gap-3">
                      <div class="w-12 h-12 rounded-2xl bg-sunny-50 comic-stroke-soft flex items-center justify-center text-2xl">${a.emoji}</div>
                      <div>
                        <div class="font-black">${a.id}</div>
                        <div class="text-xs text-ink-900/60 mt-1">${a.tag}</div>
                      </div>
                    </div>
                    <button type="button" data-follow="${a.id}"
                      class="px-4 py-2 rounded-2xl comic-stroke-soft font-black transition
                      ${followed ? "bg-ink-900 text-white" : "bg-skyish-50 hover:bg-skyish-100"}">
                      ${followed ? "âœ“ Ù…ØªØ§Ø¨ÙØ¹" : "+ Ù…ØªØ§Ø¨Ø¹Ø©"}
                    </button>
                  </div>
                </div>
              `;
            }).join("")}
          </div>
        </div>
      `;
    }

    function step9() {
      return `
        <div class="slide-in show">
          <div class="speech yellow rounded-2xl bg-sunny-200 comic-stroke-soft p-3">
            <div class="font-black">"Ø³ÙˆÙŠØªØ´Ø§Øª Ø§Ù„Ù„Ø·Ø§ÙØ©" âš™ï¸</div>
            <div class="text-sm mt-1">Ø¬Ø±Ù‘Ø¨ Ø§Ù„ØªÙˆØ¬Ù„Ø²â€¦ Ù‡Ø°Ù‡ ÙÙ‚Ø· ØªÙØ¶ÙŠÙ„Ø§Øª ÙˆØ§Ø¬Ù‡Ø©.</div>
          </div>

          <div class="mt-4 grid grid-cols-1 gap-3">
            <div class="rounded-3xl bg-white comic-stroke-soft p-4">
              <div class="flex items-center justify-between gap-3">
                <div>
                  <div class="font-black">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£ØµØ¯Ù‚Ø§Ø¡ØŸ ğŸ¤</div>
                  <div class="text-sm text-ink-900/70 mt-1">ÙŠÙˆØµÙŠ Ù„Ùƒ Ø¨Ø­Ø³Ø§Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø°ÙˆÙ‚Ùƒ.</div>
                </div>
                <button type="button" data-toggle="suggestFriends"
                  class="toggle comic-stroke-soft ${state.suggestFriends ? "on bg-ink-900" : "bg-ink-900/20"}"></button>
              </div>
            </div>

            <div class="rounded-3xl bg-white comic-stroke-soft p-4">
              <div class="flex items-center justify-between gap-3">
                <div>
                  <div class="font-black">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©ØŸ ğŸ””</div>
                  <div class="text-sm text-ink-900/70 mt-1">ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø±Ø¯ÙˆØ¯/Ù…ØªØ§Ø¨Ø¹Ø§Øª/ØªØ±Ù†Ø¯Ø§Øª.</div>
                </div>
                <button type="button" data-toggle="newNotifications"
                  class="toggle comic-stroke-soft ${state.newNotifications ? "on bg-ink-900" : "bg-ink-900/20"}"></button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function step10() {
      const followedCount = Object.values(state.follows).filter(Boolean).length;
      const deco = decoEmoji();

      const summaryLines = [
        { k:"Ø§Ù„Ù…Ø­ØªÙˆÙ‰", v: state.contentPref.length ? state.contentPref.join("ØŒ ") : "â€”" },
        { k:"Ø§Ù„Ø¨Ø±ÙŠØ¯", v: state.email || "â€”" },
        { k:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶", v: state.displayName || "â€”" },
        { k:"Ø§Ù„Ø¹Ù…Ø±", v: state.age || "â€”" },
        { k:"Ø§Ù„Ù„ØºØ©", v: state.language || "â€”" },
        { k:"Ø§Ù„Ø³ØªØ§ÙŠÙ„", v: state.accountStyle || "â€”" },
        { k:"Ø§Ù„Ù†Ø³Ø®Ø©", v: state.variant === "girls" ? "Ø¨Ù†Ø§Øª â™€" : "Ø£ÙˆÙ„Ø§Ø¯ â™‚" },
        { k:"Ø§Ù„Ø£ÙØ§ØªØ§Ø±", v: state.avatar },
        { k:"ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©", v: state.uploadedImageDataUrl ? "Ù†Ø¹Ù… âœ…" : "Ù„Ø§ â€”" },
        { k:"Genres Ø£Ù†Ù…ÙŠ", v: state.animeGenres.length ? state.animeGenres.slice(0,6).join("ØŒ ") + (state.animeGenres.length>6 ? "â€¦" : "") : "â€”" },
        { k:"Ø«ÙŠÙ…Ø§Øª", v: state.animeThemes.length ? state.animeThemes.slice(0,6).join("ØŒ ") + (state.animeThemes.length>6 ? "â€¦" : "") : "â€”" },
        { k:"Ù‚ØµØµ Ù…ØµÙˆØ±Ø©", v: state.comicInterests.length ? state.comicInterests.join("ØŒ ") : "â€”" },
        { k:"Ø§Ù„Ø³Ø±Ø¯", v: state.narrativePref || "â€”" },
        { k:"Ù…ØªØ§Ø¨Ø¹Ø§Øª", v: `${followedCount} Ø­Ø³Ø§Ø¨` },
        { k:"Ø§Ù‚ØªØ±Ø§Ø­ Ø£ØµØ¯Ù‚Ø§Ø¡", v: state.suggestFriends ? "Ù†Ø¹Ù…" : "Ù„Ø§" },
        { k:"Ø¥Ø´Ø¹Ø§Ø±Ø§Øª", v: state.newNotifications ? "Ù†Ø¹Ù…" : "Ù„Ø§" },
      ];

      return `
        <div class="slide-in show">
          <div class="rounded-3xl bg-gradient-to-l from-skyish-100 via-white to-sunny-100 comic-stroke-soft p-5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-2xl font-black">ØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©! ğŸ</div>
                <div class="text-sm text-ink-900/70 mt-1">Ù‡Ø°Ù‡ â€œØ§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰â€ Ù„Ø­Ø³Ø§Ø¨Ùƒâ€¦ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù…ØºØ§Ù…Ø±Ø©.</div>
              </div>
              <div class="text-3xl">${deco.spark}</div>
            </div>

            <div class="speech coral mt-4 rounded-2xl bg-coral-100 comic-stroke-soft p-3">
              <div class="font-black">"Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹" ğŸ’¬</div>
              <div class="text-sm mt-1">Ø¥Ø°Ø§ ØªØ¨ØºÙ‰ ØªØ¹Ø¯Ù‘Ù„ Ø´ÙŠØ¡â€¦ Ø§Ø±Ø¬Ø¹ Ù„Ø£ÙŠ Ø®Ø·ÙˆØ© Ù…Ù† Ø§Ù„Ù€ Panels ÙÙˆÙ‚.</div>
            </div>
          </div>

          <div class="mt-4 rounded-3xl bg-white comic-stroke-soft p-4">
            <div class="font-black mb-3">Ù…Ù„Ø®ØµÙƒ</div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
              ${summaryLines.map(x => `
                <div class="rounded-2xl bg-sunny-50 comic-stroke-soft p-3 flex items-start justify-between gap-3">
                  <span class="font-black">${x.k}</span>
                  <span class="text-ink-900/70 text-left break-words">${escapeHtml(String(x.v))}</span>
                </div>
              `).join("")}
            </div>
          </div>

          <div class="mt-4 flex flex-col sm:flex-row gap-3">
            <button id="createAccountBtn" type="button"
              class="flex-1 px-5 py-4 rounded-2xl bg-ink-900 text-white comic-stroke font-black hover:translate-y-[-1px] transition">
              Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ¨
            </button>

            <button id="randomizeBtn" type="button"
              class="px-5 py-4 rounded-2xl bg-white comic-stroke-soft font-black hover:bg-skyish-50 transition">
              Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ø·ÙŠÙ ğŸ²
            </button>
          </div>

          <div id="finalToast" class="hidden mt-4 rounded-2xl bg-skyish-100 comic-stroke-soft p-3">
            <div class="font-black">ğŸ‰ ØªÙ…!</div>
            <div class="text-sm mt-1">Ù‡Ø°Ù‡ Ù…Ø¬Ø±Ø¯ ÙˆØ§Ø¬Ù‡Ø© â€” ØªÙ‚Ø¯Ø± ØªØ±Ø¨Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ø¹ Next.js/Nest.js Ø¨Ø³Ù‡ÙˆÙ„Ø©.</div>
          </div>
        </div>
      `;
    }

    function escapeHtml(s) {
      return (s || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function attachHandlersForStep() {
      // Common: options/cards/chips
      // Step1: contentPref cards
      if (state.step === 1) {
        panelBody.querySelectorAll("[data-option]").forEach(btn => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.option;
            const idx = state.contentPref.indexOf(id);
            if (idx >= 0) state.contentPref.splice(idx, 1);
            else state.contentPref.push(id);
            render();
          });
        });
      }

      // Step2 inputs
      if (state.step === 2) {
        const email = panelBody.querySelector("#email");
        const password = panelBody.querySelector("#password");
        email?.addEventListener("input", e => { state.email = e.target.value; updatePreview(); });
        password?.addEventListener("input", e => { state.password = e.target.value; });
      }

      // Step3 inputs
      if (state.step === 3) {
        const dn = panelBody.querySelector("#displayName");
        const age = panelBody.querySelector("#age");
        const lang = panelBody.querySelector("#language");
        dn?.addEventListener("input", e => { state.displayName = e.target.value; updatePreview(); });
        age?.addEventListener("input", e => { state.age = e.target.value; updatePreview(); });
        lang?.addEventListener("change", e => { state.language = e.target.value; updatePreview(); });
      }

      // Step4 style select + variant
      if (state.step === 4) {
        panelBody.querySelectorAll("[data-option]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.accountStyle = btn.dataset.option;
            updatePreview();
            render(); // refresh highlight
          });
        });
        panelBody.querySelectorAll("[data-variant]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.variant = btn.dataset.variant;
            render(); // update decorations
          });
        });
      }

      // Step5 avatar + upload
      if (state.step === 5) {
        panelBody.querySelectorAll("[data-avatar]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.avatar = btn.dataset.avatar;
            updatePreview();
            render();
          });
        });
        const upload = panelBody.querySelector("#upload");
        upload?.addEventListener("change", async (e) => {
          const file = e.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            state.uploadedImageDataUrl = String(reader.result || "");
            // Ø®Ù„ÙŠÙ‡ ÙŠØ¸Ù‡Ø± ÙƒØ®Ù„ÙÙŠØ© Ù„Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†
            previewAvatar.style.backgroundImage = `url('${state.uploadedImageDataUrl}')`;
            previewAvatar.style.backgroundSize = "cover";
            previewAvatar.style.backgroundPosition = "center";
            previewAvatar.textContent = ""; // hide emoji on photo
            render();
          };
          reader.readAsDataURL(file);
        });

        // Ù„Ùˆ Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø®Ø·ÙˆØ§Øª Ø«Ø§Ù†ÙŠØ©ØŒ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        if (!state.uploadedImageDataUrl) {
          previewAvatar.style.backgroundImage = "";
          previewAvatar.textContent = state.avatar;
        }
      }

      // Step6 chips: genres + themes
      if (state.step === 6) {
        panelBody.querySelectorAll("[data-chip]").forEach(btn => {
          btn.addEventListener("click", () => {
            const label = btn.dataset.chip;
            // ØªÙ…ÙŠÙŠØ²: Ù„Ùˆ label Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© themes Ù†Ø¶ÙŠÙÙ‡ Ù„Ù„Ø«ÙŠÙ…Ø§ØªØŒ ÙˆØ¥Ù„Ø§ Ù„Ù„genres (Ø¨Ù†ÙØ³ Ø§Ù„Ù†Øµ)
            const allThemes = ["ØµØ¯Ø§Ù‚Ø©","Ø§Ù†ØªÙ‚Ø§Ù…","Ù…ØºØ§Ù…Ø±Ø©","Ù…Ø¯Ø±Ø³Ø©","Ø³ÙØ± Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†","Ø¨Ø·ÙˆÙ„Ø©","Ø£Ø³Ø±Ø§Ø±","ØªØ¶Ø­ÙŠØ©","Ù†Ù‡Ø¶Ø©","Ø¹Ø§Ø¦Ù„Ø©","ØªØ­Ø¯Ù‘ÙŠ","Ø³Ø­Ø±"];
            const target = allThemes.includes(label) ? state.animeThemes : state.animeGenres;

            const idx = target.indexOf(label);
            if (idx >= 0) target.splice(idx, 1);
            else target.push(label);

            updatePreview();
            render();
          });
        });
      }

      // Step7: comic types chips + narrative cards
      if (state.step === 7) {
        panelBody.querySelectorAll("[data-chip]").forEach(btn => {
          btn.addEventListener("click", () => {
            const label = btn.dataset.chip;
            const idx = state.comicInterests.indexOf(label);
            if (idx >= 0) state.comicInterests.splice(idx, 1);
            else state.comicInterests.push(label);
            updatePreview();
            render();
          });
        });
        panelBody.querySelectorAll("[data-option]").forEach(btn => {
          btn.addEventListener("click", () => {
            state.narrativePref = btn.dataset.option;
            updatePreview();
            render();
          });
        });
      }

      // Step8 follow buttons
      if (state.step === 8) {
        panelBody.querySelectorAll("[data-follow]").forEach(btn => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.follow;
            state.follows[id] = !state.follows[id];
            updatePreview();
            render();
          });
        });
      }

      // Step9 toggles
      if (state.step === 9) {
        panelBody.querySelectorAll("[data-toggle]").forEach(btn => {
          btn.addEventListener("click", () => {
            const k = btn.dataset.toggle;
            state[k] = !state[k];
            updatePreview();
            render();
          });
        });
      }

      // Step10 actions
      if (state.step === 10) {
        panelBody.querySelector("#createAccountBtn")?.addEventListener("click", () => {
          panelBody.querySelector("#finalToast")?.classList.remove("hidden");
          // confetti mini (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª)
          popConfetti();
        });

        panelBody.querySelector("#randomizeBtn")?.addEventListener("click", () => {
          randomizeCute();
          render();
        });
      }
    }

    function popConfetti() {
      // ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø¨Ø³ÙŠØ·: Ù†Ø¶ÙŠÙ Ø¹Ù†Ø§ØµØ± ÙˆÙ†Ø´ÙŠÙ„Ù‡Ø§
      const modal = document.getElementById("signupModal");
      const wrapper = document.createElement("div");
      wrapper.className = "pointer-events-none absolute inset-0 overflow-hidden";
      modal.appendChild(wrapper);

      const emojis = ["âœ¨","â­","ğŸŒ¸","âš¡","ğŸ’¥","ğŸ‰","ğŸ¥","ğŸ¦Š","ğŸ§¡","ğŸ’™"];
      const count = 28;

      for (let i = 0; i < count; i++) {
        const s = document.createElement("div");
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        s.style.position = "absolute";
        s.style.top = "-10px";
        s.style.right = (Math.random() * 100) + "%";
        s.style.fontSize = (14 + Math.random()*18) + "px";
        s.style.opacity = "0.95";
        s.style.transform = `rotate(${Math.random()*120-60}deg)`;
        s.style.transition = "transform 1.2s ease, top 1.2s ease, opacity 1.2s ease";
        wrapper.appendChild(s);

        requestAnimationFrame(() => {
          s.style.top = (60 + Math.random()*50) + "%";
          s.style.transform = `translateX(${(Math.random()*120-60)}px) rotate(${Math.random()*360}deg)`;
          s.style.opacity = "0";
        });
      }

      setTimeout(() => wrapper.remove(), 1400);
    }

    function randomizeCute() {
      const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];
      const prefs = ["Ø£Ù†Ù…ÙŠ","Ù…Ø§Ù†Ø¬Ø§","ÙƒÙˆÙ…ÙŠÙƒØ³","ÙØ§Ù† Ø¢Ø±Øª","Ù…ÙŠÙ…Ø²"];
      state.contentPref = prefs.filter(() => Math.random() > 0.5);
      if (!state.contentPref.length) state.contentPref = [pick(prefs)];

      const styles = ["Ù†Ø§Ù‚Ø¯","Ø±Ø³Ø§Ù…","Ø¬Ø§Ù…Ø¹","Ù…Ø´Ø§Ù‡Ø¯","Ù‚Ø§Ø±Ø¦"];
      state.accountStyle = pick(styles);

      const langs = ["Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","English","FranÃ§ais","æ—¥æœ¬èª","í•œêµ­ì–´"];
      state.language = pick(langs);

      state.displayName = pick(["Ø´Ø§Ø¯Ùˆ-Ø³ÙŠÙ†Ø¨Ø§ÙŠ","Ù…Ø³ØªØ±-ÙˆÙŠØ¨Ù€ØªÙˆÙ†","Ø£ÙˆØªØ§ÙƒÙˆ-Ù„Ø§ÙŠØª","Ù‚Ù„Ù…-Ø§Ù„Ø¨Ø±Ù‚","Ø¬Ø§Ù…Ø¹-Ø§Ù„Ù†Ø¬ÙˆÙ…"]);
      state.age = String(pick([16,17,18,20,22,25]));

      state.variant = Math.random() > 0.5 ? "girls" : "boys";

      const avatars = ["ğŸ˜º","ğŸ¦Š","ğŸ¼","ğŸ¯","ğŸ‘¾","ğŸ¤–","ğŸ¦„","ğŸŒ™","â­","ğŸ‰"];
      state.avatar = pick(avatars);
      state.uploadedImageDataUrl = "";
      previewAvatar.style.backgroundImage = "";
      previewAvatar.textContent = state.avatar;

      const genres = ["Ø´ÙˆÙ†ÙŠÙ†","Ø³ÙŠÙ†ÙŠÙ†","Ø´ÙˆØ¬Ùˆ","Ø¥ÙŠØ³ÙŠÙƒØ§ÙŠ","Ù…ÙŠÙƒØ§","Ø±ÙŠØ§Ø¶Ø©","Ø±Ø¹Ø¨","ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§","Ø¯Ø±Ø§Ù…Ø§","ØºÙ…ÙˆØ¶","Ø®ÙŠØ§Ù„","Ø³Ù„Ø§ÙŠØ³ Ø£ÙˆÙ Ù„Ø§ÙŠÙ"];
      state.animeGenres = genres.filter(() => Math.random() > 0.65).slice(0, 6);

      const themes = ["ØµØ¯Ø§Ù‚Ø©","Ø§Ù†ØªÙ‚Ø§Ù…","Ù…ØºØ§Ù…Ø±Ø©","Ù…Ø¯Ø±Ø³Ø©","Ø³ÙØ± Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†","Ø¨Ø·ÙˆÙ„Ø©","Ø£Ø³Ø±Ø§Ø±","ØªØ¶Ø­ÙŠØ©","Ù†Ù‡Ø¶Ø©","Ø¹Ø§Ø¦Ù„Ø©","ØªØ­Ø¯Ù‘ÙŠ","Ø³Ø­Ø±"];
      state.animeThemes = themes.sort(() => Math.random()-0.5).slice(0, 3);

      const comicTypes = ["Webtoon","Comics","Manhwa"];
      state.comicInterests = comicTypes.filter(() => Math.random() > 0.45);
      if (!state.comicInterests.length) state.comicInterests = [pick(comicTypes)];

      const narrs = ["Ø³Ø±ÙŠØ¹ ÙˆÙ…Ø´Ø§Ù‡Ø¯ Ù‚ØµÙŠØ±Ø©","Ø¨Ø·ÙŠØ¡ ÙˆØ¹Ù…ÙŠÙ‚","Ù…Ø²ÙŠØ¬ Ù…ØªÙˆØ§Ø²Ù†","Ù…ÙØ§Ø¬Ø¢Øª ÙˆØªÙˆÙŠØ³Øª"];
      state.narrativePref = pick(narrs);

      state.follows = { "Ø³ÙÙ†Ø³ÙŠ-Ø±ÙŠÙƒÙˆÙ…Ù†Ø¯": true, "Ù…ÙŠÙ…Ø²-ÙÙ„Ø§Ø´": true };

      state.suggestFriends = Math.random() > 0.4;
      state.newNotifications = Math.random() > 0.4;

      state.email = "hero@otaku.com";
      state.password = "12345678";

      updatePreview();
    }

    function render() {
      // header + progress
      progressLabel.textContent = state.step;
      stepTitle.textContent = stepsMeta[state.step-1].title;

      const pct = progressPct();
      progressBar.style.width = pct + "%";

      // panel header
      const meta = stepsMeta[state.step-1];
      panelIcon.textContent = meta.icon;
      panelHeading.textContent = meta.title;
      panelNumber.textContent = String(state.step).padStart(2,"0");
      panelBubble.querySelector("div").textContent = meta.bubble;

      setBubbleColor();

      // body
      panelBody.classList.remove("show");
      panelBody.classList.add("slide-in");
      const html = (() => {
        switch (state.step) {
          case 1: return step1();
          case 2: return step2();
          case 3: return step3();
          case 4: return step4();
          case 5: return step5();
          case 6: return step6();
          case 7: return step7();
          case 8: return step8();
          case 9: return step9();
          case 10: return step10();
        }
      })();

      panelBody.innerHTML = html;

      // animate in
      requestAnimationFrame(() => {
        panelBody.classList.add("show");
      });

      // buttons (never block)
      prevBtn.textContent = state.step === 1 ? "â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚" : "â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚";
      nextBtn.textContent = state.step === state.total ? "Ø§Ù„ØªØ§Ù„ÙŠ â¡" : "Ø§Ù„ØªØ§Ù„ÙŠ â¡";

      // update stepper highlight
      renderStepper();

      // update preview
      updatePreview();

      // attach listeners
      attachHandlersForStep();

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ù‡ ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ Ø®Ù„ÙŠÙ‡Ø§ ØªØ¸Ù‡Ø±
      if (state.uploadedImageDataUrl) {
        previewAvatar.style.backgroundImage = `url('${state.uploadedImageDataUrl}')`;
        previewAvatar.style.backgroundSize = "cover";
        previewAvatar.style.backgroundPosition = "center";
        previewAvatar.textContent = "";
      } else {
        previewAvatar.style.backgroundImage = "";
        previewAvatar.textContent = state.avatar;
      }
    }

    // ========= Events =========
    openBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);

    overlay.addEventListener("click", (e) => {
      // close when clicking outside modal
      const modal = document.getElementById("signupModal");
      if (!modal.contains(e.target) && e.target === overlay) closeModal();
      // also if clicked on backdrop layer
      if (e.target.classList?.contains("bg-ink-900/40")) closeModal();
    });

    prevBtn.addEventListener("click", prev);
    nextBtn.addEventListener("click", next);

    // Esc close
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !overlay.classList.contains("hidden")) closeModal();
    });

    // Start opened for demo (ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ùˆ ØªØ¨ÙŠ)
    // openModal();
  </script>
</body>
</html>
